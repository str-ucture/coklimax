

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Climate Indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections &mdash; Coklimax 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sentinel2 Satellite image downloader using." href="../satellite/sentinel2_downloader.html" />
    <link rel="prev" title="ERA5-Land Monthly Averaged" href="era5_land_monthly.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coklimax
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../before_you_begin.html">Before you begin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebooks (CDS):</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="era5_land_hourly.html">ERA5-Land Hourly Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="era5_land_monthly.html">ERA5-Land Monthly Averaged</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Climate Indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#festlegen-der-pfade-und-arbeitsverzeichnisse">Festlegen der Pfade und Arbeitsverzeichnisse</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-datensatz-per-cds-api-herunterladen-und-entpacken-download-unpacking">A. Datensatz per CDS API herunterladen und entpacken [Download / Unpacking]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#download-und-entpacken-der-daten">Download und Entpacken der Daten</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dateigroszen">Dateigrößen</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#b-netcdfs-in-csv-tabellen-exportieren-netcdf-csv">B. netCDFs in CSV-Tabellen exportieren [netCDF -&gt; CSV]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#netcdf-to-csv-conversion-script">NetCDF to CSV Conversion Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nutzung">Nutzung</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#c-auswertungen-der-klimaindikatoren-fur-eine-area-of-interest-csv-plots-diagramme">C. Auswertungen der Klimaindikatoren für eine Area Of Interest [CSV -&gt; Plots/Diagramme]</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#festlegen-der-aoi-und-erstellen-von-diagrammen">Festlegen der AOI und Erstellen von Diagrammen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-1-definieren-der-aoi">C.1 Definieren der AOI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-2-darstellung-der-klimaindikatoren-anhand-diagrammen">C.2 Darstellung der Klimaindikatoren anhand Diagrammen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tropennachte">05. Tropennächte</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hitzetage-30c">06. Hitzetage (&gt; 30°C)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#warmster-drei-tage-zeitraum">07. Wärmster Drei-Tage-Zeitraum</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tage-einer-mit-hoher-utci">10. Tage einer mit hoher UTCI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#frosttage">11. Frosttage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gesamtniederschlag">12. Gesamtniederschlag</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-heatwavedays-datensatz-hwd-liefert-genauere-daten">Plot: HeatwaveDays (Datensatz HWD liefert genauere Daten)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#maximaler-aufeinanderfolgender-funf-tage-niederschlag">13.Maximaler aufeinanderfolgender Fünf-Tage-Niederschlag</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extremnniederschlage-insgesamt">14. Extremnniederschläge insgesamt</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aufeinanderfolgende-trockentage">15 Aufeinanderfolgende Trockentage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dauer-der-meteorologischen-durren">19. Dauer der meteorologischen Dürren</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tage-mit-hoher-brandgefahr">22. Tage mit hoher Brandgefahr</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#d-zeitreihen-als-geotiffs-netcdf-geotiff">D. Zeitreihen als geoTIFFs [netCDF -&gt; GeoTIFF]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#e-zeitreihen-als-gif-darstellen-unvollstandig-netcdf-gif">E. Zeitreihen als GIF darstellen (UNVOLLSTÄNDIG) [netCDF -&gt; Gif]</a></li>
<li class="toctree-l2"><a class="reference internal" href="#temp">Temp</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebooks (Satellite Image):</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../satellite/sentinel2_downloader.html">Sentinel2 Satellite image downloader using.</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coklimax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Climate Indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/cds/climate_indicators.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="climate-indicators-for-europe-from-1940-to-2100-derived-from-reanalysis-and-climate-projections">
<h1>Climate Indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections<a class="headerlink" href="#climate-indicators-for-europe-from-1940-to-2100-derived-from-reanalysis-and-climate-projections" title="Link to this heading"></a></h1>
<p>Dieses Datenset enthält Klimadaten, die aus Reanalyse- und Modellsimulationen stammen und im Copernicus Climate Data Store (CDS) verfügbar sind. Es bietet Klimaindizes, die die Auswirkungen von Klimavariabilität und -wandel auf Sektoren wie Gesundheit, Landwirtschaft, Energie und Wasserwirtschaft beschreiben. Diese Indizes sind wichtig für die Anpassungsplanung auf europäischer und nationaler Ebene und wurden von der Europäischen Umweltagentur (EEA) entwickelt, um die Bedürfnisse nationaler Klimaanpassungsinitiativen in der EU zu erfüllen.</p>
<p>Die Indizes basieren auf Daten aus verschiedenen CDS-Datensätzen und umfassen Temperatur-, Niederschlags- und Windindikatoren. Sie wurden aus den Datensätzen „Climate and energy indicators for Europe from 2005 to 2100“ und „ERA5 hourly data on single levels from 1940 to present“ berechnet. Weitere Indizes stammen aus thematischen Projekten des CDS.</p>
<p>Von der neuen CDS-Seite (Beta)
| https://cds-beta.climate.copernicus.eu/datasets/sis-ecde-climate-indicators?tab=overview</p>
<blockquote>
<div><p>Zitieren: Copernicus Climate Change Service (C3S), Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections, Copernicus Climate Change Service (C3S) Climate Data Store (CDS). (Accessed on DD-MMM-YYYY)</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="n">input_netCDF</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Climate Indicators\01_mean_temperature-reanalysis-yearly-grid-1940-2023-v1.0.nc&quot;</span>
<span class="n">nc_file</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">input_netCDF</span><span class="p">)</span>
<span class="n">nc_file</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">input_netCDF</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Climate Indicators\01_mean_temperature-reanalysis-yearly-grid-1940-2023-v1.0.nc&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">nc_file</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">input_netCDF</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;xarray&#39;
</pre></div>
</div>
</div>
</div>
<section id="festlegen-der-pfade-und-arbeitsverzeichnisse">
<h2>Festlegen der Pfade und Arbeitsverzeichnisse<a class="headerlink" href="#festlegen-der-pfade-und-arbeitsverzeichnisse" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39; ---- Hier die Verzeichnisse angeben ---- &#39;&#39;&#39;</span>

<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Download&#39;</span> <span class="c1">## &lt;- Bitte anpassen: Pfad, unter dem die ZIP-Datei heruntergeladen und gespeichert werden soll </span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators&#39;</span> <span class="c1">## &lt;-- Bitte anpassen: Ordner, in dem die ZIP-Datei extrahiert und die netCDFs gespeichert werden sollen</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Results&#39;</span> <span class="c1">## &lt;-- Bitte anpassen: Ordner, in dem die Ergebnisse (Layer, Tabellen) der Datenprozessierung gespeichert werden sollen</span>

<span class="sd">&#39;&#39;&#39; ----- Ende der Eingaben ---- &#39;&#39;&#39;</span>


<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Falls die Ordner noch nicht existieren, diese erstellen</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">working_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-datensatz-per-cds-api-herunterladen-und-entpacken-download-unpacking">
<h2>A. Datensatz per CDS API herunterladen und entpacken [Download / Unpacking]<a class="headerlink" href="#a-datensatz-per-cds-api-herunterladen-und-entpacken-download-unpacking" title="Link to this heading"></a></h2>
<section id="download-und-entpacken-der-daten">
<h3>Download und Entpacken der Daten<a class="headerlink" href="#download-und-entpacken-der-daten" title="Link to this heading"></a></h3>
<p>In diesem Abschnitt werden verschiedene Indikatoren aus den Bereichen “Heat and Cold” und “Wet and Dry” über die CDS API heruntergeladen. Der Prozess umfasst zwei Schritte: Zunächst erfolgt der Download der Reanalyse-Daten (verfügbar für den Zeitraum 1940 - 2023), gefolgt vom Download der Projektdaten (Zeitraum 1950 - 2100, RCP4.5 und RCP8.5, jeweils für gcm und rcm mpi-Germany, Ensemble r1i1p1). Die folgenden Indikatoren werden heruntergeladen:</p>
<ul class="simple">
<li><p><strong>Heat and Cold</strong>: Growing Degree Days, Heating Degree Days, Cooling Degree Days, Tropical Nights, Hot Days [30, 35, 40°C], Warmest Three Day Period, Heatwave Days, High UTCI-Days, Frost Days</p></li>
<li><p><strong>Wet and Dry</strong>: Total Precipitation, Maximum Consecutive Five-Day-Precipitation, Extreme Precipitation Total, Frequency of Extreme Precipitation, Consecutive Dry Days, Duration of Meteorological Droughts, Magnitude of Meteorological Droughts, Days with High Fire Danger, Extreme Wind Speed Days, Fire Weather Index</p></li>
</ul>
</section>
<section id="dateigroszen">
<h3>Dateigrößen<a class="headerlink" href="#dateigroszen" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Reanalyse-Dateien: ca. 500 - 600 MB</p></li>
<li><p>Projektdaten-Dateien: ca. 2.000 - 2.500 MB</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39; ---- Hier den API-Key eintragen ---- &#39;&#39;&#39;</span>

<span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;2aa3e01a-e690-4230-b4a7-43c532e92ba0&#39;</span>  <span class="c1">## Bitte den API-Key eintragen</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 2.1 Download der Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">cdsapi</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds-beta.climate.copernicus.eu/api&quot;</span>

<span class="n">zip_file_reanalysis</span> <span class="o">=</span> <span class="s2">&quot;climate_indicators_reanalysis&quot;</span>
<span class="n">download_path_reanalysis</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">zip_file_reanalysis</span><span class="p">)</span>



<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;sis-ecde-climate-indicators&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;growing_degree_days&#39;</span><span class="p">,</span> <span class="s1">&#39;heating_degree_days&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_degree_days&#39;</span><span class="p">,</span> <span class="s1">&#39;tropical_nights&#39;</span><span class="p">,</span> <span class="s1">&#39;hot_days&#39;</span><span class="p">,</span> <span class="s1">&#39;warmest_three_day_period&#39;</span><span class="p">,</span> <span class="s1">&#39;heatwave_days&#39;</span><span class="p">,</span> <span class="s1">&#39;high_utci_days&#39;</span><span class="p">,</span> <span class="s1">&#39;frost_days&#39;</span><span class="p">,</span> <span class="s1">&#39;total_precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum_consecutive_five_day_precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme_precipitation_total&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_of_extreme_precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;consecutive_dry_days&#39;</span><span class="p">,</span> <span class="s1">&#39;duration_of_meteorological_droughts&#39;</span><span class="p">,</span> <span class="s1">&#39;magnitude_of_meteorological_droughts&#39;</span><span class="p">,</span> <span class="s1">&#39;days_with_high_fire_danger&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme_wind_speed_days&#39;</span><span class="p">,</span> <span class="s1">&#39;fire_weather_index&#39;</span><span class="p">],</span>
    <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;reanalysis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">],</span>
    <span class="s1">&#39;spatial_aggregation&#39;</span><span class="p">:</span> <span class="s1">&#39;gridded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;other_parameters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;30_c&#39;</span><span class="p">,</span> <span class="s1">&#39;35_c&#39;</span><span class="p">,</span> <span class="s1">&#39;40_c&#39;</span><span class="p">]</span>
<span class="p">}</span>


<span class="n">target</span> <span class="o">=</span> <span class="n">download_path_reanalysis</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-12 12:33:03,708 INFO Request ID is 2bcbd861-0bcf-425c-9dea-4b1885d8fb66
2024-08-12 12:33:03,779 INFO status has been updated to accepted
2024-08-12 12:33:05,327 INFO status has been updated to running
2024-08-12 12:33:35,270 INFO Creating download object as zip with files:
[&#39;02_growing_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;03_heating_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;04_cooling_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;05_tropical_nights-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;06_hot_days-reanalysis-yearly-30deg-grid-1940-2023-v1.0.nc&#39;, &#39;06_hot_days-reanalysis-yearly-35deg-grid-1940-2023-v1.0.nc&#39;, &#39;06_hot_days-reanalysis-yearly-40deg-grid-1940-2023-v1.0.nc&#39;, &#39;07_warmest_three_day_period-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;09_heat_waves_climatological-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;10_high_utci_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;11_frost_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;12_total_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;13_maximum_five_days_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;14_extreme_precipitation_total-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;15_frequency_of_extreme_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;18_consecutive_dry_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;19_duration_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;20_magnitude_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;22_days_with_high_fire_danger-reanalysis-yearly-grid-1979-2021-v1.0.nc&#39;, &#39;24_extreme_wind_speed_days-reanalysis-yearly-grid-1940-2023-v1.0.nc&#39;, &#39;l6_fire_weather_index-reanalysis-yearly-grid-1979-2021-v1.0.nc&#39;]
2024-08-12 12:33:35,270 INFO status has been updated to successful
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "", "version_major": 2, "version_minor": 0}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;C:\\Users\\timte\\Documents\\Python\\Climate Indicators\\Download\\climate_indicators_reanalysis&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 2.2 Download der Projections-Daten</span>

<span class="kn">import</span> <span class="nn">cdsapi</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds-beta.climate.copernicus.eu/api&quot;</span>

<span class="n">zip_file_projections</span> <span class="o">=</span> <span class="s2">&quot;climate_indicators_projections&quot;</span>
<span class="n">download_path_projections</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">zip_file_projections</span><span class="p">)</span>


<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;sis-ecde-climate-indicators&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;growing_degree_days&#39;</span><span class="p">,</span> <span class="s1">&#39;heating_degree_days&#39;</span><span class="p">,</span> <span class="s1">&#39;cooling_degree_days&#39;</span><span class="p">,</span> <span class="s1">&#39;tropical_nights&#39;</span><span class="p">,</span> <span class="s1">&#39;hot_days&#39;</span><span class="p">,</span> <span class="s1">&#39;warmest_three_day_period&#39;</span><span class="p">,</span> <span class="s1">&#39;heatwave_days&#39;</span><span class="p">,</span> <span class="s1">&#39;frost_days&#39;</span><span class="p">,</span> <span class="s1">&#39;total_precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;maximum_consecutive_five_day_precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme_precipitation_total&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency_of_extreme_precipitation&#39;</span><span class="p">,</span> <span class="s1">&#39;consecutive_dry_days&#39;</span><span class="p">,</span> <span class="s1">&#39;duration_of_meteorological_droughts&#39;</span><span class="p">,</span> <span class="s1">&#39;magnitude_of_meteorological_droughts&#39;</span><span class="p">,</span> <span class="s1">&#39;days_with_high_fire_danger&#39;</span><span class="p">,</span> <span class="s1">&#39;extreme_wind_speed_days&#39;</span><span class="p">,</span> <span class="s1">&#39;fire_weather_index&#39;</span><span class="p">],</span>
    <span class="s1">&#39;origin&#39;</span><span class="p">:</span> <span class="s1">&#39;projections&#39;</span><span class="p">,</span>
    <span class="s1">&#39;gcm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mpi_esm_lr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;rcm&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;cclm4_8_17&#39;</span><span class="p">],</span>
    <span class="s1">&#39;experiment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;rcp4_5&#39;</span><span class="p">,</span> <span class="s1">&#39;rcp8_5&#39;</span><span class="p">],</span>
    <span class="s1">&#39;ensemble_member&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;r1i1p1&#39;</span><span class="p">],</span>
    <span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;yearly&#39;</span><span class="p">],</span>
    <span class="s1">&#39;spatial_aggregation&#39;</span><span class="p">:</span> <span class="s1">&#39;gridded&#39;</span><span class="p">,</span>
    <span class="s1">&#39;other_parameters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;30_c&#39;</span><span class="p">,</span> <span class="s1">&#39;35_c&#39;</span><span class="p">,</span> <span class="s1">&#39;40_c&#39;</span><span class="p">]</span>
<span class="p">}</span>


<span class="n">target</span> <span class="o">=</span> <span class="n">download_path_projections</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-12 12:35:21,891 INFO Request ID is 380e3ca6-0e70-44c4-bc1b-3af26c1226dc
2024-08-12 12:35:21,931 INFO status has been updated to accepted
2024-08-12 12:35:23,493 INFO status has been updated to running
2024-08-12 12:36:36,234 INFO Creating download object as zip with files:
[&#39;02_growing_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;02_growing_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;03_heating_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;03_heating_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;04_cooling_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;04_cooling_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;05_tropical_nights-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;05_tropical_nights-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;06_hot_days-projections-yearly-30deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;06_hot_days-projections-yearly-35deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;06_hot_days-projections-yearly-40deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;06_hot_days-projections-yearly-30deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;06_hot_days-projections-yearly-35deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;06_hot_days-projections-yearly-40deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;07_warmest_three_day_period-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;07_warmest_three_day_period-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;09_heat_waves_climatological-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;09_heat_waves_climatological-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;11_frost_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;11_frost_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;12_total_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;12_total_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;13_maximum_five_days_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;13_maximum_five_days_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;14_extreme_precipitation_total-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;14_extreme_precipitation_total-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;15_frequency_of_extreme_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;15_frequency_of_extreme_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;18_consecutive_dry_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;18_consecutive_dry_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;19_duration_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;19_duration_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;20_magnitude_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;20_magnitude_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;22_days_with_high_fire_danger-projections-yearly-rcp_4_5-mpi_esm_lr-grid-v1.0.nc&#39;, &#39;22_days_with_high_fire_danger-projections-yearly-rcp_8_5-mpi_esm_lr-grid-v1.0.nc&#39;, &#39;24_extreme_wind_speed_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;24_extreme_wind_speed_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc&#39;, &#39;l6_fire_weather_index-projections-yearly-rcp_4_5-mpi_esm_lr-grid-v1.0.nc&#39;, &#39;l6_fire_weather_index-projections-yearly-rcp_8_5-mpi_esm_lr-grid-v1.0.nc&#39;]
2024-08-12 12:37:14,730 INFO status has been updated to successful
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "", "version_major": 2, "version_minor": 0}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;C:\\Users\\timte\\Documents\\Python\\Climate Indicators\\Download\\climate_indicators_projections&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 2.3 Entpacken der heruntergeladenenen Zip-Datei ()</span>

<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">download_path_reanalysis</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span>
    
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">download_path_projections</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
    <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ZIP-Dateien wurden in das Verzeichnis </span><span class="si">{</span><span class="n">working_folder</span><span class="si">}</span><span class="s2"> entpackt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ZIP-Datei wurde in das Verzeichnis C:\Users\timte\Documents\Python\Climate Indicators entpackt
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="b-netcdfs-in-csv-tabellen-exportieren-netcdf-csv">
<h2>B. netCDFs in CSV-Tabellen exportieren [netCDF -&gt; CSV]<a class="headerlink" href="#b-netcdfs-in-csv-tabellen-exportieren-netcdf-csv" title="Link to this heading"></a></h2>
<section id="netcdf-to-csv-conversion-script">
<h3>NetCDF to CSV Conversion Script<a class="headerlink" href="#netcdf-to-csv-conversion-script" title="Link to this heading"></a></h3>
<p>Dieser Abschnitt dient dazu, NetCDF-Dateien in CSV-Dateien zu konvertieren. Es verarbeitet Klimadaten, die für verschiedene Indikatoren und Szenarien (wie Reanalyse oder Projektionen) vorliegen. Das Skript extrahiert die relevanten Variablen aus den NetCDF-Dateien, filtert die Daten für den Bereich Deutschlands und speichert die Ergebnisse in CSV-Dateien ab.</p>
</section>
<section id="nutzung">
<h3>Nutzung<a class="headerlink" href="#nutzung" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>NetCDF-Dateien:</strong> Das Skript sucht automatisch nach NetCDF-Dateien im zuvor festgelegten <code class="docutils literal notranslate"><span class="pre">working_folder</span></code>.</p></li>
<li><p><strong>CSV-Ausgabe:</strong> Die konvertierten CSV-Dateien werden im <code class="docutils literal notranslate"><span class="pre">output_folder</span></code> gespeichert, der ebenfalls bereits festgelegt wurde.</p></li>
<li><p><strong>Ausführen:</strong> Führen Sie das Skript aus, um die Konvertierung zu starten.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">num2date</span>

<span class="c1"># Mapping von Indikatoren zu Variablen</span>
<span class="n">indicator_variable_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;01_mean_temperature&quot;</span><span class="p">:{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">},</span>
    <span class="s2">&quot;02_growing_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;03_heating_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;04_cooling_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;05_tropical_nights&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;07_warmest_three_day_period&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;09_heat_waves_climatological&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;high_utci_days&quot;</span><span class="p">},</span>
    <span class="s2">&quot;11_frost_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;12_total_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;prAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;13_maximum_five_days_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;prAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;14_extreme_precipitation_total&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;15_frequency_of_extreme_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;18_consecutive_dry_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;cdd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;cdd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;19_duration_of_meteorological_droughts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;20_magnitude_of_meteorological_droughts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;22_days_with_high_fire_danger&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;fwi&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;24_extreme_wind_speed_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">convert_netcdf_to_csv</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
    <span class="c1"># Öffne die netCDF Datei</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    
    <span class="c1"># Extrahiere die spezifische Variable und die Zeit</span>
    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">][:]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
        
        <span class="c1"># Konvertiere die Zeit in ein lesbares Format</span>
        <span class="n">time_units</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="n">time_calendar</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">calendar</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="s1">&#39;calendar&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;standard&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">num2date</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>
        
        <span class="c1"># Definiere die Grenzen für Deutschland</span>
        <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">55</span>
        <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span>
        
        <span class="c1"># Finde die Indizes, die in den Bereich von Deutschland fallen</span>
        <span class="n">lat_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
        <span class="n">lon_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
        
        <span class="c1"># Filtere die Daten für Deutschland</span>
        <span class="n">filtered_lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="n">lat_indices</span><span class="p">]</span>
        <span class="n">filtered_lon</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="n">lon_indices</span><span class="p">]</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span><span class="p">[:,</span> <span class="n">lat_indices</span><span class="p">,</span> <span class="p">:][:,</span> <span class="p">:,</span> <span class="n">lon_indices</span><span class="p">]</span>
        
        <span class="c1"># Erstelle eine Liste von Einträgen für das DataFrame</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
                        <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">filtered_lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">filtered_lon</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                        <span class="n">variable_name</span><span class="p">:</span> <span class="n">filtered_data</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="p">})</span>
        
        <span class="c1"># Erstelle ein DataFrame aus den Einträgen</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        
        <span class="c1"># Speichere das DataFrame als CSV Datei</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converted: </span><span class="si">{</span><span class="n">nc_file</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">csv_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s1"> not found in </span><span class="si">{</span><span class="n">nc_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># Schließe das Dataset</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1">#working_folder = &#39;/path/to/working/folder&#39;  # Hier den tatsächlichen Pfad angeben</span>
    <span class="c1">#output_folder = os.path.join(output_folder, &#39;CSV&#39;)    # Hier den tatsächlichen Pfad angeben</span>

    <span class="c1"># Erstelle das Ausgabe-Verzeichnis, falls es nicht existiert</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Iteriere über alle .nc Dateien im Ordner</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_folder</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">):</span>
            <span class="c1"># Extrahiere den Indikator aus dem Dateinamen</span>
            <span class="n">indicator</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># z.B. &quot;02_growing_degree_days&quot;</span>
            <span class="n">scenario</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>   <span class="c1"># &quot;projections&quot; oder &quot;reanalysis&quot;</span>
            
            <span class="k">if</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">indicator_variable_mapping</span><span class="p">:</span>
                <span class="n">variable_name</span> <span class="o">=</span> <span class="n">indicator_variable_mapping</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">variable_name</span><span class="p">:</span>
                    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                    <span class="n">csv_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">))</span>
                    
                    <span class="c1"># Konvertiere die Datei</span>
                    <span class="n">convert_netcdf_to_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No variable mapping found for </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1"> in </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Indicator </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1"> not found in mapping&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Converted: C:\Users\timte\Documents\Python\Climate Indicators\01_mean_temperature-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\01_mean_temperature-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\02_growing_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\02_growing_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\02_growing_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\02_growing_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\02_growing_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\02_growing_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\03_heating_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\03_heating_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\03_heating_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\03_heating_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\03_heating_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\03_heating_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\04_cooling_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\04_cooling_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\04_cooling_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\04_cooling_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\04_cooling_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\04_cooling_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\05_tropical_nights-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\05_tropical_nights-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\05_tropical_nights-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-projections-yearly-30deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-projections-yearly-30deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-projections-yearly-30deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-projections-yearly-30deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-projections-yearly-35deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-projections-yearly-35deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-projections-yearly-35deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-projections-yearly-35deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-projections-yearly-40deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-projections-yearly-40deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-projections-yearly-40deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-projections-yearly-40deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-reanalysis-yearly-30deg-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-reanalysis-yearly-30deg-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-reanalysis-yearly-35deg-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-reanalysis-yearly-35deg-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\06_hot_days-reanalysis-yearly-40deg-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days-reanalysis-yearly-40deg-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\07_warmest_three_day_period-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\07_warmest_three_day_period-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\07_warmest_three_day_period-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\07_warmest_three_day_period-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\07_warmest_three_day_period-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\07_warmest_three_day_period-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\09_heat_waves_climatological-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\09_heat_waves_climatological-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\09_heat_waves_climatological-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\09_heat_waves_climatological-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\09_heat_waves_climatological-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\09_heat_waves_climatological-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\10_high_utci_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\10_high_utci_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\11_frost_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\11_frost_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\11_frost_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\11_frost_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\11_frost_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\11_frost_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\12_total_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\12_total_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\12_total_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\12_total_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\12_total_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\12_total_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\13_maximum_five_days_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\13_maximum_five_days_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\13_maximum_five_days_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\13_maximum_five_days_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\13_maximum_five_days_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\13_maximum_five_days_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\14_extreme_precipitation_total-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\14_extreme_precipitation_total-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\14_extreme_precipitation_total-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\14_extreme_precipitation_total-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\14_extreme_precipitation_total-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\14_extreme_precipitation_total-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\15_frequency_of_extreme_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\15_frequency_of_extreme_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\15_frequency_of_extreme_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\15_frequency_of_extreme_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\15_frequency_of_extreme_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\15_frequency_of_extreme_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\18_consecutive_dry_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\18_consecutive_dry_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\18_consecutive_dry_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\18_consecutive_dry_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\18_consecutive_dry_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\18_consecutive_dry_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\19_duration_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\19_duration_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\19_duration_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\19_duration_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\19_duration_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\19_duration_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\20_magnitude_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\20_magnitude_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\20_magnitude_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\20_magnitude_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\20_magnitude_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\20_magnitude_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\22_days_with_high_fire_danger-projections-yearly-rcp_4_5-mpi_esm_lr-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\22_days_with_high_fire_danger-projections-yearly-rcp_4_5-mpi_esm_lr-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\22_days_with_high_fire_danger-projections-yearly-rcp_8_5-mpi_esm_lr-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\22_days_with_high_fire_danger-projections-yearly-rcp_8_5-mpi_esm_lr-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\22_days_with_high_fire_danger-reanalysis-yearly-grid-1979-2021-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\22_days_with_high_fire_danger-reanalysis-yearly-grid-1979-2021-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\24_extreme_wind_speed_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\24_extreme_wind_speed_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\24_extreme_wind_speed_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\24_extreme_wind_speed_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv
Converted: C:\Users\timte\Documents\Python\Climate Indicators\24_extreme_wind_speed_days-reanalysis-yearly-grid-1940-2023-v1.0.nc to C:\Users\timte\Documents\Python\Climate Indicators\Results\24_extreme_wind_speed_days-reanalysis-yearly-grid-1940-2023-v1.0.csv
Indicator l6_fire_weather_index not found in mapping
Indicator l6_fire_weather_index not found in mapping
Indicator l6_fire_weather_index not found in mapping
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="c-auswertungen-der-klimaindikatoren-fur-eine-area-of-interest-csv-plots-diagramme">
<h2>C. Auswertungen der Klimaindikatoren für eine Area Of Interest [CSV -&gt; Plots/Diagramme]<a class="headerlink" href="#c-auswertungen-der-klimaindikatoren-fur-eine-area-of-interest-csv-plots-diagramme" title="Link to this heading"></a></h2>
<section id="festlegen-der-aoi-und-erstellen-von-diagrammen">
<h3>Festlegen der AOI und Erstellen von Diagrammen<a class="headerlink" href="#festlegen-der-aoi-und-erstellen-von-diagrammen" title="Link to this heading"></a></h3>
<p>Dieser Abschnitt dient dazu, die Verarbeitung und Analyse der Klimaindikatoren für eine festgelegte Area of Interest (AOI) durchzuführen. Die Skripte ermöglichen es dem Benutzer, eine AOI zu definieren, eine interaktive Karte der AOI zu erstellen, und die vorhandenen Datenpunkte innerhalb eines bestimmten Radius um die AOI zu visualisieren. Nach Auswahl der AOI können im Abschnitt C.2 die gefilterten Klimaindikatoren für die AOI in Diagrammen dargestellt werden.</p>
</section>
<section id="c-1-definieren-der-aoi">
<h3>C.1 Definieren der AOI<a class="headerlink" href="#c-1-definieren-der-aoi" title="Link to this heading"></a></h3>
<p>Dieser Abschnitt dient dazu, ein Gebiet von Interesse (Area of Interest, AOI) festzulegen. Der Benutzer kann den Namen sowie die geographischen Koordinaten (Breiten- und Längengrad) der AOI definieren. Basierend auf diesen Eingaben wird ein entsprechendes Verzeichnis im <code class="docutils literal notranslate"><span class="pre">output_folder</span></code> erstellt, in dem alle relevanten Dateien für die AOI gespeichert werden.</p>
<p><strong>Nutzung</strong></p>
<ul class="simple">
<li><p><strong>AOI anpassen:</strong> Aktualisieren Sie die Variablen <code class="docutils literal notranslate"><span class="pre">aoi_name</span></code>, <code class="docutils literal notranslate"><span class="pre">aoi_latitude</span></code>, und <code class="docutils literal notranslate"><span class="pre">aoi_longitude</span></code>, um die AOI festzulegen.</p></li>
<li><p><strong>Erstellen des AOI-Verzeichnisses:</strong> Das Skript erzeugt ein Verzeichnis im <code class="docutils literal notranslate"><span class="pre">output_folder</span></code>, das nach dem AOI-Namen benannt ist.</p></li>
<li><p><strong>Ausführen:</strong> Führen Sie das Skript aus, um die AOI zu definieren.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Definieren der AOI</span>

<span class="c1">### https://uni-freiburg.zoom-x.de/j/64892872042?pwd=1buwGKa0fsncOOFF1RSYHb5qkCUsJt.1</span>
<span class="c1">###</span>
<span class="c1">### K1sKnbGJf</span>

<span class="sd">&#39;&#39;&#39; ---- Hier die Eingaben aktualisieren ---- &#39;&#39;&#39;</span>

<span class="n">aoi_name</span> <span class="o">=</span> <span class="s2">&quot;Konstanz&quot;</span>
<span class="n">aoi_latitude</span> <span class="o">=</span> <span class="mf">47.6603</span>
<span class="n">aoi_longitude</span> <span class="o">=</span> <span class="mf">9.1758</span>

<span class="c1"># aoi_name = &quot;Leipzig&quot;</span>
<span class="c1"># aoi_latitude = 51.3397</span>
<span class="c1"># aoi_longitude = 12.3731</span>

<span class="sd">&#39;&#39;&#39; ----- Ende der Eingaben ---- &#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="n">aoi_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">aoi_name</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">)</span>

<span class="n">aoi</span> <span class="o">=</span> <span class="p">(</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Übersichtskarte der AOI:</strong></p>
<p>Dieser Abschnitt erstellt eine interaktive Übersichtskarte der festgelegten AOI mithilfe der Bibliothek Folium. Die Karte zentriert sich auf die Koordinaten der AOI und markiert deren Standort.</p>
<p><strong>Nutzung</strong></p>
<ul class="simple">
<li><p><strong>Karte erstellen:</strong> Nach Festlegung der AOI durch das vorherige Skript wird mit diesem Skript eine Karte erstellt, die die AOI als roten Marker anzeigt.</p></li>
<li><p><strong>Speichern der Karte:</strong> Die Karte wird als <code class="docutils literal notranslate"><span class="pre">map.html</span></code> gespeichert und kann im Browser angezeigt werden.</p></li>
<li><p><strong>Ausführen:</strong> Führen Sie das Skript aus, um die Karte zu generieren und zu speichern.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">folium</span>

<span class="c1"># Folium Karte erstellen</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># AOI einzeichnen</span>
<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
    <span class="p">[</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">],</span> 
    <span class="n">popup</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;AOI (</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> 
    <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Karte anzeigen</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;map.html&#39;</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
    
        &lt;script&gt;
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        &lt;/script&gt;
    
    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;
    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;
    
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
            &lt;style&gt;
                #map_6c702fced47fa92c7d7bbf19f390a574 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            &lt;/style&gt;
        
&lt;/head&gt;
&lt;body&gt;
    
    
            &lt;div class=&quot;folium-map&quot; id=&quot;map_6c702fced47fa92c7d7bbf19f390a574&quot; &gt;&lt;/div&gt;
        
&lt;/body&gt;
&lt;script&gt;
    
    
            var map_6c702fced47fa92c7d7bbf19f390a574 = L.map(
                &quot;map_6c702fced47fa92c7d7bbf19f390a574&quot;,
                {
                    center: [47.6603, 9.1758],
                    crs: L.CRS.EPSG3857,
                    zoom: 10,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_1af8327aa313a724b24c9764eb816e50 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_1af8327aa313a724b24c9764eb816e50.addTo(map_6c702fced47fa92c7d7bbf19f390a574);
        
    
            var marker_089c7c8eaf1f14131ef9a4bbfed3e45d = L.marker(
                [47.6603, 9.1758],
                {}
            ).addTo(map_6c702fced47fa92c7d7bbf19f390a574);
        
    
            var icon_c6dfd043d24c50a3f46ac1125c119735 = L.AwesomeMarkers.icon(
                {&quot;extraClasses&quot;: &quot;fa-rotate-0&quot;, &quot;icon&quot;: &quot;info-sign&quot;, &quot;iconColor&quot;: &quot;white&quot;, &quot;markerColor&quot;: &quot;red&quot;, &quot;prefix&quot;: &quot;glyphicon&quot;}
            );
            marker_089c7c8eaf1f14131ef9a4bbfed3e45d.setIcon(icon_c6dfd043d24c50a3f46ac1125c119735);
        
    
        var popup_688a3d02c7796d2043a434aa4a683826 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_1eb7982648a030d1a38a37d1953d80d2 = $(`&lt;div id=&quot;html_1eb7982648a030d1a38a37d1953d80d2&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;AOI (Konstanz)&lt;/div&gt;`)[0];
                popup_688a3d02c7796d2043a434aa4a683826.setContent(html_1eb7982648a030d1a38a37d1953d80d2);
            
        

        marker_089c7c8eaf1f14131ef9a4bbfed3e45d.bindPopup(popup_688a3d02c7796d2043a434aa4a683826)
        ;

        
    
    
            tile_layer_1af8327aa313a724b24c9764eb816e50.addTo(map_6c702fced47fa92c7d7bbf19f390a574);
        
&lt;/script&gt;
&lt;/html&gt;" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div></div></div>
</div>
<p><strong>CSV-Datenanalyse und Karte der Umgebung der AOI</strong></p>
<p>Dieses Skript dient dazu, die verfügbaren Datenpunkte innerhalb eines bestimmten Radius um die festgelegte AOI (Area of Interest) anzeigt. Hierzu wird eine der zuvor erzeugen CSV-Dateien ausgelesen. Es kombiniert Pandas zur Datenverarbeitung, Geopy zur Berechnung von Entfernungen und Folium zur Erstellung interaktiver Karten.</p>
<p><strong>Nutzung</strong></p>
<ol class="arabic simple">
<li><p><strong>Parameter anpassen:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">csv_directory</span></code>: Verzeichnis, in dem die CSV-Dateien gespeichert sind. Dieser Pfad wurde bereits im vorherigen Codeblock als <code class="docutils literal notranslate"><span class="pre">output_folder</span></code> festgelegt.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">radius_km</span></code>: Radius in Kilometern um die AOI, innerhalb dessen die Datenpunkte ausgewählt werden.</p></li>
</ul>
</li>
<li><p><strong>Schritt 1 - CSV-Datei auswählen:</strong></p>
<ul class="simple">
<li><p>Das Skript wählt die erste verfügbare CSV-Datei im angegebenen Verzeichnis aus. Wenn keine CSV-Dateien vorhanden sind, wird eine Fehlermeldung ausgegeben.</p></li>
</ul>
</li>
<li><p><strong>Schritt 2 - Daten filtern:</strong></p>
<ul class="simple">
<li><p>Es werden Daten aus dem Jahr 2000 extrahiert, um nur die relevanten Zeiträume zu analysieren.</p></li>
</ul>
</li>
<li><p><strong>Schritt 3 - Datenpunkte innerhalb des Radius bestimmen:</strong></p>
<ul class="simple">
<li><p>Mit Hilfe der Geopy-Bibliothek werden die Datenpunkte bestimmt, die sich innerhalb des festgelegten Radius von 50 km um die AOI befinden.</p></li>
</ul>
</li>
<li><p><strong>Karte erstellen:</strong></p>
<ul class="simple">
<li><p>Eine interaktive Karte wird erstellt, die sowohl die AOI als roten Marker als auch die umliegenden Datenpunkte als blaue Kreise darstellt. Die Karte wird im HTML-Format (<code class="docutils literal notranslate"><span class="pre">map.html</span></code>) gespeichert und kann im Browser angezeigt werden.</p></li>
</ul>
</li>
</ol>
<p><strong>Ausführen:</strong></p>
<ul class="simple">
<li><p>Führen Sie das Skript aus, um die Datenanalyse durchzuführen und die Karte zu generieren.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">geodesic</span>
<span class="kn">import</span> <span class="nn">folium</span>

<span class="c1"># Parameter festlegen</span>
<span class="n">csv_directory</span> <span class="o">=</span> <span class="n">output_folder</span>
<span class="n">radius_km</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># Schritt 1: Erste CSV-Datei im Verzeichnis auswählen</span>
<span class="n">csv_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine CSV-Dateien im Verzeichnis </span><span class="si">{</span><span class="n">csv_directory</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
<span class="n">first_csv_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Schritt 2: CSV-Datei einlesen und nach dem Jahr 2000 filtern</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">first_csv_file</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_2000</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Verwende .copy(), um die Kopie explizit zu machen</span>

<span class="c1"># Schritt 3: Koordinaten innerhalb des Radius von 40 km um die AOI finden</span>
<span class="k">def</span> <span class="nf">is_within_radius</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">geodesic</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="p">(</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">))</span><span class="o">.</span><span class="n">km</span> <span class="o">&lt;=</span> <span class="n">radius_km</span>

<span class="n">df_2000</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;within_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_2000</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">is_within_radius</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_within_radius</span> <span class="o">=</span> <span class="n">df_2000</span><span class="p">[</span><span class="n">df_2000</span><span class="p">[</span><span class="s1">&#39;within_radius&#39;</span><span class="p">]]</span>

<span class="c1"># Folium Karte erstellen</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># AOI einzeichnen</span>
<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
    <span class="p">[</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">],</span> 
    <span class="n">popup</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;AOI (</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> 
    <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Koordinaten in der Nähe der AOI einzeichnen</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_within_radius</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Lat: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Lon: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">folium</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
        <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]],</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">foll_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">popup</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span>  <span class="c1"># Beschriftung auf die Koordinaten setzen</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Karte anzeigen</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;map.html&#39;</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
    
        &lt;script&gt;
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        &lt;/script&gt;
    
    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;
    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;
    
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
            &lt;style&gt;
                #map_46e83c9027648b908a6d11ed4a704b1b {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            &lt;/style&gt;
        
&lt;/head&gt;
&lt;body&gt;
    
    
            &lt;div class=&quot;folium-map&quot; id=&quot;map_46e83c9027648b908a6d11ed4a704b1b&quot; &gt;&lt;/div&gt;
        
&lt;/body&gt;
&lt;script&gt;
    
    
            var map_46e83c9027648b908a6d11ed4a704b1b = L.map(
                &quot;map_46e83c9027648b908a6d11ed4a704b1b&quot;,
                {
                    center: [47.6603, 9.1758],
                    crs: L.CRS.EPSG3857,
                    zoom: 10,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_08d6fa69b1b42274e7a1d7d3f53f5d85 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_08d6fa69b1b42274e7a1d7d3f53f5d85.addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
            var marker_5416dba6a409b4f89da944e05669c6ce = L.marker(
                [47.6603, 9.1758],
                {}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
            var icon_45c1e411d2992d35052d143fc8335cd2 = L.AwesomeMarkers.icon(
                {&quot;extraClasses&quot;: &quot;fa-rotate-0&quot;, &quot;icon&quot;: &quot;info-sign&quot;, &quot;iconColor&quot;: &quot;white&quot;, &quot;markerColor&quot;: &quot;red&quot;, &quot;prefix&quot;: &quot;glyphicon&quot;}
            );
            marker_5416dba6a409b4f89da944e05669c6ce.setIcon(icon_45c1e411d2992d35052d143fc8335cd2);
        
    
        var popup_b6277df3fb6d05e50281ae0bd990ee66 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_4795a168f2f205adedbeed48dc02d807 = $(`&lt;div id=&quot;html_4795a168f2f205adedbeed48dc02d807&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;AOI (Konstanz)&lt;/div&gt;`)[0];
                popup_b6277df3fb6d05e50281ae0bd990ee66.setContent(html_4795a168f2f205adedbeed48dc02d807);
            
        

        marker_5416dba6a409b4f89da944e05669c6ce.bindPopup(popup_b6277df3fb6d05e50281ae0bd990ee66)
        ;

        
    
    
            var circle_6229f31975f5f6a96e0cd8e0ed204b8e = L.circle(
                [47.5, 8.75],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_af5f135a1090154934ca00b793d04469 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_33de00ed60e98b44fe6af7167e61ab9f = $(`&lt;div id=&quot;html_33de00ed60e98b44fe6af7167e61ab9f&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 8.75&lt;/div&gt;`)[0];
                popup_af5f135a1090154934ca00b793d04469.setContent(html_33de00ed60e98b44fe6af7167e61ab9f);
            
        

        circle_6229f31975f5f6a96e0cd8e0ed204b8e.bindPopup(popup_af5f135a1090154934ca00b793d04469)
        ;

        
    
    
            var circle_610e595103cd45c4e196ce78c7d4e4b5 = L.circle(
                [47.5, 9.0],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_909754cee085328665cb46e903e2f46f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_bc3891d94acc89853e9bfeab70954a61 = $(`&lt;div id=&quot;html_bc3891d94acc89853e9bfeab70954a61&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 9.0&lt;/div&gt;`)[0];
                popup_909754cee085328665cb46e903e2f46f.setContent(html_bc3891d94acc89853e9bfeab70954a61);
            
        

        circle_610e595103cd45c4e196ce78c7d4e4b5.bindPopup(popup_909754cee085328665cb46e903e2f46f)
        ;

        
    
    
            var circle_bae141ab8e991b71cb035463f0399753 = L.circle(
                [47.5, 9.25],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_e2fb21d73b45fcef03ee27f0a9e8b31e = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_168a1187916ea91134ce590f6b35ee47 = $(`&lt;div id=&quot;html_168a1187916ea91134ce590f6b35ee47&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 9.25&lt;/div&gt;`)[0];
                popup_e2fb21d73b45fcef03ee27f0a9e8b31e.setContent(html_168a1187916ea91134ce590f6b35ee47);
            
        

        circle_bae141ab8e991b71cb035463f0399753.bindPopup(popup_e2fb21d73b45fcef03ee27f0a9e8b31e)
        ;

        
    
    
            var circle_81fd697411ea575b726b60639f0c7d11 = L.circle(
                [47.5, 9.5],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_19cf63a4f37a13c277185d19e6b00c96 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_f5eac85b84fcfd1c03008e35ef2cfe78 = $(`&lt;div id=&quot;html_f5eac85b84fcfd1c03008e35ef2cfe78&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 9.5&lt;/div&gt;`)[0];
                popup_19cf63a4f37a13c277185d19e6b00c96.setContent(html_f5eac85b84fcfd1c03008e35ef2cfe78);
            
        

        circle_81fd697411ea575b726b60639f0c7d11.bindPopup(popup_19cf63a4f37a13c277185d19e6b00c96)
        ;

        
    
    
            var circle_0361fd28afdfbf25e295776b8c9ebe99 = L.circle(
                [47.75, 8.75],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_973333c1708ad0585e86f83c03862a72 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_8e9be860deb9d3dfb263b6c2a9e00c53 = $(`&lt;div id=&quot;html_8e9be860deb9d3dfb263b6c2a9e00c53&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 8.75&lt;/div&gt;`)[0];
                popup_973333c1708ad0585e86f83c03862a72.setContent(html_8e9be860deb9d3dfb263b6c2a9e00c53);
            
        

        circle_0361fd28afdfbf25e295776b8c9ebe99.bindPopup(popup_973333c1708ad0585e86f83c03862a72)
        ;

        
    
    
            var circle_c898c6f19d150d5cdc01559d5d2fb6a0 = L.circle(
                [47.75, 9.0],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_52b7df357332f81f9c5508a8375b5e90 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_300d05481dc6c5035f6aab0953efb0ca = $(`&lt;div id=&quot;html_300d05481dc6c5035f6aab0953efb0ca&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 9.0&lt;/div&gt;`)[0];
                popup_52b7df357332f81f9c5508a8375b5e90.setContent(html_300d05481dc6c5035f6aab0953efb0ca);
            
        

        circle_c898c6f19d150d5cdc01559d5d2fb6a0.bindPopup(popup_52b7df357332f81f9c5508a8375b5e90)
        ;

        
    
    
            var circle_d9683dc6ec2ab083186a6cfd985198a7 = L.circle(
                [47.75, 9.25],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_aba61853e6e8bc73dbc5f23310bc454c = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_bdf4a1706eccfc2cc93e7868ebeb6d27 = $(`&lt;div id=&quot;html_bdf4a1706eccfc2cc93e7868ebeb6d27&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 9.25&lt;/div&gt;`)[0];
                popup_aba61853e6e8bc73dbc5f23310bc454c.setContent(html_bdf4a1706eccfc2cc93e7868ebeb6d27);
            
        

        circle_d9683dc6ec2ab083186a6cfd985198a7.bindPopup(popup_aba61853e6e8bc73dbc5f23310bc454c)
        ;

        
    
    
            var circle_4fa36c26d43d560600e4466ead32f4a0 = L.circle(
                [47.75, 9.5],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_68ba762dad18fbbb5db28d398167e172 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_3f35c15cba88e1199ffc4ef8e239e590 = $(`&lt;div id=&quot;html_3f35c15cba88e1199ffc4ef8e239e590&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 9.5&lt;/div&gt;`)[0];
                popup_68ba762dad18fbbb5db28d398167e172.setContent(html_3f35c15cba88e1199ffc4ef8e239e590);
            
        

        circle_4fa36c26d43d560600e4466ead32f4a0.bindPopup(popup_68ba762dad18fbbb5db28d398167e172)
        ;

        
    
    
            var circle_d62291711c909a8e94b0f2c1c6951f21 = L.circle(
                [48.0, 9.0],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_071cdd0b3c66fb2fd8c486a79f679cd1 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_5bf5cc2b3baed1a8a9092acd244ac965 = $(`&lt;div id=&quot;html_5bf5cc2b3baed1a8a9092acd244ac965&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 48.0, Lon: 9.0&lt;/div&gt;`)[0];
                popup_071cdd0b3c66fb2fd8c486a79f679cd1.setContent(html_5bf5cc2b3baed1a8a9092acd244ac965);
            
        

        circle_d62291711c909a8e94b0f2c1c6951f21.bindPopup(popup_071cdd0b3c66fb2fd8c486a79f679cd1)
        ;

        
    
    
            var circle_84f557913ad048831019dd6c6cd31d26 = L.circle(
                [48.0, 9.25],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
    
        var popup_d0bf774f1421f9ebd8401888967f5d08 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_b2bd24f593ba017abbd7b497eda73125 = $(`&lt;div id=&quot;html_b2bd24f593ba017abbd7b497eda73125&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 48.0, Lon: 9.25&lt;/div&gt;`)[0];
                popup_d0bf774f1421f9ebd8401888967f5d08.setContent(html_b2bd24f593ba017abbd7b497eda73125);
            
        

        circle_84f557913ad048831019dd6c6cd31d26.bindPopup(popup_d0bf774f1421f9ebd8401888967f5d08)
        ;

        
    
    
            tile_layer_08d6fa69b1b42274e7a1d7d3f53f5d85.addTo(map_46e83c9027648b908a6d11ed4a704b1b);
        
&lt;/script&gt;
&lt;/html&gt;" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div></div></div>
</div>
<p><strong>Auswahl von Koordinaten innerhalb des 40 km-Radius</strong></p>
<p>Aufbauend auf dem vorherigen Codeblock, in dem die verfügbaren Datenpunkte visualisiert wurden, wird es nun dem Benutzer ermöglicht, eine spezifische Koordinate aus den Datenpunkten innerhalb eines 40 km-Radius um die AOI (Area of Interest) auszuwählen, der in den folgenden Arbeitsschritten verarbeitet wird.</p>
<p><strong>Nutzung</strong></p>
<ol class="arabic simple">
<li><p><strong>Koordinaten auflisten:</strong></p>
<ul class="simple">
<li><p>Das Skript listet alle verfügbaren Koordinaten auf, die sich innerhalb von 40 km um die AOI befinden. Jede Koordinate wird mit einem Index versehen, um die Auswahl zu erleichtern.</p></li>
</ul>
</li>
<li><p><strong>Benutzerauswahl:</strong></p>
<ul class="simple">
<li><p>Der Benutzer wird aufgefordert, eine der aufgelisteten Koordinaten durch Eingabe der entsprechenden Nummer auszuwählen.</p></li>
</ul>
</li>
<li><p><strong>Auswahl bestätigen:</strong></p>
<ul class="simple">
<li><p>Nach der Auswahl zeigt das Skript die ausgewählte Koordinate an. Falls eine ungültige Nummer eingegeben wird, wird eine entsprechende Fehlermeldung ausgegeben.</p></li>
</ul>
</li>
</ol>
<p><strong>Ausführen</strong></p>
<ul class="simple">
<li><p>Führen Sie das Skript aus, um die Koordinatenliste anzuzeigen und eine Koordinate auszuwählen.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Koordinaten im 40 km-Radius auflisten</span>
<span class="n">coordinates_list</span> <span class="o">=</span> <span class="n">df_within_radius</span><span class="p">[[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Koordinaten mit Index anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verfügbare Koordinaten innerhalb von 40 km:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinates_list</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Latitude: </span><span class="si">{</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, Longitude: </span><span class="si">{</span><span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Benutzer zur Auswahl auffordern</span>
<span class="n">selection</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wählen Sie eine Koordinate durch Eingabe der Nummer: &quot;</span><span class="p">))</span>

<span class="c1"># Ausgewählte Koordinate speichern</span>
<span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">selection</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates_list</span><span class="p">):</span>
    <span class="n">selected_coordinate</span> <span class="o">=</span> <span class="n">coordinates_list</span><span class="p">[</span><span class="n">selection</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ausgewählte Koordinate: Latitude: </span><span class="si">{</span><span class="n">selected_coordinate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, Longitude: </span><span class="si">{</span><span class="n">selected_coordinate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ungültige Auswahl. Bitte versuchen Sie es erneut.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verfügbare Koordinaten innerhalb von 40 km:
0: Latitude: 47.5, Longitude: 8.75
1: Latitude: 47.5, Longitude: 9.0
2: Latitude: 47.5, Longitude: 9.25
3: Latitude: 47.5, Longitude: 9.5
4: Latitude: 47.75, Longitude: 8.75
5: Latitude: 47.75, Longitude: 9.0
6: Latitude: 47.75, Longitude: 9.25
7: Latitude: 47.75, Longitude: 9.5
8: Latitude: 48.0, Longitude: 9.0
9: Latitude: 48.0, Longitude: 9.25
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wählen Sie eine Koordinate durch Eingabe der Nummer:  6
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ausgewählte Koordinate: Latitude: 47.75, Longitude: 9.25
</pre></div>
</div>
</div>
</div>
<p><strong>Speichern gefilterter Daten für die ausgewählte Koordinate</strong></p>
<p>Dieser Abschnitt verarbeitet die zuvor ausgewählte Koordinate weiter, indem es die relevanten Klimaindikatoren für diese Koordinate aus den verfügbaren CSV-Dateien extrahiert und in neue Dateien speichert.</p>
<p><strong>Nutzung</strong></p>
<ol class="arabic simple">
<li><p><strong>Auswahl der Koordinate:</strong></p>
<ul class="simple">
<li><p>Die vom Benutzer ausgewählte Koordinate (<code class="docutils literal notranslate"><span class="pre">selected_latitude</span></code>, <code class="docutils literal notranslate"><span class="pre">selected_longitude</span></code>) wird verwendet, um die Daten aus den CSV-Dateien zu filtern.</p></li>
</ul>
</li>
<li><p><strong>Metadaten extrahieren:</strong></p>
<ul class="simple">
<li><p>Das Skript extrahiert Metadaten wie den Indikator, das Experiment, das Szenario und ggf. einen zusätzlichen Gradwert aus den Dateinamen.</p></li>
</ul>
</li>
<li><p><strong>Daten filtern und speichern:</strong></p>
<ul class="simple">
<li><p>Für jede CSV-Datei im Verzeichnis werden die Daten auf die ausgewählte Koordinate gefiltert.</p></li>
<li><p>Falls für diese Koordinate Daten vorhanden sind, werden sie in einer neuen CSV-Datei gespeichert, deren Name auf den Metadaten und dem AOI-Namen basiert.</p></li>
<li><p>Die neuen CSV-Dateien werden im Verzeichnis der AOI (<code class="docutils literal notranslate"><span class="pre">aoi_directory</span></code>) gespeichert.</p></li>
</ul>
</li>
<li><p><strong>Benachrichtigung:</strong></p>
<ul class="simple">
<li><p>Das Skript gibt eine Meldung aus, wenn die Datei erfolgreich gespeichert wurde, oder informiert, falls keine Daten für die ausgewählte Koordinate in einer Datei gefunden wurden.</p></li>
</ul>
</li>
</ol>
<p><strong>Ausführen</strong></p>
<ul class="simple">
<li><p>Führen Sie das Skript aus, um die gefilterten Daten für die ausgewählte Koordinate zu extrahieren und in neuen CSV-Dateien zu speichern.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Ausgewählte Koordinate (wurde zuvor vom Benutzer ausgewählt)</span>
<span class="n">selected_latitude</span><span class="p">,</span> <span class="n">selected_longitude</span> <span class="o">=</span> <span class="n">selected_coordinate</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span>

<span class="c1"># Iterieren durch alle CSV-Dateien im Verzeichnis</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Laden der CSV-Datei</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
        <span class="c1"># Extrahieren der Metadaten aus dem Dateinamen</span>
        <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;22_days_with_high_fire_danger&#39;</span><span class="p">:</span>
            <span class="c1"># Toleranzschwelle für den Vergleich von Koordinaten</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.1</span>
            
            <span class="c1"># Filtern der Daten auf die ausgewählte Koordinate mit Toleranz</span>
            <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">selected_latitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">selected_latitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">selected_longitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">selected_longitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Filtern der Daten auf die ausgewählte Koordinate ohne Toleranz</span>
            <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_latitude</span><span class="p">)</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_longitude</span><span class="p">)]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aoi_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Benennung der neuen CSV-Datei</span>
            <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">deg</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            
            <span class="n">csv_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
            
            <span class="c1"># Speichern der gefilterten Werte in einer neuen CSV-Datei</span>
            <span class="n">aoi_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei gespeichert: </span><span class="si">{</span><span class="n">csv_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine Daten für die Koordinate (</span><span class="si">{</span><span class="n">selected_latitude</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">selected_longitude</span><span class="si">}</span><span class="s2">) in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_01_mean_temperature_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_02_growing_degree_days_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_02_growing_degree_days_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_02_growing_degree_days_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_03_heating_degree_days_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_03_heating_degree_days_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_03_heating_degree_days_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_04_cooling_degree_days_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_04_cooling_degree_days_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_04_cooling_degree_days_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_05_tropical_nights_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_05_tropical_nights_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_05_tropical_nights_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_30deg_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_30deg_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_35deg_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_35deg_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_40deg_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_40deg_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_30deg_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_35deg_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_06_hot_days_40deg_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_07_warmest_three_day_period_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_07_warmest_three_day_period_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_07_warmest_three_day_period_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_09_heat_waves_climatological_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_09_heat_waves_climatological_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_09_heat_waves_climatological_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_10_high_utci_days_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_11_frost_days_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_11_frost_days_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_11_frost_days_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_12_total_precipitation_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_12_total_precipitation_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_12_total_precipitation_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_13_maximum_five_days_precipitation_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_13_maximum_five_days_precipitation_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_13_maximum_five_days_precipitation_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_14_extreme_precipitation_total_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_14_extreme_precipitation_total_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_14_extreme_precipitation_total_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_15_frequency_of_extreme_precipitation_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_15_frequency_of_extreme_precipitation_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_15_frequency_of_extreme_precipitation_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_18_consecutive_dry_days_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_18_consecutive_dry_days_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_18_consecutive_dry_days_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_19_duration_of_meteorological_droughts_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_19_duration_of_meteorological_droughts_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_19_duration_of_meteorological_droughts_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_20_magnitude_of_meteorological_droughts_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_20_magnitude_of_meteorological_droughts_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_20_magnitude_of_meteorological_droughts_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_22_days_with_high_fire_danger_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_22_days_with_high_fire_danger_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_22_days_with_high_fire_danger_reanalysis_historical.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_24_extreme_wind_speed_days_projections_rcp_4_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_24_extreme_wind_speed_days_projections_rcp_8_5.csv
Datei gespeichert: C:\Users\timte\Documents\Python\Climate Indicators\Results\Konstanz\Konstanz_24_extreme_wind_speed_days_reanalysis_historical.csv
</pre></div>
</div>
</div>
</div>
</section>
<section id="c-2-darstellung-der-klimaindikatoren-anhand-diagrammen">
<h3>C.2 Darstellung der Klimaindikatoren anhand Diagrammen<a class="headerlink" href="#c-2-darstellung-der-klimaindikatoren-anhand-diagrammen" title="Link to this heading"></a></h3>
<p>Dieses Skript definiert allgemeine Design- und Formatierungseinstellungen für die Erstellung von Plots, die Klimaindikatoren aus Reanalyse- und Projektionen darstellen. Diese Einstellungen legen die visuelle Darstellung von Linien, Markern, Farben und Text in den Diagrammen fest.</p>
<p><strong>Einstellungen der Diagramme festlegen</strong></p>
<p>Dieses Skript definiert allgemeine Design- und Formatierungseinstellungen für die Erstellung von Plots, die Klimaindikatoren aus Reanalyse- und Projektionen darstellen. Diese Einstellungen legen die visuelle Darstellung von Linien, Markern, Farben und Text in den Diagrammen fest.</p>
<p><strong>Nutzung</strong></p>
<ul class="simple">
<li><p><strong>Plot-Einstellungen:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">plot_settings</span></code>: Definiert die allgemeine Größe der Plots und die Schriftart.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">color1</span></code>, <code class="docutils literal notranslate"><span class="pre">color2</span></code>, <code class="docutils literal notranslate"><span class="pre">color3</span></code>: Bestimmt die Farben für verschiedene Datensätze (Reanalyse, RCP4.5, RCP8.5).</p></li>
</ul>
</li>
<li><p><strong>Design für Datensätze:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">design_reanalyse</span></code>, <code class="docutils literal notranslate"><span class="pre">design_rcp45</span></code>, <code class="docutils literal notranslate"><span class="pre">design_rcp85</span></code>: Bestimmt das Design (Farbe, Marker, Linienstil) für die Daten der Reanalyse und der verschiedenen Klimaszenarien.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">design_rcp45_trend</span></code>, <code class="docutils literal notranslate"><span class="pre">design_rcp85_trend</span></code>: Legt das Design für die Trendlinien der Szenarien RCP4.5 und RCP8.5 fest.</p></li>
</ul>
</li>
<li><p><strong>Trennlinie:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">datum_trennlinie</span></code>: Gibt das Datum an, das die Grenze zwischen Reanalyse- und Projektdaten markiert.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">design_trennlinie</span></code>: Definiert das Aussehen der Trennlinie in den Diagrammen.</p></li>
</ul>
</li>
<li><p><strong>Text- und Achsendesign:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">design_title</span></code>: Bestimmt das Design des Titels im Diagramm.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">design_xlabel</span></code>, <code class="docutils literal notranslate"><span class="pre">design_ylabel</span></code>: Legt das Design der Beschriftungen für die x- und y-Achsen fest.</p></li>
</ul>
</li>
<li><p><strong>Gitterlinien:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">design_grid</span></code>: Definiert die Transparenz der Gitterlinien im Diagramm.</p></li>
</ul>
</li>
<li><p><strong>Untertitel:</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">untertitel</span></code>: Der Untertitel liefert die Quelle der Daten und wird in den Plots angezeigt.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">design_figtext</span></code>: Bestimmt die Positionierung und Größe des Untertitels im Diagramm.</p></li>
</ul>
</li>
</ul>
<p><strong>Ausführen</strong></p>
<ul class="simple">
<li><p>Diese Design-Einstellungen werden verwendet, um ein einheitliches und ansprechendes Layout für die Plots zu gewährleisten, die Klimadaten aus verschiedenen Quellen visualisieren.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allgemeine Plot-Einstellungen</span>
<span class="n">plot_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;Calibri&#39;</span>
<span class="p">}</span>

<span class="c1"># Farben</span>
<span class="n">color1</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span> <span class="c1">#Reanalyse</span>
<span class="n">color2</span> <span class="o">=</span> <span class="s2">&quot;#005d82&quot;</span> <span class="c1">#RCP4.5</span>
<span class="n">color3</span> <span class="o">=</span> <span class="s2">&quot;#ce1657&quot;</span> <span class="c1">#RCP8.5</span>

<span class="c1"># Darstellung der Reanalyse-Daten</span>
<span class="n">design_reanalyse</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Reanalyse&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color1</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der RCP4.5-Daten</span>
<span class="n">design_rcp45</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RCP4.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color2</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der RCP8.5-Daten</span>
<span class="n">design_rcp85</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RCP8.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color3</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trendlinie RCP4.5</span>
<span class="n">design_rcp45_trend</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Trend RCP4.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color2</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trendlinie RCP8.5</span>
<span class="n">design_rcp85_trend</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Trend RCP8.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color3</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trennline zwischen Reanalyse und Projektionsdaten</span>
<span class="n">datum_trennlinie</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span> <span class="c1"># wenn neuere Reanalyse-Daten vorliegen, müsste dieses Datum angepasst werden</span>
<span class="n">design_trennlinie</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">2.5</span>
<span class="p">}</span>

<span class="c1"># Titel-Design</span>
<span class="n">design_title</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># x-Achse Label</span>
<span class="n">design_xlabel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># y-Achse Label</span>
<span class="n">design_ylabel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Grid-Design</span>
<span class="n">design_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;alpha&#39;</span> <span class="p">:</span> <span class="mf">0.3</span>
<span class="p">}</span>

<span class="c1"># Untertitel</span>
<span class="n">untertitel</span> <span class="o">=</span> <span class="s2">&quot;Quelle: Copernicus Climate Change Service (C3S), Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections, Copernicus Climate Change Service (C3S) Climate Data Store (CDS). (Accessed on 01-08-2024)&quot;</span> 
<span class="n">design_figtext</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ha&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##########</span>
<span class="c1">############</span>
<span class="c1">############</span>
<span class="c1">############</span>
<span class="c1">############ Anomalie Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_01_mean_temperature_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Berechnung des Mittelwerts für den Referenzzeitraum 1971-2000</span>
<span class="n">reference_period</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1971</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2000</span><span class="p">)]</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">reference_period</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Berechnung der Anomalien</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="c1"># Anzeigen der berechneten Anomalien</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Erste 20 Zeilen anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Letzte 20 Zeilen anzeigen</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot der negativen Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Plot der positiven Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anomalie der mittleren Jahrestemperatur&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Referenzzeitraum 1971-2000&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anomalie derJahrestemperatur in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>  

<span class="c1"># X-Achse: Zeige alle 5 Jahre</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Legende unterhalb der Grafik platzieren</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;01_mean_temp_anomaly_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         time        t2m  anomaly
0  1940-01-01  279.50992 -2.09714
1  1941-01-01  279.61804 -1.98902
2  1942-01-01  280.29160 -1.31546
3  1943-01-01  281.45773 -0.14933
4  1944-01-01  280.36804 -1.23902
5  1945-01-01  280.77140 -0.83566
6  1946-01-01  281.07587 -0.53119
7  1947-01-01  281.39400 -0.21306
8  1948-01-01  281.32156 -0.28550
9  1949-01-01  281.75220  0.14514
10 1950-01-01  281.70975  0.10269
11 1951-01-01  281.55185 -0.05521
12 1952-01-01  281.17355 -0.43351
13 1953-01-01  281.59400 -0.01306
14 1954-01-01  280.66846 -0.93860
15 1955-01-01  280.79935 -0.80771
16 1956-01-01  279.93802 -1.66904
17 1957-01-01  281.59164 -0.01542
18 1958-01-01  281.46442 -0.14264
19 1959-01-01  281.70416  0.09710
         time        t2m  anomaly
64 2004-01-01  282.19626  0.58920
65 2005-01-01  282.07217  0.46511
66 2006-01-01  282.61154  1.00448
67 2007-01-01  283.00208  1.39502
68 2008-01-01  282.64816  1.04110
69 2009-01-01  282.69376  1.08670
70 2010-01-01  281.57123 -0.03583
71 2011-01-01  283.17426  1.56720
72 2012-01-01  282.45294  0.84588
73 2013-01-01  282.04865  0.44159
74 2014-01-01  283.61620  2.00914
75 2015-01-01  283.23688  1.62982
76 2016-01-01  282.76288  1.15582
77 2017-01-01  282.77615  1.16909
78 2018-01-01  283.87848  2.27142
79 2019-01-01  283.30914  1.70208
80 2020-01-01  283.41745  1.81039
81 2021-01-01  282.18433  0.57727
82 2022-01-01  283.86930  2.26224
83 2023-01-01  284.02448  2.41742
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1600x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/1f924d10664888690251ea112526f988af8a2faf7dbf9cb2de319013af190d10.png" src="../../_images/1f924d10664888690251ea112526f988af8a2faf7dbf9cb2de319013af190d10.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#######</span>
<span class="c1">#######</span>
<span class="c1">#######</span>
<span class="c1">#######</span>
<span class="c1">#######</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_01_mean_temperature_reanalysis_historical.csv&#39;</span>
<span class="c1"># path_rcp_45 = f&#39;{aoi_directory}\{aoi_name}_05_tropical_nights_projections_rcp_4_5.csv&#39;</span>
<span class="c1"># path_rcp_85 = f&#39;{aoi_directory}\{aoi_name}_05_tropical_nights_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="c1"># df_rcp_45 = pd.read_csv(path_rcp_45)</span>
<span class="c1"># df_rcp_85 = pd.read_csv(path_rcp_85)</span>

<span class="c1"># Temperatur von Kelvin in Celsius</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">273.15</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="c1"># df_rcp_45[&#39;time&#39;] = pd.to_datetime(df_rcp_45[&#39;time&#39;])</span>
<span class="c1"># df_rcp_85[&#39;time&#39;] = pd.to_datetime(df_rcp_85[&#39;time&#39;])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="c1"># df_rcp_45 = df_rcp_45[(df_rcp_45[&#39;time&#39;].dt.year &gt;= 2024) &amp; (df_rcp_45[&#39;time&#39;].dt.year &lt;= 2100)]</span>
<span class="c1"># df_rcp_85 = df_rcp_85[(df_rcp_85[&#39;time&#39;].dt.year &gt;= 2024) &amp; (df_rcp_85[&#39;time&#39;].dt.year &lt;= 2100)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># Trendlinie für die Reanalyse-Daten berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Grad-1-Polynom (lineare Regression)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># Polynomfunktion basierend auf den Koeffizienten</span>

<span class="c1"># Trendlinie plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Trend&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color1</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">)</span>


<span class="c1"># # RCP4.5-Daten plotten</span>
<span class="c1"># plt.plot(df_rcp_45[&#39;time&#39;], df_rcp_45[&#39;tasAdjust_NON_CDM&#39;], **design_rcp45)</span>
<span class="c1"># # # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="c1"># z = np.polyfit(df_rcp_45[&#39;time&#39;].dt.year, df_rcp_45[&#39;tasAdjust_NON_CDM&#39;], 1)</span>
<span class="c1"># p = np.poly1d(z)</span>
<span class="c1"># plt.plot(df_rcp_45[&#39;time&#39;], p(df_rcp_45[&#39;time&#39;].dt.year), **design_rcp45_trend)</span>

<span class="c1"># # RCP8.5-Daten plotten</span>
<span class="c1"># plt.plot(df_rcp_85[&#39;time&#39;], df_rcp_85[&#39;tasAdjust_NON_CDM&#39;], **design_rcp85)</span>
<span class="c1"># # # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="c1"># z = np.polyfit(df_rcp_85[&#39;time&#39;].dt.year, df_rcp_85[&#39;tasAdjust_NON_CDM&#39;], 1)</span>
<span class="c1"># p = np.poly1d(z)</span>
<span class="c1"># plt.plot(df_rcp_85[&#39;time&#39;], p(df_rcp_85[&#39;time&#39;].dt.year), **design_rcp85_trend)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="c1"># plt.axvline(x=pd.Timestamp(&#39;2024-01-01&#39;), **design_trennlinie)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Titel, Labels, Achsenbeschriftungen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Lufttemperatur [°C]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mittlere Jahrestemperaturen in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel (figtext)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;01_mean_temperature_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8b610aa4efe925bcc7978da3949df5126d0cae30fe1093261751b70a974b19c4.png" src="../../_images/8b610aa4efe925bcc7978da3949df5126d0cae30fe1093261751b70a974b19c4.png" />
</div>
</div>
<section id="tropennachte">
<h4>05. Tropennächte<a class="headerlink" href="#tropennachte" title="Link to this heading"></a></h4>
<p>Der Index der Tropennächte zählt die Anzahl der Tage in einem bestimmten Zeitraum, an denen die tägliche Mindesttemperatur 20 °C übersteigt.
Der Index wird hauptsächlich in gesundheitsbezogenen Kontexten angewendet</p>
<ul class="simple">
<li><p>Indikator: Tropennächte</p></li>
<li><p>Einheit: Tage [d]</p></li>
<li><p>Beschreibung: Die Anzahl der Tage mit einer täglichen Mindesttemperatur von über 20°C.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Titel, Labels, Achsenbeschriftungen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tropennächte [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anzahl Tropennächte in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel (figtext)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/009335dd4bc30d949eea360fb3b5426568ac80becf3e553ece0471c781e76e6c.png" src="../../_images/009335dd4bc30d949eea360fb3b5426568ac80becf3e553ece0471c781e76e6c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Anomalie Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Berechnung des Mittelwerts für den Referenzzeitraum 1971-2000</span>
<span class="n">reference_period</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1981</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2010</span><span class="p">)]</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">reference_period</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Berechnung der Anomalien</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="c1"># Anzeigen der berechneten Anomalien</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Erste 20 Zeilen anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Letzte 20 Zeilen anzeigen</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot der negativen Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Plot der positiven Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anomalie der Hitzetage &gt; 30°C&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Referenzzeitraum 1971-2000&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anomalie der Hitzetage in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>  

<span class="c1"># X-Achse: Zeige alle 5 Jahre</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Legende unterhalb der Grafik platzieren</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;05_tropical_nights_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         time  t2m  anomaly
0  1940-01-01    0     -0.9
1  1941-01-01    0     -0.9
2  1942-01-01    0     -0.9
3  1943-01-01    5      4.1
4  1944-01-01    0     -0.9
5  1945-01-01    0     -0.9
6  1946-01-01    1      0.1
7  1947-01-01    4      3.1
8  1948-01-01    0     -0.9
9  1949-01-01    0     -0.9
10 1950-01-01    0     -0.9
11 1951-01-01    0     -0.9
12 1952-01-01    1      0.1
13 1953-01-01    0     -0.9
14 1954-01-01    1      0.1
15 1955-01-01    0     -0.9
16 1956-01-01    0     -0.9
17 1957-01-01    7      6.1
18 1958-01-01    0     -0.9
19 1959-01-01    3      2.1
         time  t2m  anomaly
64 2004-01-01    0     -0.9
65 2005-01-01    2      1.1
66 2006-01-01    1      0.1
67 2007-01-01    2      1.1
68 2008-01-01    0     -0.9
69 2009-01-01    0     -0.9
70 2010-01-01    2      1.1
71 2011-01-01    0     -0.9
72 2012-01-01    3      2.1
73 2013-01-01    1      0.1
74 2014-01-01    2      1.1
75 2015-01-01    6      5.1
76 2016-01-01    1      0.1
77 2017-01-01    0     -0.9
78 2018-01-01    8      7.1
79 2019-01-01    3      2.1
80 2020-01-01    4      3.1
81 2021-01-01    1      0.1
82 2022-01-01    3      2.1
83 2023-01-01    2      1.1
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1600x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/e982da7277c71de14ed19b141050c8afa8a7ee3de22d80b837be5eee5a356a0c.png" src="../../_images/e982da7277c71de14ed19b141050c8afa8a7ee3de22d80b837be5eee5a356a0c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### linear geglättet</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_05_tropical_nights_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Funktion zum Berechnen des 30-jährigen gleitenden Durchschnitts</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="c1">#plt.plot(df_reanalysis[&#39;time&#39;], df_reanalysis[&#39;t2m&#39;], **design_reanalyse)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>


<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Plot-Parameter</span>
<span class="c1">#plt.xlim(df_reanalysis[&#39;time&#39;].min(), df_rcp_45[&#39;time&#39;].max())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Titel, Labels, Achsenbeschriftungen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tropennächte [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anzahl Tropennächte in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span><span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="c1">#years = pd.date_range(start=&#39;1965-01-01&#39;, end=&#39;2085-01-01&#39;, freq=&#39;10YE&#39;).year</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1925-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Plot speichern und anzeigen</span>
<span class="c1">#plt.savefig(f&#39;05_tropical_nights_gegl_{aoi_name}.png&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;05_tropical_nights_gegl_proj_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">51</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>     <span class="k">return</span> <span class="n">df</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> <span class="c1"># RCP4.5-Daten glätten</span>
<span class="ne">---&gt; </span><span class="mi">51</span> <span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> <span class="c1"># RCP8.5-Daten glätten</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span> <span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;compute_30_year_average&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="hitzetage-30c">
<h4>06. Hitzetage (&gt; 30°C)<a class="headerlink" href="#hitzetage-30c" title="Link to this heading"></a></h4>
<p>Der Index Hitzetage zählt die Anzahl der Tage in einem bestimmten Zeitintervall mit einer Tageshöchsttemperatur von über 30°C.
Dieser Index wird hauptsächlich in gesundheitsbezogenen Kontexten angewendet.</p>
<ul class="simple">
<li><p>Indikator: Hitzetage</p></li>
<li><p>Einheit: Tag [d]</p></li>
<li><p>Beschreibung: Die Anzahl der Tage mit einer Tageshöchsttemperatur über einem Schwellenwert von 30°C (auch 35°C oder 40°C°).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hitzetage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anzahl der Hitzetage &gt;30°C in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;06_Hot_days_30C_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e0fac8ca81ba8c852f0f4f1b236fad8c35d8b15a0626d22ee1379a223a2864fc.png" src="../../_images/e0fac8ca81ba8c852f0f4f1b236fad8c35d8b15a0626d22ee1379a223a2864fc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Anomalie Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Berechnung des Mittelwerts für den Referenzzeitraum 1981-2010</span>
<span class="n">reference_period</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1981</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2010</span><span class="p">)]</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">reference_period</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Berechnung der Anomalien</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="c1"># Anzeigen der berechneten Anomalien</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Erste 20 Zeilen anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Letzte 20 Zeilen anzeigen</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot der negativen Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Plot der positiven Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anomalie der Hitzetage &gt; 30°C&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Referenzzeitraum 1981-2010&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anomalie der Hitzetage in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>  

<span class="c1"># X-Achse: Zeige alle 5 Jahre</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Legende unterhalb der Grafik platzieren</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         time  t2m   anomaly
0  1940-01-01    0 -2.166667
1  1941-01-01    0 -2.166667
2  1942-01-01    0 -2.166667
3  1943-01-01    4  1.833333
4  1944-01-01    0 -2.166667
5  1945-01-01    0 -2.166667
6  1946-01-01    0 -2.166667
7  1947-01-01    3  0.833333
8  1948-01-01    0 -2.166667
9  1949-01-01    2 -0.166667
10 1950-01-01    2 -0.166667
11 1951-01-01    0 -2.166667
12 1952-01-01    5  2.833333
13 1953-01-01    0 -2.166667
14 1954-01-01    0 -2.166667
15 1955-01-01    0 -2.166667
16 1956-01-01    0 -2.166667
17 1957-01-01    5  2.833333
18 1958-01-01    1 -1.166667
19 1959-01-01    1 -1.166667
         time  t2m    anomaly
64 2004-01-01    0  -2.166667
65 2005-01-01    2  -0.166667
66 2006-01-01    6   3.833333
67 2007-01-01    2  -0.166667
68 2008-01-01    0  -2.166667
69 2009-01-01    2  -0.166667
70 2010-01-01    6   3.833333
71 2011-01-01    2  -0.166667
72 2012-01-01    4   1.833333
73 2013-01-01   11   8.833333
74 2014-01-01    2  -0.166667
75 2015-01-01   15  12.833333
76 2016-01-01    4   1.833333
77 2017-01-01    5   2.833333
78 2018-01-01    8   5.833333
79 2019-01-01    8   5.833333
80 2020-01-01    2  -0.166667
81 2021-01-01    2  -0.166667
82 2022-01-01    7   4.833333
83 2023-01-01    9   6.833333
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1600x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/143f56b9de83ade3b3a98558024cb25bd2171adc504df74bc97f5325bed2d0af.png" src="../../_images/143f56b9de83ade3b3a98558024cb25bd2171adc504df74bc97f5325bed2d0af.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### LINEAR GEGLÄTTET</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Funktion zum Berechnen des 30-jährigen gleitenden Durchschnitts</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>


<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Plot-Parameter</span>
<span class="c1">#plt.xlim(df_reanalysis[&#39;time&#39;].min(), df_rcp_45[&#39;time&#39;].max())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;1965-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hitzetage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anzahl der Hitzetage &gt;30°C in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span><span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="c1">#years = pd.date_range(start=df_reanalysis[&#39;time&#39;].min(), end=df_rcp_85[&#39;time&#39;].max(), freq=&#39;10YE&#39;).year</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1965-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Plot speichern und anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;06_Hot_days_30C_gegl_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9a42d4a8ce0aa0ea47093b7391fa03bdf457bf103f2a3c6f1b3cbbd7307720e2.png" src="../../_images/9a42d4a8ce0aa0ea47093b7391fa03bdf457bf103f2a3c6f1b3cbbd7307720e2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### LINEAR GEGLÄTTET</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_06_hot_days_30deg_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>

<span class="c1"># Funktion zum Berechnen des 30-jährigen gleitenden Durchschnitts</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Füge eine Spalte für das Jahr hinzu, falls noch nicht vorhanden</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">)</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="c1"># plt.plot(df_reanalysis[&#39;time&#39;], df_reanalysis[&#39;t2m&#39;], **design_reanalyse)</span>

<span class="c1"># Filtern der Projektionen auf den Zeitraum 2024 -&gt; 2085</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2085</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2085</span><span class="p">)]</span>

<span class="c1"># Umwandeln Dateityp Object in Float</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># # # Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="c1"># # Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Plot-Parameter</span>
<span class="c1"># plt.xlim(pd.Timestamp(&#39;1965-01-01&#39;), pd.Timestamp(&#39;2085-01-01&#39;))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hitzetage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="c1">#plt.title(f&#39;Anzahl der Hitzetage &gt;30°C in {aoi_name}&#39;, **design_title)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Projektion der Hitzetage &gt;30°C in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span><span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="c1"># years = pd.date_range(start=&#39;1965-01-01&#39;, end=&#39;2085-01-01&#39;, freq=&#39;10YE&#39;).year</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Plot speichern und anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;06_Hot_days_30C_gegl_proj_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="c1"># plt.savefig(f&#39;06_Hot_days_30C_gegl_{aoi_name}.png&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7a3d4fa17d6ad110291ad055bd05b8fdee4ec7986b4356e5037d6e446b0819e8.png" src="../../_images/7a3d4fa17d6ad110291ad055bd05b8fdee4ec7986b4356e5037d6e446b0819e8.png" />
</div>
</div>
</section>
<section id="warmster-drei-tage-zeitraum">
<h4>07. Wärmster Drei-Tage-Zeitraum<a class="headerlink" href="#warmster-drei-tage-zeitraum" title="Link to this heading"></a></h4>
<p>Der Index Wärmste Drei-Tage-Periode gibt die höchste Tagesmitteltemperatur an, gemittelt über ein Drei-Tage-Fenster.
Der Index misst die Intensität der Hitzewelle und ist vor allem in gesundheitsbezogenen Sektoren und in der Landwirtschaft anwendbar.</p>
<ul class="simple">
<li><p>Indikator: Wärmster Drei-Tage-Zeitraum</p></li>
<li><p>Einheit: °C</p></li>
<li><p>Beschreibung: Die höchste Tagesmitteltemperatur, gemittelt über ein Drei-Tage-Fenster in einem Jahr.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_07_warmest_three_day_period_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_07_warmest_three_day_period_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_07_warmest_three_day_period_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Temperatur von Kelvin in Celsius</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">273.15</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">273.15</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">273.15</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;tägliche Höchsttemperatur [°C]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wärmster Drei-Tage-Zeitraum für </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/63b8dcc90eedc99dd89e18a53c71135034186604066a089fb24cc56f2f699874.png" src="../../_images/63b8dcc90eedc99dd89e18a53c71135034186604066a089fb24cc56f2f699874.png" />
</div>
</div>
</section>
<section id="tage-einer-mit-hoher-utci">
<h4>10. Tage einer mit hoher UTCI<a class="headerlink" href="#tage-einer-mit-hoher-utci" title="Link to this heading"></a></h4>
<p>Der Universelle Thermische Klimaindex (UTCI) wurde als universeller hitzebedingter Gesundheitsrisikoindex für Europa entwickelt. Der vorgeschlagene Index berücksichtigt die Anzahl der Tage in einem bestimmten Zeitraum mit einem maximalen täglichen UTCI über 32 °C, was einer starken Hitzebelastung entspricht.
Dieser Index wird im Kontext der menschlichen Gesundheit angewandt</p>
<ul class="simple">
<li><p>Indikator: Hohe UTCI-Tage</p></li>
<li><p>Einheit: Tage [d]</p></li>
<li><p>Beschreibung: Die Anzahl der Tage, an denen der Universelle Thermische Klimaindex (UTCI) über 32°C liegt. Der UTCI ist ein Äquivalent zur Temperatur (°C), das ein Maß für die menschliche physiologische Reaktion auf meteorologische Bedingungen darstellt und auch die Anpassung der Kleidung der Bevölkerung an die Außentemperatur berücksichtigt. Er basiert auf vier Oberflächenvariablen - Lufttemperatur, relative Luftfeuchtigkeit, Windgeschwindigkeit und mittlere Strahlungstemperatur.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_10_high_utci_days_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Bereinige die &#39;high_utci_days&#39;-Spalte, indem die eckigen Klammern entfernt werden</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Tage mit einer UTCI &gt; 32°C [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tage mit einer hohen UTCI in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;10_High_UTCI_days_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2d27012ff5dd7854404600b350837b604ff99bf1e6946cdc1c861c573eec25bf.png" src="../../_images/2d27012ff5dd7854404600b350837b604ff99bf1e6946cdc1c861c573eec25bf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Anomalie Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_10_high_utci_days_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Bereinige die &#39;high_utci_days&#39;-Spalte, indem die eckigen Klammern entfernt werden</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Berechnung des Mittelwerts für den Referenzzeitraum 1981-2010</span>
<span class="n">reference_period</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1981</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2010</span><span class="p">)]</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">reference_period</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Berechnung der Anomalien</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_utci_days&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="c1"># Anzeigen der berechneten Anomalien</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;high_utci_days&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Erste 20 Zeilen anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;high_utci_days&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Letzte 20 Zeilen anzeigen</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Plot der negativen Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Plot der positiven Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anomalie der Tage mit einer UTCI &gt; 32°C&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Referenzzeitraum 1981-2010&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anomalie der Tage mit einer hohen UTCI in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>  

<span class="c1"># X-Achse: Zeige alle 5 Jahre</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Legende unterhalb der Grafik platzieren</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;10_High_UTCI_Anomalie_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         time  high_utci_days    anomaly
0  1940-01-01               7  -4.233333
1  1941-01-01              10  -1.233333
2  1942-01-01              15   3.766667
3  1943-01-01              11  -0.233333
4  1944-01-01               9  -2.233333
5  1945-01-01               8  -3.233333
6  1946-01-01               8  -3.233333
7  1947-01-01              28  16.766667
8  1948-01-01               7  -4.233333
9  1949-01-01              14   2.766667
10 1950-01-01              12   0.766667
11 1951-01-01              10  -1.233333
12 1952-01-01              11  -0.233333
13 1953-01-01               7  -4.233333
14 1954-01-01               6  -5.233333
15 1955-01-01               2  -9.233333
16 1956-01-01               0 -11.233333
17 1957-01-01              11  -0.233333
18 1958-01-01               2  -9.233333
19 1959-01-01              12   0.766667
         time  high_utci_days    anomaly
64 2004-01-01               8  -3.233333
65 2005-01-01              12   0.766667
66 2006-01-01              24  12.766667
67 2007-01-01              10  -1.233333
68 2008-01-01               8  -3.233333
69 2009-01-01               7  -4.233333
70 2010-01-01              18   6.766667
71 2011-01-01              13   1.766667
72 2012-01-01              11  -0.233333
73 2013-01-01              17   5.766667
74 2014-01-01              14   2.766667
75 2015-01-01              27  15.766667
76 2016-01-01              17   5.766667
77 2017-01-01              15   3.766667
78 2018-01-01              31  19.766667
79 2019-01-01              26  14.766667
80 2020-01-01              20   8.766667
81 2021-01-01               7  -4.233333
82 2022-01-01              24  12.766667
83 2023-01-01              22  10.766667
</pre></div>
</div>
<img alt="../../_images/36a6713e4cc774fdc67048f5ceb85112ab204da3bf01daa7c6bd19b460b35d5b.png" src="../../_images/36a6713e4cc774fdc67048f5ceb85112ab204da3bf01daa7c6bd19b460b35d5b.png" />
</div>
</div>
</section>
<section id="frosttage">
<h4>11. Frosttage<a class="headerlink" href="#frosttage" title="Link to this heading"></a></h4>
<p>Der Index Frosttage zählt die Anzahl der Tage in einem bestimmten Zeitraum mit einer täglichen Mindesttemperatur unter 0 °C.
Der Index wird hauptsächlich in der Landwirtschaft angewandt, um Frostschäden zu berücksichtigen, er ist aber auch für den Verkehrssektor relevant.</p>
<ul class="simple">
<li><p>Indikator: Frosttage</p></li>
<li><p>Einheit: Tage [d]</p></li>
<li><p>Beschreibung: Die Anzahl der Tage mit einer täglichen Mindesttemperatur unter 0°C.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_11_frost_days_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_11_frost_days_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_11_frost_days_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;tasAdjust_NON_CDM&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Interval der X- und Y-Achse</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Einstellungen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frosttage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frosttage in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/7f5d453262d2ad7fbc3594f920cfcac9bb0c91b776cd56531539a808b6203a5d.png" src="../../_images/7f5d453262d2ad7fbc3594f920cfcac9bb0c91b776cd56531539a808b6203a5d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Anomalie Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_11_frost_days_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Berechnung des Mittelwerts für den Referenzzeitraum 1981-2010</span>
<span class="n">reference_period</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1981</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2010</span><span class="p">)]</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">reference_period</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Berechnung der Anomalien</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="c1"># Anzeigen der berechneten Anomalien</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Erste 20 Zeilen anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;t2m&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Letzte 20 Zeilen anzeigen</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="c1"># Plot der negativen Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Plot der positiven Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anomalie der Frosttage&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Referenzzeitraum 1981-2010&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anomalie der Frosttage in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>  

<span class="c1"># X-Achse: Zeige alle 5 Jahre</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Legende unterhalb der Grafik platzieren</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         time  t2m    anomaly
0  1940-01-01  118  41.433333
1  1941-01-01  140  63.433333
2  1942-01-01  125  48.433333
3  1943-01-01  125  48.433333
4  1944-01-01  137  60.433333
5  1945-01-01  124  47.433333
6  1946-01-01  106  29.433333
7  1947-01-01  110  33.433333
8  1948-01-01   79   2.433333
9  1949-01-01  102  25.433333
10 1950-01-01   97  20.433333
11 1951-01-01   92  15.433333
12 1952-01-01  120  43.433333
13 1953-01-01   95  18.433333
14 1954-01-01   98  21.433333
15 1955-01-01  112  35.433333
16 1956-01-01  119  42.433333
17 1957-01-01   74  -2.566667
18 1958-01-01   91  14.433333
19 1959-01-01   91  14.433333
         time  t2m    anomaly
64 2004-01-01   80   3.433333
65 2005-01-01   93  16.433333
66 2006-01-01   86   9.433333
67 2007-01-01   47 -29.566667
68 2008-01-01   75  -1.566667
69 2009-01-01   76  -0.566667
70 2010-01-01   91  14.433333
71 2011-01-01   52 -24.566667
72 2012-01-01   68  -8.566667
73 2013-01-01   89  12.433333
74 2014-01-01   21 -55.566667
75 2015-01-01   67  -9.566667
76 2016-01-01   66 -10.566667
77 2017-01-01   78   1.433333
78 2018-01-01   57 -19.566667
79 2019-01-01   58 -18.566667
80 2020-01-01   62 -14.566667
81 2021-01-01   72  -4.566667
82 2022-01-01   62 -14.566667
83 2023-01-01   51 -25.566667
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1600x600 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../_images/e49c3d726f7ddf50dedc490f0ea0b2c691d311420ca5b767771d6fbd72a767dc.png" src="../../_images/e49c3d726f7ddf50dedc490f0ea0b2c691d311420ca5b767771d6fbd72a767dc.png" />
</div>
</div>
</section>
<section id="gesamtniederschlag">
<h4>12. Gesamtniederschlag<a class="headerlink" href="#gesamtniederschlag" title="Link to this heading"></a></h4>
<p>Der “Gesamtniederschlag” ist ein Index mit hoher Priorität und einem breiten Spektrum von Anwendungen. Änderungen der jährlichen und saisonalen Gesamtniederschläge werden häufig als Leitindizes in regionalen Bewertungen des Klimawandels und für verschiedene sektorale Anwendungen verwendet. Daten aus Beobachtungen sind ohne weiteres verfügbar, Reanalysen und Projektionen, auch mit Bias-Anpassungen.</p>
<ul class="simple">
<li><p>Indikator: Gesamtniederschlag</p></li>
<li><p>Einheit: mm Zeitraum-1</p></li>
<li><p>Der Gesamtniederschlag ist das akkumulierte flüssige und gefrorene Wasser, bestehend aus Regen und Schnee, das auf die Erdoberfläche fällt.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten color=&#39;#005d82&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Niederschlag [mm]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gesamtniederschlag in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8273f82fcaf475712ce9aa6c418f5e5665d41d14d9d29f0be737603dece67801.png" src="../../_images/8273f82fcaf475712ce9aa6c418f5e5665d41d14d9d29f0be737603dece67801.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### geglättet XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;prAdjust&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;prAdjust&#39;</span><span class="p">)</span>



<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>


<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Niederschlag [mm]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gesamtniederschlag in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">44</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>     <span class="k">return</span> <span class="n">df</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span> <span class="c1"># RCP4.5-Daten glätten</span>
<span class="ne">---&gt; </span><span class="mi">44</span> <span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;prAdjust&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="c1"># RCP8.5-Daten glätten</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;prAdjust&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;compute_30_year_average&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### geglättet XXXXXXXXXXXXXXXXX</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Füge eine Spalte für das Jahr hinzu, falls noch nicht vorhanden</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;prAdjust&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;prAdjust&#39;</span><span class="p">)</span>



<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># # Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="c1"># plt.fill_between(df_rcp_45[&#39;time&#39;], </span>
<span class="c1">#                  df_rcp_45[&#39;30_year_avg&#39;] - df_rcp_45[&#39;30_year_std&#39;], </span>
<span class="c1">#                  df_rcp_45[&#39;30_year_avg&#39;] + df_rcp_45[&#39;30_year_std&#39;], </span>
<span class="c1">#                  color=&#39;blue&#39;, alpha=0.05, label=&#39;RCP4.5 - Std&#39;)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>


<span class="c1"># # Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="c1"># plt.fill_between(df_rcp_85[&#39;time&#39;], </span>
<span class="c1">#                  df_rcp_85[&#39;30_year_avg&#39;] - df_rcp_85[&#39;30_year_std&#39;], </span>
<span class="c1">#                  df_rcp_85[&#39;30_year_avg&#39;] + df_rcp_85[&#39;30_year_std&#39;], </span>
<span class="c1">#                  color=&#39;red&#39;, alpha=0.05, label=&#39;RCP8.5 - Std&#39;)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Niederschlag [mm]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Gesamtniederschlag in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/0e53186e43e3992da7d525337d5572e2b0b448222075d552df7ea11976041ab1.png" src="../../_images/0e53186e43e3992da7d525337d5572e2b0b448222075d552df7ea11976041ab1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Anomalie Reanalyse-Daten</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Lese die CSV-Datei ein</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_12_total_precipitation_reanalysis_historical.csv&#39;</span><span class="p">)</span>

<span class="c1"># Konvertiere die &#39;time&#39;-Spalte in Datetime-Format</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Berechnung des Mittelwerts für den Referenzzeitraum 1981-2010</span>
<span class="n">reference_period</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1981</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2010</span><span class="p">)]</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">reference_period</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Berechnung der Anomalien</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="c1"># Anzeigen der berechneten Anomalien</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Erste 20 Zeilen anzeigen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;tp&#39;</span><span class="p">,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># Letzte 20 Zeilen anzeigen</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Plot der negativen Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Plot der positiven Werte</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anomalie des Gesamtniederschlages&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Referenzzeitraum 1981-2010&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Anomalie des Gesamtniederschlages in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># X-Achse: Zeige alle 5 Jahre</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.24</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># Legende unterhalb der Grafik platzieren</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># Zeige das Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         time         tp     anomaly
0  1940-01-01  696.31520  -53.060491
1  1941-01-01  870.14200  120.766309
2  1942-01-01  513.04626 -236.329431
3  1943-01-01  546.19214 -203.183551
4  1944-01-01  629.09030 -120.285391
5  1945-01-01  611.10376 -138.271931
6  1946-01-01  653.05426  -96.321431
7  1947-01-01  570.64557 -178.730121
8  1948-01-01  626.47250 -122.903191
9  1949-01-01  650.10170  -99.273991
10 1950-01-01  667.10490  -82.270791
11 1951-01-01  610.17230 -139.203391
12 1952-01-01  702.15753  -47.218161
13 1953-01-01  601.94990 -147.425791
14 1954-01-01  786.84590   37.470209
15 1955-01-01  711.89575  -37.479941
16 1956-01-01  847.94910   98.573409
17 1957-01-01  733.31995  -16.055741
18 1958-01-01  746.10706   -3.268631
19 1959-01-01  558.79834 -190.577351
         time         tp     anomaly
64 2004-01-01  771.67480   22.299109
65 2005-01-01  740.00050   -9.375191
66 2006-01-01  668.85474  -80.520951
67 2007-01-01  825.51960   76.143909
68 2008-01-01  725.81910  -23.556591
69 2009-01-01  851.28440  101.908709
70 2010-01-01  965.05210  215.676409
71 2011-01-01  673.35675  -76.018941
72 2012-01-01  761.86206   12.486369
73 2013-01-01  832.23290   82.857209
74 2014-01-01  684.36950  -65.006191
75 2015-01-01  661.80370  -87.571991
76 2016-01-01  682.98390  -66.391791
77 2017-01-01  726.42490  -22.950791
78 2018-01-01  449.48193 -299.893761
79 2019-01-01  659.36000  -90.015691
80 2020-01-01  694.88007  -54.495621
81 2021-01-01  873.48486  124.109169
82 2022-01-01  640.36830 -109.007391
83 2023-01-01  826.14830   76.772609
</pre></div>
</div>
<img alt="../../_images/f38de8f0f08bd86c9a5fab4a2692e26f37370cc9078fb20dd94c83d6fc768cbc.png" src="../../_images/f38de8f0f08bd86c9a5fab4a2692e26f37370cc9078fb20dd94c83d6fc768cbc.png" />
</div>
</div>
</section>
<section id="plot-heatwavedays-datensatz-hwd-liefert-genauere-daten">
<h4>Plot: HeatwaveDays (Datensatz HWD liefert genauere Daten)<a class="headerlink" href="#plot-heatwavedays-datensatz-hwd-liefert-genauere-daten" title="Link to this heading"></a></h4>
<p>Der Index Klimatologische Hitzewellentage zählt die Anzahl der Tage in einem Jahr innerhalb längerer Perioden mit ungewöhnlich hohen Temperaturen. Eine Hitzewelle ist nach der klimatologischen EURO-CORDEX-Definition ein Zeitraum von mindestens drei aufeinanderfolgenden Tagen, an denen die Tageshöchsttemperatur das 99. Perzentil der Tageshöchsttemperaturen der Saison Mai bis September während des Kontrollzeitraums Zeitraum 1971-2000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#from scipy.interpolate import UnivariateSpline</span>

<span class="c1"># Beispielpfade für die CSV-Dateien</span>
<span class="c1"># path_reanalysis = r&#39;C:\Users\timte\Documents\Python\Leipzig\Leipzig_09_heat_waves_climatological_historic_reanalysis.csv&#39;</span>

<span class="n">path_rcp_85_values</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Leipzig\Leipzig_HWD_RCP85.csv&quot;</span>
<span class="n">path_rcp_85_std</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Leipzig\Leipzig_HWD_RCP85_stdev.csv&quot;</span>
<span class="n">path_rcp_45_values</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Leipzig\Leipzig_HWD_RCP45.csv&quot;</span>
<span class="n">path_rcp_45_std</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Leipzig\Leipzig_HWD_RCP45_stdev.csv&quot;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="c1"># df_reanalysis = pd.read_csv(path_reanalysis)</span>
<span class="n">df_rcp_85_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85_values</span><span class="p">)</span>
<span class="n">df_rcp_85_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85_std</span><span class="p">)</span>
<span class="n">df_rcp_45_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45_values</span><span class="p">)</span>
<span class="n">df_rcp_45_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45_std</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="c1"># df_reanalysis[&#39;time&#39;] = pd.to_datetime(df_reanalysis[&#39;time&#39;])</span>
<span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85_std</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85_std</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45_std</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45_std</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="c1"># df_reanalysis = df_reanalysis[(df_reanalysis[&#39;time&#39;].dt.year &gt;= 1940) &amp; (df_reanalysis[&#39;time&#39;].dt.year &lt;= 2023)]</span>
<span class="c1"># df_rcp_45_values = df_rcp_45_values[(df_rcp_45_values[&#39;time&#39;].dt.year &gt;= 2024) &amp; (df_rcp_45_values[&#39;time&#39;].dt.year &lt;= 2085)]</span>
<span class="c1"># df_rcp_85_values = df_rcp_85_values[(df_rcp_85_values[&#39;time&#39;].dt.year &gt;= 2024) &amp; (df_rcp_85_values[&#39;time&#39;].dt.year &lt;= 2085)]</span>
<span class="c1"># df_rcp_45_std = df_rcp_45_std[(df_rcp_45_std[&#39;time&#39;].dt.year &gt;= 2024) &amp; (df_rcp_45_std[&#39;time&#39;].dt.year &lt;= 2085)]</span>
<span class="c1"># df_rcp_85_std = df_rcp_85_std[(df_rcp_85_std[&#39;time&#39;].dt.year &gt;= 2024) &amp; (df_rcp_85_std[&#39;time&#39;].dt.year &lt;= 2085)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="c1"># plt.plot(df_reanalysis[&#39;time&#39;], df_reanalysis[&#39;data&#39;], label=&#39;Reanalyse&#39;, color=&#39;green&#39;, marker=&#39;o&#39;, linestyle=&#39;-&#39;, markersize=4)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 Werte&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85_std</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85_std</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 Standardabweichung&#39;</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 Werte&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45_std</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45_std</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 Standardabweichung&#39;</span><span class="p">)</span>


<span class="c1"># # Achsenbereiche einstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85_values</span><span class="p">[</span><span class="s1">&#39;HWD_EU_climate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
<span class="c1">#plt.ylim(0, df_rcp_85_values[&#39;HWD_EU_climate&#39;].max())</span>


<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hitzewellen-Tage [d]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Hitzewellen-Tage in Leipzig&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">line</span> <span class="mi">16</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">path_rcp_45_std</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Leipzig\Leipzig_HWD_RCP45_stdev.csv&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># Einlesen der Daten</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># df_reanalysis = pd.read_csv(path_reanalysis)</span>
<span class="ne">---&gt; </span><span class="mi">16</span> <span class="n">df_rcp_85_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85_values</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="n">df_rcp_85_std</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85_std</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="n">df_rcp_45_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45_values</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\io\parsers\readers.py:1026,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1014</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1015</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1024</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1026</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\io\parsers\readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\io\parsers\readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\io\parsers\readers.py:1880,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1878</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1880</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1881</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1883</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1886</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1887</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1888</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1889</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1890</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1891</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\io\common.py:873,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">873</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">874</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">878</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">881</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;C:\\Users\\timte\\Documents\\Python\\Leipzig\\Leipzig_HWD_RCP85.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### LINEAR GEGLÄTTET</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_09_heat_waves_climatological_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_09_heat_waves_climatological_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_09_heat_waves_climatological_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>

<span class="c1"># Funktion zum Berechnen des 30-jährigen gleitenden Durchschnitts</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Füge eine Spalte für das Jahr hinzu, falls noch nicht vorhanden</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="c1">#plt.plot(df_reanalysis[&#39;time&#39;], df_reanalysis[&#39;data&#39;], **design_reanalyse)</span>

<span class="c1"># Filtern der Projektionen auf den Zeitraum 2024 -&gt; 2085</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1986</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2085</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1986</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2085</span><span class="p">)]</span>

<span class="c1"># Umwandeln Dateityp Object in Float</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># # # Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="c1"># # Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="c1">#plt.axvline(x=pd.Timestamp(&#39;2024-01-01&#39;), **design_trennlinie)</span>

<span class="c1"># Plot-Parameter</span>
<span class="c1"># plt.xlim(pd.Timestamp(&#39;1986-01-01&#39;), pd.Timestamp(&#39;2085-01-01&#39;))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2025-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Hitzewellen-Tage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="c1"># plt.title(f&#39;Anzahl der Hitzewellen-Tage in {aoi_name}&#39;, **design_title)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Projektion der Hitzewellen-Tage in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span><span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="c1">#years = pd.date_range(start=&#39;1986-01-01&#39;, end=&#39;2085-01-01&#39;, freq=&#39;10YE&#39;).year</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1985-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Plot speichern und anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;09_heat_waves_climatological_gegl_proj_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8728166607ff663668547363c11a2c3f2e788504051d9d7dc0d774bad2868b64.png" src="../../_images/8728166607ff663668547363c11a2c3f2e788504051d9d7dc0d774bad2868b64.png" />
</div>
</div>
</section>
<section id="maximaler-aufeinanderfolgender-funf-tage-niederschlag">
<h4>13.Maximaler aufeinanderfolgender Fünf-Tage-Niederschlag<a class="headerlink" href="#maximaler-aufeinanderfolgender-funf-tage-niederschlag" title="Link to this heading"></a></h4>
<p>Maximaler aufeinanderfolgender Fünf-Tage-Niederschlag” (d. h. die größte Niederschlagssumme an fünf aufeinanderfolgenden Tagen in einem Jahr) ist ein Index von hoher Priorität. Er berücksichtigt das Ausmaß des Ereignisses, ist leicht zu interpretieren und wird häufig in hydrologischen Anwendungen verwendet.</p>
<ul class="simple">
<li><p>Indikator: Maximaler aufeinanderfolgender Fünf-Tage-Niederschlag</p></li>
<li><p>Einheit: mm/5-Tage</p></li>
<li><p>Beschreibung: Maximale Fünf-Tages-Niederschlagssummen über ein Jahr.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_13_maximum_five_days_precipitation_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_13_maximum_five_days_precipitation_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_13_maximum_five_days_precipitation_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;tp&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;prAdjust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Niederschlag [mm/5-Tage]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Maximale aufeinanderfolgende 5-Tages Niederschlag in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/31e3f4b98f423951b2785a80e6204910471f476ba50901b4cb51f219c1d2491d.png" src="../../_images/31e3f4b98f423951b2785a80e6204910471f476ba50901b4cb51f219c1d2491d.png" />
</div>
</div>
</section>
<section id="extremnniederschlage-insgesamt">
<h4>14. Extremnniederschläge insgesamt<a class="headerlink" href="#extremnniederschlage-insgesamt" title="Link to this heading"></a></h4>
<p>Die “Summe der extremen Niederschläge” (d. h. die Summe der Niederschlagswerte an allen Tagen, die über einem festgelegten Schwellenwert liegen, der über einen Bezugszeitraum definiert wurde) ist ein Index von hoher Priorität. Er berücksichtigt die Häufigkeit und das Ausmaß ungewöhnlicher Niederschlagsereignisse, die im Vergleich zu den Ausgangsbedingungen festgestellt wurden.</p>
<ul class="simple">
<li><p>Indikator: Extremniederschläge insgesamt</p></li>
<li><p>Einheit: mm</p></li>
<li><p>Beschreibung: Die Gesamtsumme der Tagesniederschlagswerte in einem Jahr, die das 99. Perzentil des Bezugszeitraums überschreiten.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_14_extreme_precipitation_total_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_14_extreme_precipitation_total_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_14_extreme_precipitation_total_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Extremniederschläge insgesamt [mm]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extremniederschläge insgesamt für </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/fe10ab483932e10427aa5c862b2cfdf60de6c203d44b3a9073ac3c7460550207.png" src="../../_images/fe10ab483932e10427aa5c862b2cfdf60de6c203d44b3a9073ac3c7460550207.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### LINEAR GEGLÄTTET</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_14_extreme_precipitation_total_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_14_extreme_precipitation_total_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_14_extreme_precipitation_total_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>

<span class="c1"># Funktion zum Berechnen des 30-jährigen gleitenden Durchschnitts</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Füge eine Spalte für das Jahr hinzu, falls noch nicht vorhanden</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># # Fülle NaN-Werte in den Spalten &#39;30_year_avg&#39; und &#39;30_year_std&#39; auf (optional: z.B. mit 0)</span>
<span class="c1"># df_rcp_45[&#39;30_year_avg&#39;].fillna(0, inplace=True)</span>
<span class="c1"># df_rcp_45[&#39;30_year_std&#39;].fillna(0, inplace=True)</span>

<span class="c1"># df_rcp_85[&#39;30_year_avg&#39;].fillna(0, inplace=True)</span>
<span class="c1"># df_rcp_85[&#39;30_year_std&#39;].fillna(0, inplace=True)</span>

<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2084</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2084</span><span class="p">)]</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># # # Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


<span class="c1"># # Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Plot-Parameter</span>
<span class="c1">#plt.xlim(df_reanalysis[&#39;time&#39;].min(), df_rcp_45[&#39;time&#39;].max())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;1965-01-01&#39;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Extremniederschläge insgesamt [mm]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extremniederschläge insgesamt für </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span><span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;1965-01-01&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;2085-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Plot speichern und anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;14_extreme_precipitation_total_gegl_</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/77047ec3ded81e9b3a12ba85dcef8e4cae54a1f40e0baba8796616637f223ddb.png" src="../../_images/77047ec3ded81e9b3a12ba85dcef8e4cae54a1f40e0baba8796616637f223ddb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          time 30_year_avg 30_year_std
0   1950-01-01  179.718224   83.880573
1   1951-01-01  187.656308   87.035039
2   1952-01-01  198.274687   94.965279
3   1953-01-01  193.911929   93.970823
4   1954-01-01  198.187938    93.20586
..         ...         ...         ...
146 2096-01-01  246.334173   95.874718
147 2097-01-01  240.971943   95.370894
148 2098-01-01  248.368748   92.357738
149 2099-01-01  243.797594   93.077646
150 2100-01-01  233.733281    86.04812

[151 rows x 3 columns]
          time 30_year_avg 30_year_std
0   1950-01-01  166.889044   78.315645
1   1951-01-01  172.016216   78.390415
2   1952-01-01  182.241582   86.824415
3   1953-01-01  177.448594    86.65188
4   1954-01-01  181.414465   85.966511
..         ...         ...         ...
146 2096-01-01  307.825265  134.273027
147 2097-01-01  314.893317  134.075408
148 2098-01-01  321.224246  135.008558
149 2099-01-01  327.012123  136.842389
150 2100-01-01  322.310812   139.90511

[151 rows x 3 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>time           datetime64[ns]
latitude              float64
longitude             float64
data                  float64
30_year_avg            object
30_year_std            object
Year                    int32
dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="aufeinanderfolgende-trockentage">
<h4>15 Aufeinanderfolgende Trockentage<a class="headerlink" href="#aufeinanderfolgende-trockentage" title="Link to this heading"></a></h4>
<p>“Aufeinanderfolgende Trockentage” (d. h. der längste Zeitraum aufeinander folgender Tage mit weniger als 1 mm Niederschlag) ist ein Index mittlerer Priorität, der die Dauer der Trockenheit berücksichtigt. Er lässt sich leicht berechnen, bietet aber nur einen begrenzten Mehrwert gegenüber den anderen Trockenheits- und Dürreindizes.</p>
<ul class="simple">
<li><p>Indikator: Aufeinanderfolgende trockene Tage</p></li>
<li><p>Einheit: Tag [d]</p></li>
<li><p>Beschreibung: Der längste Zeitraum aufeinander folgender Tage mit Tagesniederschlägen unter 1 mm in einem Jahr, einer Jahreszeit oder einem Monat.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_18_consecutive_dry_days_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_18_consecutive_dry_days_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_18_consecutive_dry_days_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Trockentage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Aufeinanderfolgende Trockentage für </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/3ee3b6cd480adcc01ed9752e4a95b609cd72db96cb586a6da0b73918733369be.png" src="../../_images/3ee3b6cd480adcc01ed9752e4a95b609cd72db96cb586a6da0b73918733369be.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_18_consecutive_dry_days_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_18_consecutive_dry_days_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_18_consecutive_dry_days_projections_rcp_8_5.csv&#39;</span>

<span class="k">def</span> <span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">current_year</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>
        
        <span class="c1"># Bestimme den Zeitraum von 15 Jahren vor und 15 Jahren nach dem aktuellen Jahr</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">-</span> <span class="mi">15</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">current_year</span> <span class="o">+</span> <span class="mi">14</span>
        
        <span class="c1"># Filtere die Daten, die in diesen Zeitraum fallen</span>
        <span class="n">period_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
        
        <span class="c1"># Berechne den Durchschnitt und die Standardabweichung für den Zeitraum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Nur wenn genau 30 Jahre im Zeitraum sind</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># RCP4.5-Daten glätten</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">,</span> <span class="s1">&#39;cdd&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten glätten</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">compute_30_year_average</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">,</span> <span class="s1">&#39;cdd&#39;</span><span class="p">)</span>



<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Standardabweichung für RCP4.5 als obere und untere Grenze plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>


<span class="c1"># Gefüllte Fläche für die Standardabweichung von RCP8.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>


<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;cdd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Trockentage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Aufeinanderfolgende Trockentage für </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c8c0217c75e3fc77e0fcaab3a2413a626ce37fcf4a1ca170f8ebe1205ae4a6e2.png" src="../../_images/c8c0217c75e3fc77e0fcaab3a2413a626ce37fcf4a1ca170f8ebe1205ae4a6e2.png" />
</div>
</div>
</section>
<section id="dauer-der-meteorologischen-durren">
<h4>19. Dauer der meteorologischen Dürren<a class="headerlink" href="#dauer-der-meteorologischen-durren" title="Link to this heading"></a></h4>
<p>Die “Dauer der meteorologischen Dürre” ist ein Index mit hoher Priorität, der die Gesamtzahl der Monate Monate mit anomal niedrigen Niederschlagsbedingungen (für mindestens zwei aufeinanderfolgende Monate) in einem bestimmten Zeitraum auf der Grundlage des standardisierten Niederschlagsindex (SPI). Verschiedene Implementierungen des SPI verwenden unterschiedliche Zeitaggregationen und Schwellenwerte für Niederschlagswerte. Der Index Der hier vorgestellte Index basiert auf dem aggregierten 3-Monats-Niederschlag (SPI-3), der im Allgemeinen als für landwirtschaftliche Anwendungen geeignet ist, und einem Schwellenwert von -1 für die Erkennung von von Trockenheitsereignissen. Weder SPI noch SPI-basierte Indizes sind derzeit in der C3S CDS verfügbar, aber die zugrundeliegenden Niederschlagsdaten sind ohne weiteres verfügbar. SPI-3 für vergangene und aktuelle Zeiträume ist aus dem C3S-Datensatz für Indizes auf der Grundlage von E-OBS-Daten leicht verfügbar. Dürrebedingungen auf der Grundlage des SPI werden auch von der EDO-Plattform der GFS überwacht.</p>
<ul class="simple">
<li><p>Indikator: Dauer der meteorologischen Dürreperioden</p></li>
<li><p>Einheit: Monat</p></li>
<li><p>Beschreibung: Die Anzahl der Monate in einem Jahr mit anomal niedrigen Niederschlagsbedingungen auf der Grundlage des standardisierten 3-Monats-Niederschlagsindex (SPI-3) im Vergleich zu einem Referenzzeitraum, hier 1981-2010.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

<span class="c1">#Duration of meteorological droughts [month]</span>
<span class="c1"># The count of months in a year with anomalously low precipitation conditions based on the 3-month Standardised Precipitation Index (SPI-3) relative to a reference period, here 1981-2010.</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_19_duration_of_meteorological_droughts_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_19_duration_of_meteorological_droughts_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_19_duration_of_meteorological_droughts_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;dmd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;dmd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;dmd&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;dmd&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;dmd&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Dürreperiode [Monat]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dauer von meteorologischen Dürren in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9b048ad36f611e2064d07a6e3c38a58bf29b7641f92d2da14659c404da397c71.png" src="../../_images/9b048ad36f611e2064d07a6e3c38a58bf29b7641f92d2da14659c404da397c71.png" />
</div>
</div>
</section>
<section id="tage-mit-hoher-brandgefahr">
<h4>22. Tage mit hoher Brandgefahr<a class="headerlink" href="#tage-mit-hoher-brandgefahr" title="Link to this heading"></a></h4>
<p>“Tage mit hoher Brandgefahr” ist ein Index von hoher Priorität, der die Häufigkeit gefährlicher Bedingungen auf der Grundlage von Wetterbedingungen bewertet, die sich auf die Brennstofffeuchtigkeit und das Brandverhalten auswirken.
In der Brandgefahrenbewertung des Europäischen Waldbrandsystems (EFFIS) stehen FWI-Werte über 11,2, 21,3 und 38,0 für eine mäßige, hohe bzw. sehr hohe Brandgefahr. Verschiedene Implementierungen dieses Index verwenden unterschiedliche Schwellenwerte, die verschiedene Klassen der Brandgefahr definieren. Gefahr definieren. Der Index ist in der C3S unter Brandgefahrindikatoren für Europa, basierend auf EURO-CORDEX-Projektionen und aus den historischen Daten der Brandgefahr-Indizes auf der Grundlage der ERA5-Reanalyse.
FWI-Projektionen für Europa wurden auch im Rahmen des GFS-Projekts PESETA III entwickelt.</p>
<ul class="simple">
<li><p>Indikator: Tage mit hoher Brandgefahr</p></li>
<li><p>Einheit: Tag [d]</p></li>
<li><p>Beschreibung: Die Anzahl der Tage in einem Zeitraum mit einem Brandwetterindex (FWI) von mehr als 30 (Anzahl der Tage), basierend auf der Klassifizierung des Europäischen Waldbrandinformationssystems (EFFIS).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># 22_days_with_high_fire_danger</span>
<span class="c1"># The count of days with precipitation above the extreme precipitation threshold defined as the 95th percentile of total precipitation of rainy days over 1981-2010</span>

<span class="c1"># Dateipfade</span>
<span class="n">path_reanalysis</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_22_days_with_high_fire_danger_reanalysis_historical.csv&#39;</span>
<span class="n">path_rcp_45</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_22_days_with_high_fire_danger_projections_rcp_4_5.csv&#39;</span>
<span class="n">path_rcp_85</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_directory</span><span class="si">}</span><span class="s1">\</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_22_days_with_high_fire_danger_projections_rcp_8_5.csv&#39;</span>

<span class="c1"># Einlesen der Daten</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_reanalysis</span><span class="p">)</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_45</span><span class="p">)</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_rcp_85</span><span class="p">)</span>

<span class="c1"># Konvertieren der Zeitspalte in Datetime-Objekte</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filtern der Daten basierend auf den Jahren</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2023</span><span class="p">)]</span>
<span class="n">df_rcp_45</span> <span class="o">=</span> <span class="n">df_rcp_45</span><span class="p">[(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>
<span class="n">df_rcp_85</span> <span class="o">=</span> <span class="n">df_rcp_85</span><span class="p">[(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2024</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">)]</span>

<span class="c1"># Plot erstellen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="n">plot_settings</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]})</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;fwi&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="c1"># # # Trendlinie für RCP4.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="c1"># # # Trendlinie für RCP8.5 berechnen und plotten</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">(</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Linie zwischen 2023 und 2024 hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp_45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Jahr&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_xlabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Anzahl Tage [d]&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_ylabel</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tage mit hoher Brandgefahr in </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">design_title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="n">design_grid</span><span class="p">)</span>

<span class="c1"># Untertitel</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">untertitel</span> <span class="p">,</span> <span class="o">**</span><span class="n">design_figtext</span><span class="p">)</span>

<span class="c1"># X-Achse: 10 Jahre-Intervall</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="n">df_rcp_85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">),</span> <span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/04073402f37bfee26c38447a5fc2b41541e8e5a43089131c0be6dd6d522e4c62.png" src="../../_images/04073402f37bfee26c38447a5fc2b41541e8e5a43089131c0be6dd6d522e4c62.png" />
</div>
</div>
</section>
</section>
</section>
<section id="d-zeitreihen-als-geotiffs-netcdf-geotiff">
<h2>D. Zeitreihen als geoTIFFs [netCDF -&gt; GeoTIFF]<a class="headerlink" href="#d-zeitreihen-als-geotiffs-netcdf-geotiff" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.transform</span> <span class="kn">import</span> <span class="n">from_origin</span>
<span class="kn">from</span> <span class="nn">rasterio.crs</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">num2date</span>

<span class="c1"># Define the working folder and output folder (make sure these are defined)</span>
<span class="c1"># working_folder = &#39;path/to/working_folder&#39;</span>
<span class="c1"># output_folder = &#39;path/to/output_folder&#39;</span>

<span class="c1"># Liste aller NetCDF-Dateien im Arbeitsordner</span>
<span class="n">netcdf_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>

<span class="c1"># Anzeige der verfügbaren Dateien und Auswahl durch den Benutzer</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verfügbare NetCDF-Dateien:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">netcdf_files</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">file_selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wähle die Nummern der zu verarbeitenden Dateien aus (mit Komma getrennt) oder &#39;alle&#39; für alle Dateien: &quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">file_selection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;alle&#39;</span><span class="p">:</span>
    <span class="n">selected_files</span> <span class="o">=</span> <span class="n">netcdf_files</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">selected_indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">file_selection</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
    <span class="n">selected_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">netcdf_files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selected_indices</span><span class="p">]</span>

<span class="c1"># Mapping von Indikator-Variablen</span>
<span class="n">indicator_variable_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;02_growing_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;03_heating_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;04_cooling_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;05_tropical_nights&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;07_warmest_three_day_period&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;09_heat_waves_climatological&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;high_utci_days&quot;</span><span class="p">},</span>
    <span class="s2">&quot;11_frost_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;12_total_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;prAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;13_maximum_five_days_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;prAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;14_extreme_precipitation_total&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;15_frequency_of_extreme_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;18_consecutive_dry_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;cdd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;cdd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;19_duration_of_meteorological_droughts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;20_magnitude_of_meteorological_droughts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;22_days_with_high_fire_danger&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;fwi&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;24_extreme_wind_speed_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Deutschland Begrenzungen (in Grad)</span>
<span class="n">germany_bounds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min_lon&#39;</span><span class="p">:</span> <span class="mf">5.866</span><span class="p">,</span>  <span class="c1"># westliche Grenze</span>
    <span class="s1">&#39;max_lon&#39;</span><span class="p">:</span> <span class="mf">15.042</span><span class="p">,</span>  <span class="c1"># östliche Grenze</span>
    <span class="s1">&#39;min_lat&#39;</span><span class="p">:</span> <span class="mf">47.270</span><span class="p">,</span>  <span class="c1"># südliche Grenze</span>
    <span class="s1">&#39;max_lat&#39;</span><span class="p">:</span> <span class="mf">55.058</span>   <span class="c1"># nördliche Grenze</span>
<span class="p">}</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span>

<span class="c1"># Konvertiere Längenwerte von 0-360 nach -180 bis 180, falls erforderlich</span>
<span class="k">def</span> <span class="nf">convert_longitudes</span><span class="p">(</span><span class="n">lons</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">lons</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>

<span class="c1"># Funktion zur Handhabung von 2D- oder 3D-Variablen</span>
<span class="k">def</span> <span class="nf">get_data_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">[:,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwartete Dimension der Variable </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Schleife über alle ausgewählten NetCDF-Dateien</span>
    <span class="k">for</span> <span class="n">netcdf_file</span> <span class="ow">in</span> <span class="n">selected_files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Datei-Pfad</span>
            <span class="n">input_netCDF</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">netcdf_file</span><span class="p">)</span>

            <span class="c1"># Metadaten extrahieren</span>
            <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">netcdf_file</span><span class="p">)</span>

            <span class="c1"># NetCDF-Datei öffnen</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">input_netCDF</span><span class="p">)</span>
            <span class="n">latitudes</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
            <span class="n">longitudes</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
            <span class="n">time_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
            <span class="n">time_units</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>

            <span class="c1"># Falls Längenwerte im Bereich 0 bis 360 sind, konvertiere sie</span>
            <span class="n">longitudes</span> <span class="o">=</span> <span class="n">convert_longitudes</span><span class="p">(</span><span class="n">longitudes</span><span class="p">)</span>

            <span class="c1"># Finde die Indizes der zu verwendenden Breiten und Längen</span>
            <span class="k">if</span> <span class="n">latitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">latitudes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># Wenn die lat-Achse absteigend ist, umdrehen</span>
                <span class="n">latitudes</span> <span class="o">=</span> <span class="n">latitudes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">tas_data</span> <span class="o">=</span> <span class="n">get_data_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">indicator_variable_mapping</span><span class="p">[</span><span class="n">indicator</span><span class="p">][</span><span class="n">experiment</span><span class="p">])[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tas_data</span> <span class="o">=</span> <span class="n">get_data_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">indicator_variable_mapping</span><span class="p">[</span><span class="n">indicator</span><span class="p">][</span><span class="n">experiment</span><span class="p">])</span>

            <span class="n">lat_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">latitudes</span> <span class="o">&gt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;min_lat&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">latitudes</span> <span class="o">&lt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;max_lat&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lon_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">longitudes</span> <span class="o">&gt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;min_lon&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">longitudes</span> <span class="o">&lt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;max_lon&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Zuschneiden der Variablen auf die Indizes</span>
            <span class="n">tas_adjust_cropped</span> <span class="o">=</span> <span class="n">tas_data</span><span class="p">[:,</span> <span class="n">lat_inds</span><span class="p">,</span> <span class="p">:][:,</span> <span class="p">:,</span> <span class="n">lon_inds</span><span class="p">]</span>
            <span class="n">latitudes_cropped</span> <span class="o">=</span> <span class="n">latitudes</span><span class="p">[</span><span class="n">lat_inds</span><span class="p">]</span>
            <span class="n">longitudes_cropped</span> <span class="o">=</span> <span class="n">longitudes</span><span class="p">[</span><span class="n">lon_inds</span><span class="p">]</span>

            <span class="c1"># Berechne den Abstand zwischen den Längen- und Breitengraden</span>
            <span class="n">pixel_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">latitudes_cropped</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">latitudes_cropped</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pixel_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">longitudes_cropped</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">longitudes_cropped</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Transformationsparameter für die obere linke Ecke</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span>
                <span class="n">west</span><span class="o">=</span><span class="n">longitudes_cropped</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">pixel_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">north</span><span class="o">=</span><span class="n">latitudes_cropped</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">pixel_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">xsize</span><span class="o">=</span><span class="n">pixel_width</span><span class="p">,</span>
                <span class="n">ysize</span><span class="o">=</span><span class="n">pixel_height</span>
            <span class="p">)</span>

            <span class="c1"># Definiere das CRS (WGS84)</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

            <span class="c1"># Erstelle die GeoTIFFs</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time_var</span><span class="p">):</span>
                <span class="c1"># Erstelle den Dateinamen</span>
                <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_value</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">deg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">deg</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.tif&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.tif&#39;</span>

                <span class="c1"># Umkehren der vertikalen Achse (Flip Up-Down)</span>
                <span class="n">tas_adjust_flipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tas_adjust_cropped</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>

                <span class="c1"># Schreiben Sie die GeoTIFF-Datei</span>
                <span class="n">geotiff_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                    <span class="n">geotiff_path</span><span class="p">,</span>
                    <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                    <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">tas_adjust_flipped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">tas_adjust_flipped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="c1">#dtype=tas_adjust_flipped.dtype,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                    <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tas_adjust_flipped</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF für Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> gespeichert: &#39;</span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Datei schließen</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Verarbeiten der Datei </span><span class="si">{</span><span class="n">input_netCDF</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allgemeiner Fehler: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verfügbare NetCDF-Dateien:
1: 02_growing_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
2: 02_growing_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
3: 02_growing_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
4: 03_heating_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
5: 03_heating_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
6: 03_heating_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
7: 04_cooling_degree_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
8: 04_cooling_degree_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
9: 04_cooling_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
10: 05_tropical_nights-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
11: 05_tropical_nights-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
12: 05_tropical_nights-reanalysis-yearly-grid-1940-2023-v1.0.nc
13: 06_hot_days-projections-yearly-30deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
14: 06_hot_days-projections-yearly-30deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
15: 06_hot_days-projections-yearly-35deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
16: 06_hot_days-projections-yearly-35deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
17: 06_hot_days-projections-yearly-40deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
18: 06_hot_days-projections-yearly-40deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
19: 06_hot_days-reanalysis-yearly-30deg-grid-1940-2023-v1.0.nc
20: 06_hot_days-reanalysis-yearly-35deg-grid-1940-2023-v1.0.nc
21: 06_hot_days-reanalysis-yearly-40deg-grid-1940-2023-v1.0.nc
22: 07_warmest_three_day_period-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
23: 07_warmest_three_day_period-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
24: 07_warmest_three_day_period-reanalysis-yearly-grid-1940-2023-v1.0.nc
25: 09_heat_waves_climatological-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
26: 09_heat_waves_climatological-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
27: 09_heat_waves_climatological-reanalysis-yearly-grid-1940-2023-v1.0.nc
28: 10_high_utci_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
29: 11_frost_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
30: 11_frost_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
31: 11_frost_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
32: 12_total_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
33: 12_total_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
34: 12_total_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc
35: 13_maximum_five_days_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
36: 13_maximum_five_days_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
37: 13_maximum_five_days_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc
38: 14_extreme_precipitation_total-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
39: 14_extreme_precipitation_total-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
40: 14_extreme_precipitation_total-reanalysis-yearly-grid-1940-2023-v1.0.nc
41: 15_frequency_of_extreme_precipitation-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
42: 15_frequency_of_extreme_precipitation-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
43: 15_frequency_of_extreme_precipitation-reanalysis-yearly-grid-1940-2023-v1.0.nc
44: 18_consecutive_dry_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
45: 18_consecutive_dry_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
46: 18_consecutive_dry_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
47: 19_duration_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
48: 19_duration_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
49: 19_duration_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.nc
50: 20_magnitude_of_meteorological_droughts-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
51: 20_magnitude_of_meteorological_droughts-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
52: 20_magnitude_of_meteorological_droughts-reanalysis-yearly-grid-1940-2023-v1.0.nc
53: 22_days_with_high_fire_danger-projections-yearly-rcp_4_5-mpi_esm_lr-grid-v1.0.nc
54: 22_days_with_high_fire_danger-projections-yearly-rcp_8_5-mpi_esm_lr-grid-v1.0.nc
55: 22_days_with_high_fire_danger-reanalysis-yearly-grid-1979-2021-v1.0.nc
56: 24_extreme_wind_speed_days-projections-yearly-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
57: 24_extreme_wind_speed_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
58: 24_extreme_wind_speed_days-reanalysis-yearly-grid-1940-2023-v1.0.nc
59: l6_fire_weather_index-projections-yearly-rcp_4_5-mpi_esm_lr-grid-v1.0.nc
60: l6_fire_weather_index-projections-yearly-rcp_8_5-mpi_esm_lr-grid-v1.0.nc
61: l6_fire_weather_index-reanalysis-yearly-grid-1979-2021-v1.0.nc
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wähle die Nummern der zu verarbeitenden Dateien aus (mit Komma getrennt) oder &#39;alle&#39; für alle Dateien:  11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GeoTIFF für Jahr 1950 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1950.tif&#39;
GeoTIFF für Jahr 1951 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1951.tif&#39;
GeoTIFF für Jahr 1952 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1952.tif&#39;
GeoTIFF für Jahr 1953 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1953.tif&#39;
GeoTIFF für Jahr 1954 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1954.tif&#39;
GeoTIFF für Jahr 1955 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1955.tif&#39;
GeoTIFF für Jahr 1956 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1956.tif&#39;
GeoTIFF für Jahr 1957 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1957.tif&#39;
GeoTIFF für Jahr 1958 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1958.tif&#39;
GeoTIFF für Jahr 1959 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1959.tif&#39;
GeoTIFF für Jahr 1960 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1960.tif&#39;
GeoTIFF für Jahr 1961 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1961.tif&#39;
GeoTIFF für Jahr 1962 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1962.tif&#39;
GeoTIFF für Jahr 1963 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1963.tif&#39;
GeoTIFF für Jahr 1964 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1964.tif&#39;
GeoTIFF für Jahr 1965 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1965.tif&#39;
GeoTIFF für Jahr 1966 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1966.tif&#39;
GeoTIFF für Jahr 1967 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1967.tif&#39;
GeoTIFF für Jahr 1968 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1968.tif&#39;
GeoTIFF für Jahr 1969 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1969.tif&#39;
GeoTIFF für Jahr 1970 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1970.tif&#39;
GeoTIFF für Jahr 1971 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1971.tif&#39;
GeoTIFF für Jahr 1972 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1972.tif&#39;
GeoTIFF für Jahr 1973 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1973.tif&#39;
GeoTIFF für Jahr 1974 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1974.tif&#39;
GeoTIFF für Jahr 1975 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1975.tif&#39;
GeoTIFF für Jahr 1976 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1976.tif&#39;
GeoTIFF für Jahr 1977 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1977.tif&#39;
GeoTIFF für Jahr 1978 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1978.tif&#39;
GeoTIFF für Jahr 1979 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1979.tif&#39;
GeoTIFF für Jahr 1980 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1980.tif&#39;
GeoTIFF für Jahr 1981 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1981.tif&#39;
GeoTIFF für Jahr 1982 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1982.tif&#39;
GeoTIFF für Jahr 1983 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1983.tif&#39;
GeoTIFF für Jahr 1984 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1984.tif&#39;
GeoTIFF für Jahr 1985 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1985.tif&#39;
GeoTIFF für Jahr 1986 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1986.tif&#39;
GeoTIFF für Jahr 1987 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1987.tif&#39;
GeoTIFF für Jahr 1988 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1988.tif&#39;
GeoTIFF für Jahr 1989 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1989.tif&#39;
GeoTIFF für Jahr 1990 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1990.tif&#39;
GeoTIFF für Jahr 1991 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1991.tif&#39;
GeoTIFF für Jahr 1992 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1992.tif&#39;
GeoTIFF für Jahr 1993 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1993.tif&#39;
GeoTIFF für Jahr 1994 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1994.tif&#39;
GeoTIFF für Jahr 1995 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1995.tif&#39;
GeoTIFF für Jahr 1996 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1996.tif&#39;
GeoTIFF für Jahr 1997 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1997.tif&#39;
GeoTIFF für Jahr 1998 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1998.tif&#39;
GeoTIFF für Jahr 1999 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_1999.tif&#39;
GeoTIFF für Jahr 2000 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2000.tif&#39;
GeoTIFF für Jahr 2001 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2001.tif&#39;
GeoTIFF für Jahr 2002 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2002.tif&#39;
GeoTIFF für Jahr 2003 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2003.tif&#39;
GeoTIFF für Jahr 2004 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2004.tif&#39;
GeoTIFF für Jahr 2005 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2005.tif&#39;
GeoTIFF für Jahr 2006 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2006.tif&#39;
GeoTIFF für Jahr 2007 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2007.tif&#39;
GeoTIFF für Jahr 2008 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2008.tif&#39;
GeoTIFF für Jahr 2009 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2009.tif&#39;
GeoTIFF für Jahr 2010 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2010.tif&#39;
GeoTIFF für Jahr 2011 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2011.tif&#39;
GeoTIFF für Jahr 2012 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2012.tif&#39;
GeoTIFF für Jahr 2013 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2013.tif&#39;
GeoTIFF für Jahr 2014 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2014.tif&#39;
GeoTIFF für Jahr 2015 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2015.tif&#39;
GeoTIFF für Jahr 2016 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2016.tif&#39;
GeoTIFF für Jahr 2017 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2017.tif&#39;
GeoTIFF für Jahr 2018 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2018.tif&#39;
GeoTIFF für Jahr 2019 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2019.tif&#39;
GeoTIFF für Jahr 2020 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2020.tif&#39;
GeoTIFF für Jahr 2021 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2021.tif&#39;
GeoTIFF für Jahr 2022 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2022.tif&#39;
GeoTIFF für Jahr 2023 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2023.tif&#39;
GeoTIFF für Jahr 2024 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2024.tif&#39;
GeoTIFF für Jahr 2025 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2025.tif&#39;
GeoTIFF für Jahr 2026 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2026.tif&#39;
GeoTIFF für Jahr 2027 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2027.tif&#39;
GeoTIFF für Jahr 2028 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2028.tif&#39;
GeoTIFF für Jahr 2029 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2029.tif&#39;
GeoTIFF für Jahr 2030 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2030.tif&#39;
GeoTIFF für Jahr 2031 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2031.tif&#39;
GeoTIFF für Jahr 2032 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2032.tif&#39;
GeoTIFF für Jahr 2033 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2033.tif&#39;
GeoTIFF für Jahr 2034 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2034.tif&#39;
GeoTIFF für Jahr 2035 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2035.tif&#39;
GeoTIFF für Jahr 2036 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2036.tif&#39;
GeoTIFF für Jahr 2037 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2037.tif&#39;
GeoTIFF für Jahr 2038 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2038.tif&#39;
GeoTIFF für Jahr 2039 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2039.tif&#39;
GeoTIFF für Jahr 2040 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2040.tif&#39;
GeoTIFF für Jahr 2041 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2041.tif&#39;
GeoTIFF für Jahr 2042 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2042.tif&#39;
GeoTIFF für Jahr 2043 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2043.tif&#39;
GeoTIFF für Jahr 2044 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2044.tif&#39;
GeoTIFF für Jahr 2045 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2045.tif&#39;
GeoTIFF für Jahr 2046 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2046.tif&#39;
GeoTIFF für Jahr 2047 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2047.tif&#39;
GeoTIFF für Jahr 2048 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2048.tif&#39;
GeoTIFF für Jahr 2049 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2049.tif&#39;
GeoTIFF für Jahr 2050 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2050.tif&#39;
GeoTIFF für Jahr 2051 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2051.tif&#39;
GeoTIFF für Jahr 2052 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2052.tif&#39;
GeoTIFF für Jahr 2053 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2053.tif&#39;
GeoTIFF für Jahr 2054 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2054.tif&#39;
GeoTIFF für Jahr 2055 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2055.tif&#39;
GeoTIFF für Jahr 2056 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2056.tif&#39;
GeoTIFF für Jahr 2057 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2057.tif&#39;
GeoTIFF für Jahr 2058 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2058.tif&#39;
GeoTIFF für Jahr 2059 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2059.tif&#39;
GeoTIFF für Jahr 2060 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2060.tif&#39;
GeoTIFF für Jahr 2061 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2061.tif&#39;
GeoTIFF für Jahr 2062 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2062.tif&#39;
GeoTIFF für Jahr 2063 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2063.tif&#39;
GeoTIFF für Jahr 2064 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2064.tif&#39;
GeoTIFF für Jahr 2065 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2065.tif&#39;
GeoTIFF für Jahr 2066 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2066.tif&#39;
GeoTIFF für Jahr 2067 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2067.tif&#39;
GeoTIFF für Jahr 2068 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2068.tif&#39;
GeoTIFF für Jahr 2069 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2069.tif&#39;
GeoTIFF für Jahr 2070 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2070.tif&#39;
GeoTIFF für Jahr 2071 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2071.tif&#39;
GeoTIFF für Jahr 2072 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2072.tif&#39;
GeoTIFF für Jahr 2073 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2073.tif&#39;
GeoTIFF für Jahr 2074 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2074.tif&#39;
GeoTIFF für Jahr 2075 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2075.tif&#39;
GeoTIFF für Jahr 2076 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2076.tif&#39;
GeoTIFF für Jahr 2077 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2077.tif&#39;
GeoTIFF für Jahr 2078 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2078.tif&#39;
GeoTIFF für Jahr 2079 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2079.tif&#39;
GeoTIFF für Jahr 2080 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2080.tif&#39;
GeoTIFF für Jahr 2081 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2081.tif&#39;
GeoTIFF für Jahr 2082 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2082.tif&#39;
GeoTIFF für Jahr 2083 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2083.tif&#39;
GeoTIFF für Jahr 2084 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2084.tif&#39;
GeoTIFF für Jahr 2085 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2085.tif&#39;
GeoTIFF für Jahr 2086 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2086.tif&#39;
GeoTIFF für Jahr 2087 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2087.tif&#39;
GeoTIFF für Jahr 2088 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2088.tif&#39;
GeoTIFF für Jahr 2089 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2089.tif&#39;
GeoTIFF für Jahr 2090 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2090.tif&#39;
GeoTIFF für Jahr 2091 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2091.tif&#39;
GeoTIFF für Jahr 2092 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2092.tif&#39;
GeoTIFF für Jahr 2093 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2093.tif&#39;
GeoTIFF für Jahr 2094 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2094.tif&#39;
GeoTIFF für Jahr 2095 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2095.tif&#39;
GeoTIFF für Jahr 2096 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2096.tif&#39;
GeoTIFF für Jahr 2097 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2097.tif&#39;
GeoTIFF für Jahr 2098 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2098.tif&#39;
GeoTIFF für Jahr 2099 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2099.tif&#39;
GeoTIFF für Jahr 2100 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\05_tropical_nights_projections_rcp_8_5_2100.tif&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.transform</span> <span class="kn">import</span> <span class="n">from_origin</span>
<span class="kn">from</span> <span class="nn">rasterio.crs</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">num2date</span>

<span class="c1"># Define the working folder and output folder (make sure these are defined)</span>
<span class="c1"># working_folder = &#39;path/to/working_folder&#39;</span>
<span class="c1"># output_folder = &#39;path/to/output_folder&#39;</span>

<span class="c1"># Liste aller NetCDF-Dateien im Arbeitsordner</span>
<span class="n">netcdf_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span>

<span class="c1"># Dateien nach Indikatoren gruppieren</span>
<span class="n">grouped_files</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">netcdf_files</span><span class="p">:</span>
    <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indicator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">grouped_files</span><span class="p">:</span>
        <span class="n">grouped_files</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">grouped_files</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>

<span class="c1"># Anzeige der verfügbaren Indikatoren und Auswahl durch den Benutzer</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Verfügbare Indikatoren:&quot;</span><span class="p">)</span>
<span class="n">indicators</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">grouped_files</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indicators</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">indicator_selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wähle die Nummer des Indikators aus: &quot;</span><span class="p">)</span>
<span class="n">selected_indicator</span> <span class="o">=</span> <span class="n">indicators</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">indicator_selection</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Anzeige der Dateien innerhalb des ausgewählten Indikators</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Verfügbare Dateien für &#39;</span><span class="si">{</span><span class="n">selected_indicator</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">grouped_files</span><span class="p">[</span><span class="n">selected_indicator</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">file_selection</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wähle die Nummern der zu verarbeitenden Dateien aus (mit Komma getrennt) oder &#39;alle&#39; für alle Dateien: &quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">file_selection</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;alle&#39;</span><span class="p">:</span>
    <span class="n">selected_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">selected_indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">file_selection</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
    <span class="n">selected_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">selected_indices</span><span class="p">]</span>


<span class="c1"># Mapping von Indikator-Variablen</span>
<span class="n">indicator_variable_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;02_growing_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;03_heating_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;04_cooling_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;05_tropical_nights&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;07_warmest_three_day_period&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;09_heat_waves_climatological&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;high_utci_days&quot;</span><span class="p">},</span>
    <span class="s2">&quot;11_frost_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;12_total_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;prAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;13_maximum_five_days_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;tp&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;prAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;14_extreme_precipitation_total&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;15_frequency_of_extreme_precipitation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;18_consecutive_dry_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;cdd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;cdd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;19_duration_of_meteorological_droughts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;20_magnitude_of_meteorological_droughts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;dmd&quot;</span><span class="p">},</span>
    <span class="s2">&quot;22_days_with_high_fire_danger&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;fwi&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;24_extreme_wind_speed_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Deutschland Begrenzungen (in Grad)</span>
<span class="n">germany_bounds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;min_lon&#39;</span><span class="p">:</span> <span class="mf">5.866</span><span class="p">,</span>  <span class="c1"># westliche Grenze</span>
    <span class="s1">&#39;max_lon&#39;</span><span class="p">:</span> <span class="mf">15.042</span><span class="p">,</span>  <span class="c1"># östliche Grenze</span>
    <span class="s1">&#39;min_lat&#39;</span><span class="p">:</span> <span class="mf">47.270</span><span class="p">,</span>  <span class="c1"># südliche Grenze</span>
    <span class="s1">&#39;max_lat&#39;</span><span class="p">:</span> <span class="mf">55.058</span>   <span class="c1"># nördliche Grenze</span>
<span class="p">}</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span>

<span class="c1"># Konvertiere Längenwerte von 0-360 nach -180 bis 180, falls erforderlich</span>
<span class="k">def</span> <span class="nf">convert_longitudes</span><span class="p">(</span><span class="n">lons</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">lons</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>

<span class="c1"># Funktion zur Handhabung von 2D- oder 3D-Variablen</span>
<span class="k">def</span> <span class="nf">get_data_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable_name</span><span class="p">):</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var</span><span class="p">[:,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unerwartete Dimension der Variable </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Schleife über alle ausgewählten NetCDF-Dateien</span>
    <span class="k">for</span> <span class="n">netcdf_file</span> <span class="ow">in</span> <span class="n">selected_files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Datei-Pfad</span>
            <span class="n">input_netCDF</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">netcdf_file</span><span class="p">)</span>

            <span class="c1"># Metadaten extrahieren</span>
            <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">netcdf_file</span><span class="p">)</span>

            <span class="c1"># NetCDF-Datei öffnen</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">input_netCDF</span><span class="p">)</span>
            <span class="n">latitudes</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
            <span class="n">longitudes</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
            <span class="n">time_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
            <span class="n">time_units</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>

            <span class="c1"># Falls Längenwerte im Bereich 0 bis 360 sind, konvertiere sie</span>
            <span class="n">longitudes</span> <span class="o">=</span> <span class="n">convert_longitudes</span><span class="p">(</span><span class="n">longitudes</span><span class="p">)</span>

            <span class="c1"># Finde die Indizes der zu verwendenden Breiten und Längen</span>
            <span class="k">if</span> <span class="n">latitudes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">latitudes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># Wenn die lat-Achse absteigend ist, umdrehen</span>
                <span class="n">latitudes</span> <span class="o">=</span> <span class="n">latitudes</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">tas_data</span> <span class="o">=</span> <span class="n">get_data_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">indicator_variable_mapping</span><span class="p">[</span><span class="n">indicator</span><span class="p">][</span><span class="n">experiment</span><span class="p">])[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tas_data</span> <span class="o">=</span> <span class="n">get_data_variable</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">indicator_variable_mapping</span><span class="p">[</span><span class="n">indicator</span><span class="p">][</span><span class="n">experiment</span><span class="p">])</span>

            <span class="n">lat_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">latitudes</span> <span class="o">&gt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;min_lat&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">latitudes</span> <span class="o">&lt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;max_lat&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lon_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">longitudes</span> <span class="o">&gt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;min_lon&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">longitudes</span> <span class="o">&lt;=</span> <span class="n">germany_bounds</span><span class="p">[</span><span class="s1">&#39;max_lon&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Zuschneiden der Variablen auf die Indizes</span>
            <span class="n">tas_adjust_cropped</span> <span class="o">=</span> <span class="n">tas_data</span><span class="p">[:,</span> <span class="n">lat_inds</span><span class="p">,</span> <span class="p">:][:,</span> <span class="p">:,</span> <span class="n">lon_inds</span><span class="p">]</span>
            <span class="n">latitudes_cropped</span> <span class="o">=</span> <span class="n">latitudes</span><span class="p">[</span><span class="n">lat_inds</span><span class="p">]</span>
            <span class="n">longitudes_cropped</span> <span class="o">=</span> <span class="n">longitudes</span><span class="p">[</span><span class="n">lon_inds</span><span class="p">]</span>

            <span class="c1"># Berechne den Abstand zwischen den Längen- und Breitengraden</span>
            <span class="n">pixel_height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">latitudes_cropped</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">latitudes_cropped</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pixel_width</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">longitudes_cropped</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">longitudes_cropped</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="c1"># Transformationsparameter für die obere linke Ecke</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span>
                <span class="n">west</span><span class="o">=</span><span class="n">longitudes_cropped</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">pixel_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">north</span><span class="o">=</span><span class="n">latitudes_cropped</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">pixel_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">xsize</span><span class="o">=</span><span class="n">pixel_width</span><span class="p">,</span>
                <span class="n">ysize</span><span class="o">=</span><span class="n">pixel_height</span>
            <span class="p">)</span>

            <span class="c1"># Definiere das CRS (WGS84)</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

            <span class="c1"># Erstelle die GeoTIFFs</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time_var</span><span class="p">):</span>
                <span class="c1"># Erstelle den Dateinamen</span>
                <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_value</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">deg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">deg</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.tif&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.tif&#39;</span>

                <span class="c1"># Umkehren der vertikalen Achse (Flip Up-Down)</span>
                <span class="n">tas_adjust_flipped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">tas_adjust_cropped</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>

                <span class="c1"># Schreiben Sie die GeoTIFF-Datei</span>
                <span class="n">geotiff_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                    <span class="n">geotiff_path</span><span class="p">,</span>
                    <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                    <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">tas_adjust_flipped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">tas_adjust_flipped</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="c1">#dtype=tas_adjust_flipped.dtype,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">,</span>
                    <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tas_adjust_flipped</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF für Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> gespeichert: &#39;</span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

            <span class="c1"># Datei schließen</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Verarbeiten der Datei </span><span class="si">{</span><span class="n">input_netCDF</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allgemeiner Fehler: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verfügbare Indikatoren:
1: 02_growing_degree_days
2: 03_heating_degree_days
3: 04_cooling_degree_days
4: 05_tropical_nights
5: 06_hot_days
6: 07_warmest_three_day_period
7: 09_heat_waves_climatological
8: 10_high_utci_days
9: 11_frost_days
10: 12_total_precipitation
11: 13_maximum_five_days_precipitation
12: 14_extreme_precipitation_total
13: 15_frequency_of_extreme_precipitation
14: 18_consecutive_dry_days
15: 19_duration_of_meteorological_droughts
16: 20_magnitude_of_meteorological_droughts
17: 22_days_with_high_fire_danger
18: 24_extreme_wind_speed_days
19: l6_fire_weather_index
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wähle die Nummer des Indikators aus:  5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verfügbare Dateien für &#39;06_hot_days&#39;:
1: projections - 30deg - 06_hot_days-projections-yearly-30deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
2: projections - 30deg - 06_hot_days-projections-yearly-30deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
3: projections - 35deg - 06_hot_days-projections-yearly-35deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
4: projections - 35deg - 06_hot_days-projections-yearly-35deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
5: projections - 40deg - 06_hot_days-projections-yearly-40deg-rcp_4_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
6: projections - 40deg - 06_hot_days-projections-yearly-40deg-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.nc
7: reanalysis - historical - 06_hot_days-reanalysis-yearly-30deg-grid-1940-2023-v1.0.nc
8: reanalysis - historical - 06_hot_days-reanalysis-yearly-35deg-grid-1940-2023-v1.0.nc
9: reanalysis - historical - 06_hot_days-reanalysis-yearly-40deg-grid-1940-2023-v1.0.nc
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wähle die Nummern der zu verarbeitenden Dateien aus (mit Komma getrennt) oder &#39;alle&#39; für alle Dateien:  1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GeoTIFF für Jahr 1950 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1950.tif&#39;
GeoTIFF für Jahr 1951 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1951.tif&#39;
GeoTIFF für Jahr 1952 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1952.tif&#39;
GeoTIFF für Jahr 1953 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1953.tif&#39;
GeoTIFF für Jahr 1954 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1954.tif&#39;
GeoTIFF für Jahr 1955 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1955.tif&#39;
GeoTIFF für Jahr 1956 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1956.tif&#39;
GeoTIFF für Jahr 1957 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1957.tif&#39;
GeoTIFF für Jahr 1958 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1958.tif&#39;
GeoTIFF für Jahr 1959 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1959.tif&#39;
GeoTIFF für Jahr 1960 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1960.tif&#39;
GeoTIFF für Jahr 1961 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1961.tif&#39;
GeoTIFF für Jahr 1962 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1962.tif&#39;
GeoTIFF für Jahr 1963 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1963.tif&#39;
GeoTIFF für Jahr 1964 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1964.tif&#39;
GeoTIFF für Jahr 1965 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1965.tif&#39;
GeoTIFF für Jahr 1966 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1966.tif&#39;
GeoTIFF für Jahr 1967 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1967.tif&#39;
GeoTIFF für Jahr 1968 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1968.tif&#39;
GeoTIFF für Jahr 1969 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1969.tif&#39;
GeoTIFF für Jahr 1970 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1970.tif&#39;
GeoTIFF für Jahr 1971 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1971.tif&#39;
GeoTIFF für Jahr 1972 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1972.tif&#39;
GeoTIFF für Jahr 1973 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1973.tif&#39;
GeoTIFF für Jahr 1974 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1974.tif&#39;
GeoTIFF für Jahr 1975 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1975.tif&#39;
GeoTIFF für Jahr 1976 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1976.tif&#39;
GeoTIFF für Jahr 1977 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1977.tif&#39;
GeoTIFF für Jahr 1978 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1978.tif&#39;
GeoTIFF für Jahr 1979 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1979.tif&#39;
GeoTIFF für Jahr 1980 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1980.tif&#39;
GeoTIFF für Jahr 1981 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1981.tif&#39;
GeoTIFF für Jahr 1982 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1982.tif&#39;
GeoTIFF für Jahr 1983 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1983.tif&#39;
GeoTIFF für Jahr 1984 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1984.tif&#39;
GeoTIFF für Jahr 1985 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1985.tif&#39;
GeoTIFF für Jahr 1986 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1986.tif&#39;
GeoTIFF für Jahr 1987 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1987.tif&#39;
GeoTIFF für Jahr 1988 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1988.tif&#39;
GeoTIFF für Jahr 1989 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1989.tif&#39;
GeoTIFF für Jahr 1990 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1990.tif&#39;
GeoTIFF für Jahr 1991 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1991.tif&#39;
GeoTIFF für Jahr 1992 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1992.tif&#39;
GeoTIFF für Jahr 1993 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1993.tif&#39;
GeoTIFF für Jahr 1994 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1994.tif&#39;
GeoTIFF für Jahr 1995 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1995.tif&#39;
GeoTIFF für Jahr 1996 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1996.tif&#39;
GeoTIFF für Jahr 1997 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1997.tif&#39;
GeoTIFF für Jahr 1998 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1998.tif&#39;
GeoTIFF für Jahr 1999 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_1999.tif&#39;
GeoTIFF für Jahr 2000 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2000.tif&#39;
GeoTIFF für Jahr 2001 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2001.tif&#39;
GeoTIFF für Jahr 2002 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2002.tif&#39;
GeoTIFF für Jahr 2003 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2003.tif&#39;
GeoTIFF für Jahr 2004 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2004.tif&#39;
GeoTIFF für Jahr 2005 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2005.tif&#39;
GeoTIFF für Jahr 2006 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2006.tif&#39;
GeoTIFF für Jahr 2007 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2007.tif&#39;
GeoTIFF für Jahr 2008 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2008.tif&#39;
GeoTIFF für Jahr 2009 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2009.tif&#39;
GeoTIFF für Jahr 2010 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2010.tif&#39;
GeoTIFF für Jahr 2011 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2011.tif&#39;
GeoTIFF für Jahr 2012 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2012.tif&#39;
GeoTIFF für Jahr 2013 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2013.tif&#39;
GeoTIFF für Jahr 2014 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2014.tif&#39;
GeoTIFF für Jahr 2015 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2015.tif&#39;
GeoTIFF für Jahr 2016 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2016.tif&#39;
GeoTIFF für Jahr 2017 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2017.tif&#39;
GeoTIFF für Jahr 2018 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2018.tif&#39;
GeoTIFF für Jahr 2019 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2019.tif&#39;
GeoTIFF für Jahr 2020 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2020.tif&#39;
GeoTIFF für Jahr 2021 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2021.tif&#39;
GeoTIFF für Jahr 2022 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2022.tif&#39;
GeoTIFF für Jahr 2023 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2023.tif&#39;
GeoTIFF für Jahr 2024 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2024.tif&#39;
GeoTIFF für Jahr 2025 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2025.tif&#39;
GeoTIFF für Jahr 2026 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2026.tif&#39;
GeoTIFF für Jahr 2027 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2027.tif&#39;
GeoTIFF für Jahr 2028 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2028.tif&#39;
GeoTIFF für Jahr 2029 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2029.tif&#39;
GeoTIFF für Jahr 2030 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2030.tif&#39;
GeoTIFF für Jahr 2031 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2031.tif&#39;
GeoTIFF für Jahr 2032 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2032.tif&#39;
GeoTIFF für Jahr 2033 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2033.tif&#39;
GeoTIFF für Jahr 2034 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2034.tif&#39;
GeoTIFF für Jahr 2035 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2035.tif&#39;
GeoTIFF für Jahr 2036 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2036.tif&#39;
GeoTIFF für Jahr 2037 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2037.tif&#39;
GeoTIFF für Jahr 2038 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2038.tif&#39;
GeoTIFF für Jahr 2039 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2039.tif&#39;
GeoTIFF für Jahr 2040 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2040.tif&#39;
GeoTIFF für Jahr 2041 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2041.tif&#39;
GeoTIFF für Jahr 2042 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2042.tif&#39;
GeoTIFF für Jahr 2043 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2043.tif&#39;
GeoTIFF für Jahr 2044 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2044.tif&#39;
GeoTIFF für Jahr 2045 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2045.tif&#39;
GeoTIFF für Jahr 2046 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2046.tif&#39;
GeoTIFF für Jahr 2047 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2047.tif&#39;
GeoTIFF für Jahr 2048 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2048.tif&#39;
GeoTIFF für Jahr 2049 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2049.tif&#39;
GeoTIFF für Jahr 2050 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2050.tif&#39;
GeoTIFF für Jahr 2051 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2051.tif&#39;
GeoTIFF für Jahr 2052 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2052.tif&#39;
GeoTIFF für Jahr 2053 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2053.tif&#39;
GeoTIFF für Jahr 2054 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2054.tif&#39;
GeoTIFF für Jahr 2055 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2055.tif&#39;
GeoTIFF für Jahr 2056 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2056.tif&#39;
GeoTIFF für Jahr 2057 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2057.tif&#39;
GeoTIFF für Jahr 2058 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2058.tif&#39;
GeoTIFF für Jahr 2059 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2059.tif&#39;
GeoTIFF für Jahr 2060 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2060.tif&#39;
GeoTIFF für Jahr 2061 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2061.tif&#39;
GeoTIFF für Jahr 2062 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2062.tif&#39;
GeoTIFF für Jahr 2063 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2063.tif&#39;
GeoTIFF für Jahr 2064 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2064.tif&#39;
GeoTIFF für Jahr 2065 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2065.tif&#39;
GeoTIFF für Jahr 2066 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2066.tif&#39;
GeoTIFF für Jahr 2067 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2067.tif&#39;
GeoTIFF für Jahr 2068 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2068.tif&#39;
GeoTIFF für Jahr 2069 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2069.tif&#39;
GeoTIFF für Jahr 2070 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2070.tif&#39;
GeoTIFF für Jahr 2071 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2071.tif&#39;
GeoTIFF für Jahr 2072 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2072.tif&#39;
GeoTIFF für Jahr 2073 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2073.tif&#39;
GeoTIFF für Jahr 2074 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2074.tif&#39;
GeoTIFF für Jahr 2075 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2075.tif&#39;
GeoTIFF für Jahr 2076 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2076.tif&#39;
GeoTIFF für Jahr 2077 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2077.tif&#39;
GeoTIFF für Jahr 2078 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2078.tif&#39;
GeoTIFF für Jahr 2079 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2079.tif&#39;
GeoTIFF für Jahr 2080 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2080.tif&#39;
GeoTIFF für Jahr 2081 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2081.tif&#39;
GeoTIFF für Jahr 2082 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2082.tif&#39;
GeoTIFF für Jahr 2083 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2083.tif&#39;
GeoTIFF für Jahr 2084 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2084.tif&#39;
GeoTIFF für Jahr 2085 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2085.tif&#39;
GeoTIFF für Jahr 2086 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2086.tif&#39;
GeoTIFF für Jahr 2087 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2087.tif&#39;
GeoTIFF für Jahr 2088 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2088.tif&#39;
GeoTIFF für Jahr 2089 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2089.tif&#39;
GeoTIFF für Jahr 2090 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2090.tif&#39;
GeoTIFF für Jahr 2091 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2091.tif&#39;
GeoTIFF für Jahr 2092 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2092.tif&#39;
GeoTIFF für Jahr 2093 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2093.tif&#39;
GeoTIFF für Jahr 2094 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2094.tif&#39;
GeoTIFF für Jahr 2095 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2095.tif&#39;
GeoTIFF für Jahr 2096 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2096.tif&#39;
GeoTIFF für Jahr 2097 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2097.tif&#39;
GeoTIFF für Jahr 2098 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2098.tif&#39;
GeoTIFF für Jahr 2099 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2099.tif&#39;
GeoTIFF für Jahr 2100 gespeichert: &#39;C:\Users\timte\Documents\Python\Climate Indicators\Results\06_hot_days_30deg_projections_rcp_4_5_2100.tif&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Downscaling auf AOI Bodensee mit 1000 x 1000 m Auflösung</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.transform</span> <span class="kn">import</span> <span class="n">from_origin</span>
<span class="kn">from</span> <span class="nn">rasterio.crs</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">from</span> <span class="nn">rasterio.enums</span> <span class="kn">import</span> <span class="n">Resampling</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">reproject</span><span class="p">,</span> <span class="n">Resampling</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">num2date</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c1"># Definiere den Zielbereich (AOI) durch Koordinaten für den Bodensee</span>
<span class="c1"># min_lon = 7.5 # 8.9 Bodensee</span>
<span class="c1"># max_lon = 10.5 # 10.3 Bodensee</span>
<span class="c1"># min_lat = 47.5 # 47.3 Bodensee</span>
<span class="c1"># max_lat = 49.8 # 48.0 Bodensee</span>

<span class="n">min_lon</span> <span class="o">=</span> <span class="mf">12.2731</span> <span class="c1"># Leipzig</span>
<span class="n">max_lon</span> <span class="o">=</span> <span class="mf">12.4731</span> <span class="c1"># Leipzig</span>
<span class="n">min_lat</span> <span class="o">=</span> <span class="mf">51.2397</span> <span class="c1"># Leipzig</span>
<span class="n">max_lat</span> <span class="o">=</span> <span class="mf">51.4397</span> <span class="c1"># Leipzig</span>


<span class="c1"># Definiere die Auflösung des Zielrasters</span>
<span class="n">target_res</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># in Metern</span>

<span class="c1"># NetCDF-Datei öffnen</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">input_netCDF</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
<span class="n">time_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="n">time_units</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>  <span class="c1"># Zeit-Einheiten ablesen</span>

<span class="c1"># Bestimme die Pixelgröße und den Ursprung</span>
<span class="n">pixel_size_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pixel_size_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">pixel_size_lon</span><span class="p">,</span> <span class="n">pixel_size_lat</span><span class="p">)</span>

<span class="c1"># Definiere das CRS (WGS84)</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

<span class="c1"># Berechne die Dimensionen des Zielrasters</span>
<span class="n">target_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_lon</span> <span class="o">-</span> <span class="n">min_lon</span><span class="p">)</span> <span class="o">*</span> <span class="mi">111320</span> <span class="o">/</span> <span class="n">target_res</span><span class="p">)</span>  <span class="c1"># 1 Grad entspricht ca. 111320 Meter</span>
<span class="n">target_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_lat</span> <span class="o">-</span> <span class="n">min_lat</span><span class="p">)</span> <span class="o">*</span> <span class="mi">110574</span> <span class="o">/</span> <span class="n">target_res</span><span class="p">)</span>  <span class="c1"># 1 Grad entspricht ca. 110574 Meter</span>

<span class="c1"># Berechne die Transformationsmatrix für das Zielraster</span>
<span class="n">target_transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">target_res</span> <span class="o">/</span> <span class="mi">111320</span><span class="p">,</span> <span class="n">target_res</span> <span class="o">/</span> <span class="mi">110574</span><span class="p">)</span>

<span class="c1"># Unterordner für unprozessierte GeoTIFFs erstellen</span>
<span class="n">unprocessed_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s1">&#39;unprocessed&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">unprocessed_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Unterordner für heruntergerechnete GeoTIFFs erstellen</span>
<span class="n">downscaled_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s1">&#39;downscaled&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">downscaled_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Schleife über alle Zeitdaten</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_var</span><span class="p">)):</span>
        <span class="c1"># Daten für den aktuellen Zeitstempel lesen</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="c1"># Jahr aus der Zeitvariable extrahieren</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">time_units</span><span class="p">)</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

        <span class="c1"># Speichern als unprozessierter GeoTIFF</span>
        <span class="n">geotiff_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unprocessed_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.tiff&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="n">geotiff_path</span><span class="p">,</span>
            <span class="s1">&#39;w&#39;</span><span class="p">,</span>
            <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Bild um 180° drehen und von links nach rechts spiegeln</span>
        <span class="n">rotated_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">flipped_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">rotated_data</span><span class="p">)</span>

        <span class="c1"># Speichern des bearbeiteten GeoTIFFs</span>
        <span class="n">processed_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_processed.tiff&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="n">processed_path</span><span class="p">,</span>
            <span class="s1">&#39;w&#39;</span><span class="p">,</span>
            <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">flipped_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">flipped_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">flipped_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">flipped_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF für Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> gespeichert: &#39;</span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2">&#39; und bearbeitet als &#39;</span><span class="si">{</span><span class="n">processed_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Downscaling der GeoTIFF-Datei</span>
        <span class="n">downscaled_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">downscaled_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_downscaled.tiff&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">processed_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="c1"># Erstelle die neue Datei</span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                <span class="n">downscaled_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">target_height</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">target_width</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">target_transform</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
                <span class="c1"># Reprojectiere die Daten mit linearer Interpolation</span>
                <span class="n">reproject</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">destination</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">src_transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                    <span class="n">src_crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">dst_transform</span><span class="o">=</span><span class="n">target_transform</span><span class="p">,</span>
                    <span class="n">dst_crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span>
                <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Heruntergerechneter GeoTIFF für Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> gespeichert als: &#39;</span><span class="si">{</span><span class="n">downscaled_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Datei schließen</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Löschen des unprozessierten Ordners und seiner Inhalte</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">unprocessed_dir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Der Ordner &#39;</span><span class="si">{</span><span class="n">unprocessed_dir</span><span class="si">}</span><span class="s2">&#39; und seine Inhalte wurden gelöscht.&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Öffnen der Datei </span><span class="si">{</span><span class="n">input_netCDF</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="e-zeitreihen-als-gif-darstellen-unvollstandig-netcdf-gif">
<h2>E. Zeitreihen als GIF darstellen (UNVOLLSTÄNDIG) [netCDF -&gt; Gif]<a class="headerlink" href="#e-zeitreihen-als-gif-darstellen-unvollstandig-netcdf-gif" title="Link to this heading"></a></h2>
<p>Bei origin = projections wird der Zeitraum 2024 - 2100 geplottet, für reanalysis 1940 - 2023. Um den Zeitraum 1940 - 2100 als GIF zu erhalten, den Schritt 3.1 für origin und projection ausführen. Aktuell fixe Legende / colorbar von vmin = 0 bis vmax = 20</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>

<span class="k">def</span> <span class="nf">create_map</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">output_path</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;contourf&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and save a plot with Basemap.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - lat: Latitude values</span>
<span class="sd">    - lon: Longitude values</span>
<span class="sd">    - data: Data to plot</span>
<span class="sd">    - title: Plot title</span>
<span class="sd">    - output_path: Path to save the plot</span>
<span class="sd">    - cmap: Colormap</span>
<span class="sd">    - vmin: Minimum value of the colormap</span>
<span class="sd">    - vmax: Maximum value of the colormap</span>
<span class="sd">    - plot_type: Type of plot (&#39;contourf&#39; or &#39;imshow&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create Basemap for Germany</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;merc&#39;</span><span class="p">,</span> <span class="n">llcrnrlat</span><span class="o">=</span><span class="mf">47.3</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="mf">55.0</span><span class="p">,</span>
                    <span class="n">llcrnrlon</span><span class="o">=</span><span class="mf">5.9</span><span class="p">,</span> <span class="n">urcrnrlon</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>

        <span class="c1"># Add rivers, coastlines, and country borders</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawrivers</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">drawcountries</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        
        <span class="c1"># Coordinates for major German cities</span>
        <span class="c1"># cities = {</span>
        <span class="c1">#     &#39;Berlin&#39;: (52.52, 13.405),</span>
        <span class="c1">#     &#39;Hamburg&#39;: (53.551, 9.993),</span>
        <span class="c1">#     &#39;München&#39;: (48.135, 11.582),</span>
        <span class="c1">#     &#39;Stuttgart&#39;: (48.775, 9.182),</span>
        <span class="c1">#     &#39;Düsseldorf&#39;: (51.225, 6.776),</span>
        <span class="c1">#     &#39;Wiesbaden&#39;: (50.082, 8.241),</span>
        <span class="c1">#     &#39;Schwerin&#39;: (53.635, 11.412),</span>
        <span class="c1">#     &#39;Hannover&#39;: (52.374, 9.738),</span>
        <span class="c1">#     &#39;Saarbrücken&#39;: (49.234, 6.997),</span>
        <span class="c1">#     &#39;Dresden&#39;: (51.050, 13.737),</span>
        <span class="c1">#     &#39;Magdeburg&#39;: (52.120, 11.629),</span>
        <span class="c1">#     &#39;Kiel&#39;: (54.323, 10.139),</span>
        <span class="c1">#     &#39;Erfurt&#39;: (50.978, 11.029),</span>
        <span class="c1">#     &#39;Bremen&#39;: (53.075, 8.807),</span>
        <span class="c1"># }</span>

        <span class="n">cities</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Berlin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">52.520</span><span class="p">,</span> <span class="mf">13.405</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Hamburg&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">53.551</span><span class="p">,</span> <span class="mf">9.993</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;München&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">48.135</span><span class="p">,</span> <span class="mf">11.582</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Stuttgart&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">48.775</span><span class="p">,</span> <span class="mf">9.182</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Düsseldorf&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">51.225</span><span class="p">,</span> <span class="mf">6.776</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Wiesbaden&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">50.082</span><span class="p">,</span> <span class="mf">8.241</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Schwerin&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">53.635</span><span class="p">,</span> <span class="mf">11.412</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Hannover&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">52.374</span><span class="p">,</span> <span class="mf">9.738</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Saarbrücken&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">49.234</span><span class="p">,</span> <span class="mf">6.997</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Dresden&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">51.050</span><span class="p">,</span> <span class="mf">13.737</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Magdeburg&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">52.120</span><span class="p">,</span> <span class="mf">11.629</span><span class="p">,</span> <span class="o">-</span><span class="mi">50000</span><span class="p">,</span> <span class="o">-</span><span class="mi">40000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Kiel&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">54.323</span><span class="p">,</span> <span class="mf">10.139</span><span class="p">,</span> <span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="o">-</span><span class="mi">35000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Erfurt&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">50.978</span><span class="p">,</span> <span class="mf">11.029</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Bremen&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">53.075</span><span class="p">,</span> <span class="mf">8.807</span><span class="p">,</span> <span class="o">-</span><span class="mi">20000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Potsdam&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">52.390</span><span class="p">,</span> <span class="mf">13.064</span><span class="p">,</span> <span class="o">-</span><span class="mi">50000</span><span class="p">,</span> <span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="s1">&#39;Mainz&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">50.000</span><span class="p">,</span> <span class="mf">8.271</span><span class="p">,</span> <span class="o">-</span><span class="mi">55000</span><span class="p">,</span> <span class="o">-</span><span class="mi">30000</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Plot cities on the map</span>
        <span class="k">for</span> <span class="n">city</span><span class="p">,</span> <span class="p">(</span><span class="n">lat_city</span><span class="p">,</span> <span class="n">lon_city</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lon_city</span><span class="p">,</span> <span class="n">lat_city</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">15000</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

        <span class="c1"># Plot the data</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
        <span class="n">data_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># Set color for invalid values to transparent</span>

        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;contourf&#39;</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data_masked</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;imshow&#39;</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_masked</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lon</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                     <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

        <span class="c1"># Add a title above the plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,)</span>
        <span class="c1"># Adjust spacing to reduce gap between plot and title</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.94</span><span class="p">)</span>  <span class="c1"># Adjust the top parameter to bring the title closer</span>

        <span class="c1"># Adjust the position of the colorbar</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">])</span>  <span class="c1"># Moved closer by reducing the first value</span>

        <span class="c1"># Create the colorbar</span>
        <span class="n">cb</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># Add label to the colorbar</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Erstellen des Plots für </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">input_netCDF</span>
    <span class="c1">#output_folder = r&#39;C:\Users\timte\Documents\Python\HWD\PNG&#39;</span>
    <span class="c1">#os.makedirs(output_folder, exist_ok=True)</span>

    <span class="n">dataset2</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="n">time_var</span> <span class="o">=</span> <span class="n">dataset2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">time_units</span> <span class="o">=</span> <span class="n">time_var</span><span class="o">.</span><span class="n">units</span>
    <span class="n">time_data</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>

    <span class="n">variable_name</span> <span class="o">=</span> <span class="n">variable</span>
    <span class="n">global_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">global_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Determine the time range based on the origin</span>
    <span class="k">if</span> <span class="n">origin</span> <span class="o">==</span> <span class="s1">&#39;reanalysis&#39;</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="mi">1940</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="mi">2023</span>
    <span class="k">elif</span> <span class="n">origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="mi">2024</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="mi">2100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown origin: Please specify &#39;reanalysis&#39; or &#39;projections&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate global min and max values for the colormap scale</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">desired_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time_data</span> <span class="o">==</span> <span class="n">desired_time</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">dataset2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">][</span><span class="n">time_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">global_min</span><span class="p">:</span>
            <span class="n">global_min</span> <span class="o">=</span> <span class="n">data_min</span>
        <span class="k">if</span> <span class="n">data_max</span> <span class="o">&gt;</span> <span class="n">global_max</span><span class="p">:</span>
            <span class="n">global_max</span> <span class="o">=</span> <span class="n">data_max</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Global min: </span><span class="si">{</span><span class="n">global_min</span><span class="si">}</span><span class="s1">, Global max: </span><span class="si">{</span><span class="n">global_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">desired_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">time_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time_data</span> <span class="o">==</span> <span class="n">desired_time</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zeitpunkt </span><span class="si">{</span><span class="n">desired_time</span><span class="si">}</span><span class="s2"> nicht gefunden, überspringe Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">dataset2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">][</span><span class="n">time_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">dataset2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">dataset2</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ungültige Werte in den Daten für </span><span class="si">{</span><span class="n">desired_time</span><span class="si">}</span><span class="s2">, überspringe Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data_min</span> <span class="o">==</span> <span class="n">data_max</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Konstante Werte in den Daten für </span><span class="si">{</span><span class="n">desired_time</span><span class="si">}</span><span class="s2">, überspringe Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">create_map</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Jahr </span><span class="si">{</span><span class="n">desired_time</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> 
                   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">),</span> 
                   <span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;contourf&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)):</span>
            <span class="n">create_map</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Jahr </span><span class="si">{</span><span class="n">desired_time</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1"> - RCP8.5&#39;</span><span class="p">,</span> 
                       <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">),</span> 
                       <span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;imshow&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">imageio</span>

<span class="c1"># Verzeichnis mit den PNG-Bildern</span>
<span class="c1">#input_folder = r&#39;C:\Users\timte\Documents\Python\HWD\PNG&#39;</span>


<span class="c1"># Name der Ausgabedatei</span>
<span class="n">output_gif</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_animation.gif&#39;</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">output_gif</span><span class="p">)</span>

<span class="c1"># Liste der PNG-Bilder sortieren</span>
<span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">2100</span><span class="p">):</span>  <span class="c1"># Anpassen, wenn Sie mehr Jahre haben</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="c1"># Erstellen des GIFs</span>
<span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span> <span class="n">append_images</span><span class="o">=</span><span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
               <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="temp">
<h2>Temp<a class="headerlink" href="#temp" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">geodesic</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">box</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>

<span class="c1"># Parameter festlegen</span>
<span class="n">csv_directory</span> <span class="o">=</span> <span class="n">output_folder</span>
<span class="n">radius_km</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">grid_size_km</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Größe des Rasters in Kilometern</span>

<span class="c1"># Schritt 1: Erste CSV-Datei im Verzeichnis auswählen</span>
<span class="n">csv_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine CSV-Dateien im Verzeichnis </span><span class="si">{</span><span class="n">csv_directory</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
<span class="n">first_csv_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Schritt 2: CSV-Datei einlesen und nach dem Jahr 2000 filtern</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">first_csv_file</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_2000</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Schritt 3: Koordinaten innerhalb des Radius von 40 km um die AOI finden</span>
<span class="k">def</span> <span class="nf">is_within_radius</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">geodesic</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="p">(</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">))</span><span class="o">.</span><span class="n">km</span> <span class="o">&lt;=</span> <span class="n">radius_km</span>

<span class="n">df_2000</span><span class="p">[</span><span class="s1">&#39;within_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_2000</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">is_within_radius</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_within_radius</span> <span class="o">=</span> <span class="n">df_2000</span><span class="p">[</span><span class="n">df_2000</span><span class="p">[</span><span class="s1">&#39;within_radius&#39;</span><span class="p">]]</span>

<span class="c1"># Geometrie-Spalte hinzufügen</span>
<span class="n">df_within_radius</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_within_radius</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_within_radius</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">)</span>

<span class="c1"># AOI als Punkt definieren</span>
<span class="n">aoi_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">aoi_longitude</span><span class="p">,</span> <span class="n">aoi_latitude</span><span class="p">)</span>
<span class="n">aoi_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">aoi_point</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">aoi_name</span><span class="p">}],</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Raster-Gitter erstellen</span>
<span class="k">def</span> <span class="nf">create_grid</span><span class="p">(</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">,</span> <span class="n">grid_size_km</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Erzeuge ein Raster um den Mittelpunkt (center_lat, center_lon).&quot;&quot;&quot;</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">grid_size_km</span> <span class="o">/</span> <span class="mi">111</span>  <span class="c1"># Umrechnung von Kilometern in Breitengrad</span>
    <span class="n">longitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">center_lon</span> <span class="o">-</span> <span class="n">radius_km</span> <span class="o">/</span> <span class="mi">111</span><span class="p">,</span> <span class="n">center_lon</span> <span class="o">+</span> <span class="n">radius_km</span> <span class="o">/</span> <span class="mi">111</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
    <span class="n">latitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">center_lat</span> <span class="o">-</span> <span class="n">radius_km</span> <span class="o">/</span> <span class="mi">111</span><span class="p">,</span> <span class="n">center_lat</span> <span class="o">+</span> <span class="n">radius_km</span> <span class="o">/</span> <span class="mi">111</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
    
    <span class="c1"># Rasterlinien als Polygone erstellen</span>
    <span class="n">grid_polygons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latitudes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">longitudes</span><span class="p">:</span>
            <span class="n">grid_polygons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">delta</span><span class="p">,</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">delta</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">grid_polygons</span><span class="p">},</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="n">grid_gdf</span> <span class="o">=</span> <span class="n">create_grid</span><span class="p">(</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">,</span> <span class="n">grid_size_km</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">)</span>

<span class="c1"># Umwandlung der Koordinaten für Basemap</span>
<span class="k">def</span> <span class="nf">latlon_to_xy</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">map_obj</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Konvertiere Latitude/Longitude in x/y für Basemap.&quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">map_obj</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="c1"># Basemap erstellen</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;merc&#39;</span><span class="p">,</span> 
            <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">aoi_latitude</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">aoi_latitude</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> 
            <span class="n">llcrnrlon</span><span class="o">=</span><span class="n">aoi_longitude</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">aoi_longitude</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> 
            <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="c1"># Blue Marble-Stil als Hintergrund verwenden</span>
<span class="n">m</span><span class="o">.</span><span class="n">bluemarble</span><span class="p">()</span>

<span class="c1"># Raster-Gitter auf der Basemap darstellen</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">grid_gdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">latlon_to_xy</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)]</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Punkte und AOI auf der Basemap darstellen</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">latlon_to_xy</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">x_aoi</span><span class="p">,</span> <span class="n">y_aoi</span> <span class="o">=</span> <span class="n">latlon_to_xy</span><span class="p">(</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_aoi</span><span class="p">,</span> <span class="n">y_aoi</span><span class="p">,</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Titel und Legende</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Points within </span><span class="si">{</span><span class="n">radius_km</span><span class="si">}</span><span class="s2"> km of </span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s2"> with Grid and Blue Marble Basemap&quot;</span><span class="p">)</span>

<span class="c1"># Karte speichern</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">,</span> <span class="s1">&#39;map_with_grid_and_basemap.png&#39;</span><span class="p">))</span>

<span class="c1"># Karte anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\timte\AppData\Local\Programs\Python\Python311\Lib\site-packages\pandas\core\dtypes\cast.py:131: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  arr = construct_1d_object_array_from_listlike(values)
C:\Users\timte\AppData\Local\Temp\ipykernel_11708\145176251.py:34: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df_within_radius[&#39;geometry&#39;] = df_within_radius.apply(lambda row: Point(row[&#39;longitude&#39;], row[&#39;latitude&#39;]), axis=1)
</pre></div>
</div>
<img alt="../../_images/fa521c02ab51131c91e4a43ddb3add8877606bf6af0306a4d20973142886571f.png" src="../../_images/fa521c02ab51131c91e4a43ddb3add8877606bf6af0306a4d20973142886571f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Funktion, um alle .nc-Dateien im Arbeitsverzeichnis abzurufen</span>
<span class="k">def</span> <span class="nf">get_nc_files</span><span class="p">(</span><span class="n">working_folder</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>


<span class="c1"># Liste der verfügbaren Dateien im Arbeitsverzeichnis</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">get_nc_files</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span>

<span class="c1"># Datensatz-Variable Mapping</span>
<span class="n">dataset_variable_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;02_growing_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;03_heating_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;04_cooling_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;05_tropical_nights&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;07_warmest_three_day_period&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;09_heat_waves_climatological&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;high_utci_days&quot;</span><span class="p">},</span>
    <span class="s2">&quot;11_frost_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Funktion zur Auswahl der Datei</span>
<span class="k">def</span> <span class="nf">select_dataset</span><span class="p">():</span>
    <span class="c1"># Erstelle eine Liste der einzigartigen Datensatznamen (Nummer und Bezeichnung)</span>
    <span class="n">dataset_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)))</span>
    
    <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie einen Datensatz aus:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Benutzereingabe für Datensatz</span>
    <span class="n">dataset_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer des Datensatzes ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">selected_dataset</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">dataset_idx</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">selected_dataset</span>

<span class="k">def</span> <span class="nf">select_origin</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;reanalysis&quot;</span>
    
    <span class="c1"># Filtere die Dateien für den ausgewählten Datensatz</span>
    <span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">dataset</span><span class="p">)]</span>
    
    <span class="c1"># Bestimme die möglichen Origins (reanalysis, projections)</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_files</span><span class="p">)))</span>
    
    <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie die Origin aus:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">origin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">origins</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Benutzereingabe für Origin</span>
    <span class="n">origin_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer der Origin ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">selected_origin</span> <span class="o">=</span> <span class="n">origins</span><span class="p">[</span><span class="n">origin_idx</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">selected_origin</span>

<span class="k">def</span> <span class="nf">select_degree</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span>
        <span class="c1"># Filtere die Dateien für den ausgewählten Datensatz und Origin</span>
        <span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="ow">and</span> <span class="n">origin</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
        
        <span class="c1"># Bestimme die möglichen Gradwerte (30deg, 35deg, 40deg)</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+deg&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_files</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+deg&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">))))</span>
        
        <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie den Gradwert aus:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Benutzereingabe für Gradwert</span>
        <span class="n">degree_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer des Gradwerts ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">selected_degree</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">[</span><span class="n">degree_idx</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">selected_degree</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">select_rcp</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="c1"># Filtere die Dateien für den ausgewählten Datensatz und Origin</span>
    <span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="ow">and</span> <span class="n">origin</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span><span class="p">:</span>
        <span class="c1"># Bestimme die möglichen RCP-Scenarios (rcp_4_5, rcp_8_5)</span>
        <span class="n">rcps</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rcp_\d_\d&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_files</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rcp_\d_\d&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">))))</span>
        
        <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie das RCP-Szenario aus:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rcp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rcps</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">rcp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Benutzereingabe für RCP</span>
        <span class="n">rcp_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer des RCP-Szenarios ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">selected_rcp</span> <span class="o">=</span> <span class="n">rcps</span><span class="p">[</span><span class="n">rcp_idx</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">selected_rcp</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Auswahlprozess</span>
<span class="n">selected_dataset</span> <span class="o">=</span> <span class="n">select_dataset</span><span class="p">()</span>
<span class="n">selected_origin</span> <span class="o">=</span> <span class="n">select_origin</span><span class="p">(</span><span class="n">selected_dataset</span><span class="p">)</span>
<span class="n">selected_degree</span> <span class="o">=</span> <span class="n">select_degree</span><span class="p">(</span><span class="n">selected_dataset</span><span class="p">,</span> <span class="n">selected_origin</span><span class="p">)</span> <span class="k">if</span> <span class="n">selected_dataset</span> <span class="o">==</span> <span class="s2">&quot;06_hot_days&quot;</span> <span class="k">else</span> <span class="kc">None</span>
<span class="n">selected_rcp</span> <span class="o">=</span> <span class="n">select_rcp</span><span class="p">(</span><span class="n">selected_dataset</span><span class="p">,</span> <span class="n">selected_origin</span><span class="p">)</span> <span class="k">if</span> <span class="n">selected_origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># Bestimme die entsprechende Datei</span>
<span class="k">if</span> <span class="n">selected_degree</span> <span class="ow">and</span> <span class="n">selected_rcp</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_dataset</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_degree</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_rcp</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">selected_degree</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_dataset</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_degree</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">selected_rcp</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_dataset</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_rcp</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_dataset</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Speichere die entsprechende Variable basierend auf der Auswahl</span>
<span class="n">variable</span> <span class="o">=</span> <span class="n">dataset_variable_mapping</span><span class="p">[</span><span class="n">selected_dataset</span><span class="p">][</span><span class="n">selected_origin</span><span class="p">]</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">selected_rcp</span> <span class="k">if</span> <span class="n">selected_origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historic&#39;</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">selected_origin</span>

<span class="c1"># Speichern des ausgewählten Datensatzes und Gradwerts falls vorhanden</span>
<span class="k">if</span> <span class="n">selected_dataset</span> <span class="o">==</span> <span class="s2">&quot;06_hot_days&quot;</span> <span class="ow">and</span> <span class="n">selected_degree</span><span class="p">:</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">selected_degree</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">selected_dataset</span>

<span class="c1"># Falls die Ordner noch nicht existieren, diese erstellen</span>
<span class="n">input_netCDF</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">relevant_file</span><span class="p">)</span>

<span class="c1"># Ausgabe der Ergebnisse</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ausgewählte Datei: </span><span class="si">{</span><span class="n">relevant_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entsprechende Variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Szenario: </span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datensatz: </span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Herkunft: </span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">)[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definiere Ausschnitt; hier Deutschland</span>
<span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">55</span>
<span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xr_dataset</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2023-01-01&#39;</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">lon</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">num2date</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">nc_file</span> <span class="o">=</span> <span class="n">input_netCDF</span>

<span class="c1"># Funktion zum Umwandeln von netCDF in CSV</span>
<span class="k">def</span> <span class="nf">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="p">):</span>
    <span class="c1"># Öffne die netCDF Datei</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">input_netCDF</span>
    
    <span class="c1"># Extrahiere die spezifische Variable und die Zeit</span>
    <span class="k">if</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span> <span class="ow">and</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">][:]</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
        
        <span class="c1"># Konvertiere die Zeit in ein lesbares Format</span>
        <span class="n">time_units</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="n">time_calendar</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">calendar</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="s1">&#39;calendar&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;standard&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">num2date</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>

        <span class="c1"># Finde die Indizes, die in den definierten Ausschnitt fallen</span>
        <span class="n">lat_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">)</span>
        <span class="n">lon_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lon_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lon_max</span><span class="p">)</span>
        
        <span class="c1"># Filtere Ausschnitt</span>
        <span class="n">filtered_lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="n">lat_indices</span><span class="p">]</span>
        <span class="n">filtered_lon</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="n">lon_indices</span><span class="p">]</span>
        <span class="n">filtered_temperature</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[:,</span> <span class="n">lat_indices</span><span class="p">,</span> <span class="p">:][:,</span> <span class="p">:,</span> <span class="n">lon_indices</span><span class="p">]</span>

        <span class="c1">#variable =  f&#39;{nc_file}&#39;</span>
        
        <span class="c1"># Erstelle eine Liste von Einträgen für das DataFrame</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_temperature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_temperature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">filtered_temperature</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_temperature</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span>
                        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">[</span><span class="n">t</span><span class="p">],</span>
                            <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">filtered_lat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                            <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">filtered_lon</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
                            <span class="n">variable</span><span class="p">:</span> <span class="n">filtered_temperature</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                        <span class="p">})</span>
        
        <span class="c1"># Erstelle ein DataFrame aus den Einträgen</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Variables not found in </span><span class="si">{</span><span class="n">nc_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># Schließe das Dataset</span>
    <span class="n">dataset</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Erstelle das Ausgabe-Verzeichnis, falls es nicht existiert</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;data/hacs-csv&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Durchlaufe Szenarien/Statistiken</span>
<span class="n">dataframes</span> <span class="o">=</span> <span class="p">[</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="p">)</span> <span class="k">for</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">nc_files</span><span class="p">)</span> <span class="p">]</span>

<span class="c1"># Kombiniere alle Daten in eine Tabelle</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataframes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Schreibe CSV</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;sis-heat-and-cold-spells.csv.zip&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;zip&#39;</span><span class="p">)</span>

<span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kn</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;latitude == 47.7 and longitude == 9.200000000000003&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># prepare upload to SGC KN Data Platform</span>
<span class="n">kn</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;sis-heat-and-cold-spells.pkl.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert from wide to long format</span>
<span class="n">kn_long</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">kn</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">scenario</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">variable</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">kn_long</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;stdev&#39;</span><span class="p">]</span>
<span class="n">kn_long</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">kn_long</span><span class="p">[</span><span class="s1">&#39;scenario&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">():</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">kn_long</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;scenario == &quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;stdev&#39;</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">-mean&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="n">err</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">err</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">-stdev&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Erwartete Hitzewellentage pro Jahr in Konstanz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Zeit&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Szenario&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">########## Output-Datei mehr als 7GB groß... </span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.transform</span> <span class="kn">import</span> <span class="n">from_origin</span>
<span class="kn">from</span> <span class="nn">rasterio.crs</span> <span class="kn">import</span> <span class="n">CRS</span>
<span class="kn">from</span> <span class="nn">rasterio.enums</span> <span class="kn">import</span> <span class="n">Resampling</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">num2date</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">calculate_default_transform</span><span class="p">,</span> <span class="n">reproject</span>

<span class="c1"># Konfiguriere die Eingabepfade</span>
<span class="c1">#input_netCDF = &#39;path/to/your/input/netCDF.nc&#39;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\Interpolated&quot;</span>
<span class="n">aoi_raster_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Input\AOI_Raster2.tif&quot;</span>

<span class="c1"># AOI-Raster laden und seine Eigenschaften extrahieren</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">aoi_raster_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">aoi_raster</span><span class="p">:</span>
    <span class="n">aoi_crs</span> <span class="o">=</span> <span class="n">aoi_raster</span><span class="o">.</span><span class="n">crs</span>
    <span class="n">aoi_transform</span> <span class="o">=</span> <span class="n">aoi_raster</span><span class="o">.</span><span class="n">transform</span>
    <span class="n">aoi_width</span> <span class="o">=</span> <span class="n">aoi_raster</span><span class="o">.</span><span class="n">width</span>
    <span class="n">aoi_height</span> <span class="o">=</span> <span class="n">aoi_raster</span><span class="o">.</span><span class="n">height</span>
    <span class="n">aoi_res</span> <span class="o">=</span> <span class="n">aoi_raster</span><span class="o">.</span><span class="n">res</span>

<span class="c1"># NetCDF-Datei öffnen</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">input_netCDF</span><span class="p">)</span>
<span class="n">lat</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
<span class="n">lon</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
<span class="n">time_var</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="n">time_units</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>  <span class="c1"># Zeit-Einheiten ablesen</span>

<span class="c1"># Bestimme die Pixelgröße und den Ursprung</span>
<span class="n">pixel_size_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">pixel_size_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">pixel_size_lon</span><span class="p">,</span> <span class="n">pixel_size_lat</span><span class="p">)</span>

<span class="c1"># Definiere das CRS (WGS84)</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">CRS</span><span class="o">.</span><span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

<span class="c1"># Unterordner für unprozessierte GeoTIFFs erstellen</span>
<span class="n">unprocessed_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s1">&#39;unprocessed&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">unprocessed_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Unterordner für heruntergerechnete GeoTIFFs erstellen</span>
<span class="n">downscaled_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s1">&#39;downscaled&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">downscaled_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Schleife über alle Zeitdaten</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_var</span><span class="p">)):</span>
        <span class="n">variable_name</span> <span class="o">=</span> <span class="n">variable</span>
        <span class="c1"># Daten für den aktuellen Zeitstempel lesen</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable_name</span><span class="p">][</span><span class="n">t</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="c1"># Jahr aus der Zeitvariable extrahieren</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">time_units</span><span class="p">)</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

        <span class="c1"># Speichern als unprozessierter GeoTIFF</span>
        <span class="n">geotiff_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unprocessed_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.tiff&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="n">geotiff_path</span><span class="p">,</span>
            <span class="s1">&#39;w&#39;</span><span class="p">,</span>
            <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Bild um 180° drehen und von links nach rechts spiegeln</span>
        <span class="n">rotated_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">flipped_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">rotated_data</span><span class="p">)</span>

        <span class="c1"># Speichern des bearbeiteten GeoTIFFs</span>
        <span class="n">processed_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_processed.tiff&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="n">processed_path</span><span class="p">,</span>
            <span class="s1">&#39;w&#39;</span><span class="p">,</span>
            <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="n">flipped_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">flipped_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">flipped_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">flipped_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF für Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> gespeichert: &#39;</span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2">&#39; und bearbeitet als &#39;</span><span class="si">{</span><span class="n">processed_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Downscaling der GeoTIFF-Datei</span>
        <span class="n">downscaled_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">downscaled_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_downscaled.tiff&#39;</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">processed_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="c1"># Berechne die neue Transformationsmatrix</span>
            <span class="n">new_transform</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">calculate_default_transform</span><span class="p">(</span>
                <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">aoi_crs</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="o">*</span><span class="n">src</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">aoi_res</span>
            <span class="p">)</span>
            
            <span class="c1"># Erstelle die neue Datei</span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                <span class="n">downscaled_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">aoi_crs</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">new_transform</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
                <span class="c1"># Reprojectiere die Daten</span>
                <span class="n">reproject</span><span class="p">(</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">destination</span><span class="o">=</span><span class="n">rasterio</span><span class="o">.</span><span class="n">band</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">src_crs</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
                    <span class="n">dst_crs</span><span class="o">=</span><span class="n">aoi_crs</span><span class="p">,</span>
                    <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span>
                <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Heruntergerechneter GeoTIFF für Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> gespeichert als: &#39;</span><span class="si">{</span><span class="n">downscaled_path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="c1"># Datei schließen</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Löschen des unprozessierten Ordners und seiner Inhalte</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">unprocessed_dir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Der Ordner &#39;</span><span class="si">{</span><span class="n">unprocessed_dir</span><span class="si">}</span><span class="s2">&#39; und seine Inhalte wurden gelöscht.&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler beim Öffnen der Datei </span><span class="si">{</span><span class="n">input_netCDF</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### nur null werte...</span>

<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.transform</span> <span class="kn">import</span> <span class="n">from_origin</span>
<span class="kn">from</span> <span class="nn">rasterio.warp</span> <span class="kn">import</span> <span class="n">reproject</span><span class="p">,</span> <span class="n">Resampling</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">read_geotiff</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span>
            <span class="n">crs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully read </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">create_aoi_raster</span><span class="p">(</span><span class="n">aoi_bounds</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">aoi_bounds</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">transform</span>

<span class="k">def</span> <span class="nf">resample_to_aoi</span><span class="p">(</span><span class="n">geotiff_data</span><span class="p">,</span> <span class="n">geotiff_transform</span><span class="p">,</span> <span class="n">geotiff_crs</span><span class="p">,</span> <span class="n">aoi_transform</span><span class="p">,</span> <span class="n">aoi_width</span><span class="p">,</span> <span class="n">aoi_height</span><span class="p">):</span>
    <span class="n">aoi_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">aoi_height</span><span class="p">,</span> <span class="n">aoi_width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">geotiff_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">reproject</span><span class="p">(</span>
        <span class="n">source</span><span class="o">=</span><span class="n">geotiff_data</span><span class="p">,</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">aoi_data</span><span class="p">,</span>
        <span class="n">src_transform</span><span class="o">=</span><span class="n">geotiff_transform</span><span class="p">,</span>
        <span class="n">src_crs</span><span class="o">=</span><span class="n">geotiff_crs</span><span class="p">,</span>
        <span class="n">dst_transform</span><span class="o">=</span><span class="n">aoi_transform</span><span class="p">,</span>
        <span class="n">dst_crs</span><span class="o">=</span><span class="n">geotiff_crs</span><span class="p">,</span>
        <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span>  <span class="c1"># oder Resampling.nearest</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">aoi_data</span>

<span class="k">def</span> <span class="nf">save_geotiff</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">crs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
            <span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
            <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully saved resampled data to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">aoi_shapefile</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Input\Konstanz_Mask.shp&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">aoi_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">aoi_shapefile</span><span class="p">)</span>
    <span class="n">aoi_bounds</span> <span class="o">=</span> <span class="n">aoi_gdf</span><span class="o">.</span><span class="n">total_bounds</span>  <span class="c1"># xmin, ymin, xmax, ymax</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AOI Bounds: </span><span class="si">{</span><span class="n">aoi_bounds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error reading AOI shapefile: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">aoi_bounds</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">if</span> <span class="n">aoi_bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">geotiff_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\GeoTIFF&#39;</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\Interpolated&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created output directory: </span><span class="si">{</span><span class="n">output_directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">geotiff_directory</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF directory does not exist: </span><span class="si">{</span><span class="n">geotiff_directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">geotiff_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">geotiff_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tiff&#39;</span><span class="p">)]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">geotiff_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> files in GeoTIFF directory&quot;</span><span class="p">)</span>

        <span class="n">aoi_width</span><span class="p">,</span> <span class="n">aoi_height</span><span class="p">,</span> <span class="n">aoi_transform</span> <span class="o">=</span> <span class="n">create_aoi_raster</span><span class="p">(</span><span class="n">aoi_bounds</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AOI Raster: width=</span><span class="si">{</span><span class="n">aoi_width</span><span class="si">}</span><span class="s2">, height=</span><span class="si">{</span><span class="n">aoi_height</span><span class="si">}</span><span class="s2">, transform=</span><span class="si">{</span><span class="n">aoi_transform</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">geotiff_files</span><span class="p">:</span>
            <span class="n">geotiff_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geotiff_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            
            <span class="n">geotiff_data</span><span class="p">,</span> <span class="n">geotiff_transform</span><span class="p">,</span> <span class="n">geotiff_crs</span> <span class="o">=</span> <span class="n">read_geotiff</span><span class="p">(</span><span class="n">geotiff_path</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">geotiff_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2"> due to read error.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF Data Shape: </span><span class="si">{</span><span class="n">geotiff_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Transform: </span><span class="si">{</span><span class="n">geotiff_transform</span><span class="si">}</span><span class="s2">, CRS: </span><span class="si">{</span><span class="n">geotiff_crs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF Data Sample Values: </span><span class="si">{</span><span class="n">geotiff_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Output first 5x5 values for debug</span>
            
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">geotiff_data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All values in </span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2"> are NaN. Skipping this file.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resampled_data</span> <span class="o">=</span> <span class="n">resample_to_aoi</span><span class="p">(</span><span class="n">geotiff_data</span><span class="p">,</span> <span class="n">geotiff_transform</span><span class="p">,</span> <span class="n">geotiff_crs</span><span class="p">,</span> <span class="n">aoi_transform</span><span class="p">,</span> <span class="n">aoi_width</span><span class="p">,</span> <span class="n">aoi_height</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resampled Data Shape: </span><span class="si">{</span><span class="n">resampled_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Resampled Data Sample Values: </span><span class="si">{</span><span class="n">resampled_data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Output first 5x5 values for debug</span>
                
                <span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;resampled_</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">save_geotiff</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">resampled_data</span><span class="p">,</span> <span class="n">aoi_transform</span><span class="p">,</span> <span class="n">geotiff_crs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing </span><span class="si">{</span><span class="n">geotiff_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished processing all GeoTIFF files.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Script completed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">60</span><span class="p">,</span> <span class="mi">49</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">dummy_transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="mf">506406.51</span><span class="p">,</span> <span class="mf">5289929.37</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">dummy_crs</span> <span class="o">=</span> <span class="s1">&#39;EPSG:32632&#39;</span>  <span class="c1"># Beispiel-CRS, anpassen nach Bedarf</span>

<span class="n">save_geotiff</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\Interpolated\dummy_test.tif&#39;</span><span class="p">,</span> <span class="n">dummy_data</span><span class="p">,</span> <span class="n">dummy_transform</span><span class="p">,</span> <span class="n">dummy_crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">from</span> <span class="nn">rasterio.enums</span> <span class="kn">import</span> <span class="n">Resampling</span>

<span class="k">def</span> <span class="nf">resample_raster</span><span class="p">(</span><span class="n">input_raster_path</span><span class="p">,</span> <span class="n">output_raster_path</span><span class="p">,</span> <span class="n">target_width</span><span class="p">,</span> <span class="n">target_height</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_raster_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="c1"># Calculate new transform and dimensions</span>
        <span class="n">new_transform</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span> <span class="o">*</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span>
            <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">target_width</span><span class="p">),</span>
            <span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">target_height</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">new_width</span> <span class="o">=</span> <span class="n">target_width</span>
        <span class="n">new_height</span> <span class="o">=</span> <span class="n">target_height</span>

        <span class="c1"># Read and resample data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
            <span class="n">out_shape</span><span class="o">=</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">new_height</span><span class="p">,</span> <span class="n">new_width</span><span class="p">),</span>
            <span class="n">resampling</span><span class="o">=</span><span class="n">Resampling</span><span class="o">.</span><span class="n">bilinear</span>
        <span class="p">)</span>

        <span class="c1"># Update metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;height&#39;</span><span class="p">:</span> <span class="n">new_height</span><span class="p">,</span>
            <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="n">new_width</span><span class="p">,</span>
            <span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">new_transform</span>
        <span class="p">})</span>

        <span class="c1"># Write resampled data</span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">output_raster_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span> <span class="k">as</span> <span class="n">dest</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Path to the directory containing the GeoTIFFs</span>
<span class="n">input_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\GeoTIFF&#39;</span>
<span class="n">output_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\Interpolated&#39;</span>

<span class="c1"># Path to the input and output files</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">1956</span><span class="p">)</span>  <span class="c1"># Example range, adjust as needed</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="n">input_raster_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">input_directory</span><span class="si">}</span><span class="se">\\</span><span class="s1">05_tropical_nights_rcp_8_5_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_processed.tiff&#39;</span>
    <span class="n">output_raster_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">output_directory</span><span class="si">}</span><span class="se">\\</span><span class="s1">resampled_05_tropical_nights_rcp_8_5_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_processed.tiff&#39;</span>

    <span class="c1"># Resample the raster to the AOI resolution (49, 60) or as required</span>
    <span class="n">resample_raster</span><span class="p">(</span><span class="n">input_raster_path</span><span class="p">,</span> <span class="n">output_raster_path</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Laden Sie die CSV-Datei</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\Heat\Ergebnis\11_frost_days-projections-yearly-rcp_8_5-cclm4_8_17-mpi_esm_lr-r1i1p1-grid-v1.0.csv&#39;</span><span class="p">)</span>

<span class="c1"># Definieren Sie die Koordinaten für Leipzig</span>
<span class="n">leipzig_latitude</span> <span class="o">=</span> <span class="mf">51.34</span>
<span class="n">leipzig_longitude</span> <span class="o">=</span> <span class="mf">12.37</span>

<span class="c1"># Filtern Sie die Werte für Leipzig</span>
<span class="c1"># Hier nehme ich an, dass die Koordinaten genau gleich sind. Falls es eine kleine Abweichung geben kann, </span>
<span class="c1"># können Sie einen Toleranzbereich einfügen (z.B. +-0.1 Grad)</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="n">leipzig_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">leipzig_latitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">leipzig_latitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&amp;</span> 
                <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">leipzig_longitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">leipzig_longitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))]</span>


<span class="n">leipzig_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Leipzig&#39;</span>
<span class="n">csv_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">leipzig_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Leipzig_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>


<span class="c1"># Speichern Sie die gefilterten Werte in einer neuen CSV-Datei</span>
<span class="n">leipzig_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Definieren Sie das Verzeichnis, in dem sich die CSV-Dateien befinden</span>
<span class="n">csv_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\CSV&#39;</span>

<span class="c1"># Toleranzbereich für die Koordinaten</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.13</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span>

<span class="c1"># # AOI-Koordinaten (setzen Sie diese entsprechend Ihrer Region)</span>
<span class="c1"># aoi_latitude = 51.3397  # Beispielwert für Leipzig</span>
<span class="c1"># aoi_longitude = 12.3731  # Beispielwert für Leipzig</span>

<span class="c1"># Iterieren Sie durch alle CSV-Dateien im Verzeichnis</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Laden der CSV-Datei</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
        <span class="c1"># Filtern der Werte für das AOI</span>
        <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">aoi_latitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">aoi_latitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">aoi_longitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">aoi_longitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))]</span>
        
        <span class="c1"># Extrahieren der Metadaten aus dem Dateinamen</span>
        <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Benennung der neuen CSV-Datei</span>
        <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
            <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">deg</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
        
        <span class="n">csv_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
        
        <span class="c1"># Speichern der gefilterten Werte in einer neuen CSV-Datei</span>
        <span class="n">aoi_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei gespeichert: </span><span class="si">{</span><span class="n">csv_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## CSV-Export anhand der AOI, zunächst Auswahl der Koordinaten</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Definieren Sie das Verzeichnis, in dem sich die CSV-Dateien befinden</span>
<span class="n">csv_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\CSV&#39;</span>

<span class="c1"># Toleranzbereich für die Koordinaten</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.13</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span>



<span class="c1"># Variable zum Speichern der ausgewählten Koordinate</span>
<span class="n">selected_coordinate</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Iterieren Sie durch alle CSV-Dateien im Verzeichnis</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Laden der CSV-Datei</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
        <span class="c1"># Filtern der Werte für das AOI</span>
        <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">aoi_latitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">aoi_latitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">aoi_longitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">aoi_longitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aoi_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Entfernen von Duplikaten basierend auf Latitude und Longitude</span>
            <span class="n">unique_coordinates</span> <span class="o">=</span> <span class="n">aoi_df</span><span class="p">[[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">selected_coordinate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Mehrere eindeutige Koordinaten im Toleranzbereich gefunden</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mehrere eindeutige Koordinaten gefunden:&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_coordinates</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Option </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Latitude = </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">, Longitude = </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Benutzerauswahl</span>
                    <span class="n">selected_option</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wählen Sie eine Option aus (geben Sie die Nummer ein): &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">selected_coordinate</span> <span class="o">=</span> <span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">selected_option</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eine eindeutige Koordinate im Toleranzbereich gefunden: Latitude = </span><span class="si">{</span><span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Longitude = </span><span class="si">{</span><span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">selected_coordinate</span> <span class="o">=</span> <span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Filtern der Daten auf die ausgewählte Koordinate</span>
            <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">aoi_df</span><span class="p">[(</span><span class="n">aoi_df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_coordinate</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">aoi_df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_coordinate</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])]</span>
        
            <span class="c1"># Extrahieren der Metadaten aus dem Dateinamen</span>
            <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            
            <span class="c1"># Benennung der neuen CSV-Datei</span>
            <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">deg</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            
            <span class="n">csv_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
            
            <span class="c1"># Speichern der gefilterten Werte in einer neuen CSV-Datei</span>
            <span class="n">aoi_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei gespeichert: </span><span class="si">{</span><span class="n">csv_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine Koordinaten im Toleranzbereich für </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## CSV-Export anhand der AOI, zunächst Auswahl der Koordinaten</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Definieren Sie das Verzeichnis, in dem sich die CSV-Dateien befinden</span>
<span class="n">csv_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Users\timte\Documents\Python\Climate Indicators\CSV&#39;</span>

<span class="c1"># Toleranzbereich für die Koordinaten</span>
<span class="n">tolerance</span> <span class="o">=</span> <span class="mf">0.13</span>

<span class="c1"># Funktion zum Extrahieren der Metadaten aus dem Dateinamen</span>
<span class="k">def</span> <span class="nf">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">experiment</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">!=</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scenario</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historical&#39;</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span>



<span class="c1"># Variable zum Speichern der ausgewählten Koordinate</span>
<span class="n">selected_coordinate</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Iterieren Sie durch alle CSV-Dateien im Verzeichnis</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        
        <span class="c1"># Laden der CSV-Datei</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
        <span class="c1"># Filtern der Werte für das AOI</span>
        <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">aoi_latitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">aoi_latitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">aoi_longitude</span> <span class="o">-</span> <span class="n">tolerance</span><span class="p">,</span> <span class="n">aoi_longitude</span> <span class="o">+</span> <span class="n">tolerance</span><span class="p">))]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aoi_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Entfernen von Duplikaten basierend auf Latitude und Longitude</span>
            <span class="n">unique_coordinates</span> <span class="o">=</span> <span class="n">aoi_df</span><span class="p">[[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">selected_coordinate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Mehrere eindeutige Koordinaten im Toleranzbereich gefunden</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mehrere eindeutige Koordinaten gefunden:&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_coordinates</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Option </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Latitude = </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">, Longitude = </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="c1"># Benutzerauswahl</span>
                    <span class="n">selected_option</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Wählen Sie eine Option aus (geben Sie die Nummer ein): &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">selected_coordinate</span> <span class="o">=</span> <span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">selected_option</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Eine eindeutige Koordinate im Toleranzbereich gefunden: Latitude = </span><span class="si">{</span><span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Longitude = </span><span class="si">{</span><span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">selected_coordinate</span> <span class="o">=</span> <span class="n">unique_coordinates</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Filtern der Daten auf die ausgewählte Koordinate</span>
            <span class="n">aoi_df</span> <span class="o">=</span> <span class="n">aoi_df</span><span class="p">[(</span><span class="n">aoi_df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_coordinate</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span> <span class="o">&amp;</span> 
                            <span class="p">(</span><span class="n">aoi_df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">selected_coordinate</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])]</span>
        
            <span class="c1"># Extrahieren der Metadaten aus dem Dateinamen</span>
            <span class="n">indicator</span><span class="p">,</span> <span class="n">experiment</span><span class="p">,</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">deg</span> <span class="o">=</span> <span class="n">extract_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            
            <span class="c1"># Benennung der neuen CSV-Datei</span>
            <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s1">&#39;06_hot_days&#39;</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">deg</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">.csv&#39;</span>
            
            <span class="n">csv_output</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">aoi_directory</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
            
            <span class="c1"># Speichern der gefilterten Werte in einer neuen CSV-Datei</span>
            <span class="n">aoi_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_output</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei gespeichert: </span><span class="si">{</span><span class="n">csv_output</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine Koordinaten im Toleranzbereich für </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##Auswahl der Datensätze</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Funktion, um alle .nc-Dateien im Arbeitsverzeichnis abzurufen</span>
<span class="k">def</span> <span class="nf">get_nc_files</span><span class="p">(</span><span class="n">working_folder</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>


<span class="c1"># Liste der verfügbaren Dateien im Arbeitsverzeichnis</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">get_nc_files</span><span class="p">(</span><span class="n">working_folder</span><span class="p">)</span>

<span class="c1"># Datensatz-Variable Mapping</span>
<span class="n">indicator_variable_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;02_growing_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;03_heating_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;04_cooling_degree_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;05_tropical_nights&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
    <span class="s2">&quot;07_warmest_three_day_period&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust&quot;</span><span class="p">},</span>
    <span class="s2">&quot;09_heat_waves_climatological&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
    <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;high_utci_days&quot;</span><span class="p">},</span>
    <span class="s2">&quot;11_frost_days&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">:</span> <span class="s2">&quot;t2m&quot;</span><span class="p">,</span> <span class="s2">&quot;projections&quot;</span><span class="p">:</span> <span class="s2">&quot;tasAdjust_NON_CDM&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Funktion zur Auswahl der Datei</span>
<span class="k">def</span> <span class="nf">select_indicator</span><span class="p">():</span>
    <span class="c1"># Erstelle eine Liste der einzigartigen Datensatznamen (Nummer und Bezeichnung)</span>
    <span class="n">indicator_names</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)))</span>
    
    <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie einen Datensatz aus:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indicator_names</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Benutzereingabe für Datensatz</span>
    <span class="n">indicator_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer des Datensatzes ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">selected_indicator</span> <span class="o">=</span> <span class="n">indicator_names</span><span class="p">[</span><span class="n">indicator_idx</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">selected_indicator</span>

<span class="k">def</span> <span class="nf">select_origin</span><span class="p">(</span><span class="n">indicator</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s2">&quot;10_high_utci_days&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;reanalysis&quot;</span>
    
    <span class="c1"># Filtere die Dateien für den ausgewählten Datensatz</span>
    <span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">indicator</span><span class="p">)]</span>
    
    <span class="c1"># Bestimme die möglichen Origins (reanalysis, projections)</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_files</span><span class="p">)))</span>
    
    <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie die Origin aus:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">origin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">origins</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Benutzereingabe für Origin</span>
    <span class="n">origin_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer der Origin ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">selected_origin</span> <span class="o">=</span> <span class="n">origins</span><span class="p">[</span><span class="n">origin_idx</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">selected_origin</span>

<span class="k">def</span> <span class="nf">select_degree</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">indicator</span> <span class="o">==</span> <span class="s2">&quot;06_hot_days&quot;</span><span class="p">:</span>
        <span class="c1"># Filtere die Dateien für den ausgewählten Datensatz und Origin</span>
        <span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span> <span class="ow">and</span> <span class="n">origin</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
        
        <span class="c1"># Bestimme die möglichen Gradwerte (30deg, 35deg, 40deg)</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+deg&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_files</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+deg&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">))))</span>
        
        <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie den Gradwert aus:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Benutzereingabe für Gradwert</span>
        <span class="n">degree_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer des Gradwerts ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">selected_degree</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">[</span><span class="n">degree_idx</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">selected_degree</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">select_rcp</span><span class="p">(</span><span class="n">indicator</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
    <span class="c1"># Filtere die Dateien für den ausgewählten Datensatz und Origin</span>
    <span class="n">relevant_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span> <span class="ow">and</span> <span class="n">origin</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span><span class="p">:</span>
        <span class="c1"># Bestimme die möglichen RCP-Scenarios (rcp_4_5, rcp_8_5)</span>
        <span class="n">rcps</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rcp_\d_\d&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">relevant_files</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rcp_\d_\d&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">))))</span>
        
        <span class="c1"># Drucke die Auswahlmöglichkeiten</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bitte wählen Sie das RCP-Szenario aus:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rcp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rcps</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">rcp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Benutzereingabe für RCP</span>
        <span class="n">rcp_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Geben Sie die Nummer des RCP-Szenarios ein: &quot;</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">selected_rcp</span> <span class="o">=</span> <span class="n">rcps</span><span class="p">[</span><span class="n">rcp_idx</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">selected_rcp</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># Auswahlprozess</span>
<span class="n">selected_indicator</span> <span class="o">=</span> <span class="n">select_indicator</span><span class="p">()</span>
<span class="n">selected_origin</span> <span class="o">=</span> <span class="n">select_origin</span><span class="p">(</span><span class="n">selected_indicator</span><span class="p">)</span>
<span class="n">selected_degree</span> <span class="o">=</span> <span class="n">select_degree</span><span class="p">(</span><span class="n">selected_indicator</span><span class="p">,</span> <span class="n">selected_origin</span><span class="p">)</span> <span class="k">if</span> <span class="n">selected_indicator</span> <span class="o">==</span> <span class="s2">&quot;06_hot_days&quot;</span> <span class="k">else</span> <span class="kc">None</span>
<span class="n">selected_rcp</span> <span class="o">=</span> <span class="n">select_rcp</span><span class="p">(</span><span class="n">selected_indicator</span><span class="p">,</span> <span class="n">selected_origin</span><span class="p">)</span> <span class="k">if</span> <span class="n">selected_origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="kc">None</span>

<span class="c1"># Bestimme die entsprechende Datei</span>
<span class="k">if</span> <span class="n">selected_degree</span> <span class="ow">and</span> <span class="n">selected_rcp</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_indicator</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_degree</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_rcp</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">selected_degree</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_indicator</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_degree</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">elif</span> <span class="n">selected_rcp</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_indicator</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_rcp</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">relevant_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">selected_indicator</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="n">selected_origin</span> <span class="ow">in</span> <span class="n">f</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Speichere die entsprechende Variable basierend auf der Auswahl</span>
<span class="n">variable</span> <span class="o">=</span> <span class="n">indicator_variable_mapping</span><span class="p">[</span><span class="n">selected_indicator</span><span class="p">][</span><span class="n">selected_origin</span><span class="p">]</span>
<span class="n">experiment</span> <span class="o">=</span> <span class="n">selected_rcp</span> <span class="k">if</span> <span class="n">selected_origin</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="k">else</span> <span class="s1">&#39;historic&#39;</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">selected_origin</span>

<span class="c1"># Speichern des ausgewählten Datensatzes und Gradwerts falls vorhanden</span>
<span class="k">if</span> <span class="n">selected_indicator</span> <span class="o">==</span> <span class="s2">&quot;06_hot_days&quot;</span> <span class="ow">and</span> <span class="n">selected_degree</span><span class="p">:</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_indicator</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">selected_degree</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">selected_indicator</span>

<span class="c1"># Falls die Ordner noch nicht existieren, diese erstellen</span>
<span class="n">input_netCDF</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">relevant_file</span><span class="p">)</span>

<span class="c1"># Ausgabe der Ergebnisse</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ausgewählte Datei: </span><span class="si">{</span><span class="n">relevant_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Entsprechende Variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Szenario: </span><span class="si">{</span><span class="n">experiment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datensatz: </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Herkunft: </span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">geopy.distance</span> <span class="kn">import</span> <span class="n">geodesic</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">from</span> <span class="nn">folium</span> <span class="kn">import</span> <span class="n">plugins</span>

<span class="c1"># Parameter festlegen</span>
<span class="n">csv_directory</span> <span class="o">=</span> <span class="n">output_folder</span>
<span class="n">radius_km</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># Schritt 1: Erste CSV-Datei im Verzeichnis auswählen</span>
<span class="n">csv_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)]</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine CSV-Dateien im Verzeichnis </span><span class="si">{</span><span class="n">csv_directory</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
<span class="n">first_csv_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_directory</span><span class="p">,</span> <span class="n">csv_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Schritt 2: CSV-Datei einlesen und nach dem Jahr 2000 filtern</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">first_csv_file</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_2000</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Verwende .copy(), um die Kopie explizit zu machen</span>

<span class="c1"># Definiere die AOI Koordinaten und den Namen</span>
<span class="c1"># aoi_latitude = 48.8588443  # Beispiel: Paris</span>
<span class="c1"># aoi_longitude = 2.2943506  # Beispiel: Paris</span>
<span class="c1"># aoi_name = &quot;AOI&quot;</span>

<span class="c1"># Schritt 3: Koordinaten innerhalb des Radius von 40 km um die AOI finden</span>
<span class="k">def</span> <span class="nf">is_within_radius</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">geodesic</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="p">(</span><span class="n">center_lat</span><span class="p">,</span> <span class="n">center_lon</span><span class="p">))</span><span class="o">.</span><span class="n">km</span> <span class="o">&lt;=</span> <span class="n">radius_km</span>

<span class="n">df_2000</span><span class="p">[</span><span class="s1">&#39;within_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_2000</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">is_within_radius</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">],</span> <span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">,</span> <span class="n">radius_km</span><span class="p">),</span> 
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">df_within_radius</span> <span class="o">=</span> <span class="n">df_2000</span><span class="p">[</span><span class="n">df_2000</span><span class="p">[</span><span class="s1">&#39;within_radius&#39;</span><span class="p">]]</span>

<span class="c1"># Folium Karte erstellen</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># AOI einzeichnen</span>
<span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
    <span class="p">[</span><span class="n">aoi_latitude</span><span class="p">,</span> <span class="n">aoi_longitude</span><span class="p">],</span> 
    <span class="n">popup</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;AOI (</span><span class="si">{</span><span class="n">aoi_name</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> 
    <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Koordinaten in der Nähe der AOI einzeichnen</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_within_radius</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Lat: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Lon: </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">folium</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
        <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]],</span>
        <span class="n">radius</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
        <span class="n">popup</span><span class="o">=</span><span class="n">coords</span>  <span class="c1"># Beschriftung auf die Koordinaten setzen</span>
    <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Gitternetzlinien einzeichnen</span>
<span class="k">def</span> <span class="nf">draw_grid_lines</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">grid_latitudes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_latitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">grid_longitudes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_longitude&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

    <span class="c1"># Sortiere die Linien für konsistente Reihenfolge</span>
    <span class="n">grid_latitudes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">grid_longitudes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Linien für horizontale Gitternetzlinien zeichnen</span>
    <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">grid_latitudes</span><span class="p">:</span>
        <span class="c1"># Linien entlang des Längengrads</span>
        <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">(</span>
            <span class="n">locations</span><span class="o">=</span><span class="p">[(</span><span class="n">lat</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">grid_longitudes</span><span class="p">)),</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">grid_longitudes</span><span class="p">))],</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span>
        <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="c1"># Linien für vertikale Gitternetzlinien zeichnen</span>
    <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">grid_longitudes</span><span class="p">:</span>
        <span class="c1"># Linien entlang des Breitengrads</span>
        <span class="n">folium</span><span class="o">.</span><span class="n">PolyLine</span><span class="p">(</span>
            <span class="n">locations</span><span class="o">=</span><span class="p">[(</span><span class="nb">min</span><span class="p">(</span><span class="n">grid_latitudes</span><span class="p">),</span> <span class="n">lon</span><span class="p">),</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">grid_latitudes</span><span class="p">),</span> <span class="n">lon</span><span class="p">)],</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span>
        <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Gitternetzpunkte aus der CSV-Datei einzeichnen</span>
<span class="k">if</span> <span class="s1">&#39;grid_latitude&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;grid_longitude&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">draw_grid_lines</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">grid_lat</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;grid_latitude&#39;</span><span class="p">]</span>
        <span class="n">grid_lon</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;grid_longitude&#39;</span><span class="p">]</span>
        <span class="n">folium</span><span class="o">.</span><span class="n">Marker</span><span class="p">(</span>
            <span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="n">grid_lat</span><span class="p">,</span> <span class="n">grid_lon</span><span class="p">],</span>
            <span class="n">icon</span><span class="o">=</span><span class="n">folium</span><span class="o">.</span><span class="n">Icon</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;info-sign&#39;</span><span class="p">),</span>
            <span class="n">popup</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Grid Lat: </span><span class="si">{</span><span class="n">grid_lat</span><span class="si">}</span><span class="s2">, Lon: </span><span class="si">{</span><span class="n">grid_lon</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># Karte speichern und anzeigen</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;map.html&#39;</span><span class="p">)</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="width:100%;"><div style="position:relative;width:100%;height:0;padding-bottom:60%;"><span style="color:#565656">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc="&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
    
        &lt;script&gt;
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        &lt;/script&gt;
    
    &lt;style&gt;html, body {width: 100%;height: 100%;margin: 0;padding: 0;}&lt;/style&gt;
    &lt;style&gt;#map {position:absolute;top:0;bottom:0;right:0;left:0;}&lt;/style&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;
    
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
            &lt;style&gt;
                #map_03492bcfc85352b02356933cbae2a12c {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            &lt;/style&gt;
        
&lt;/head&gt;
&lt;body&gt;
    
    
            &lt;div class=&quot;folium-map&quot; id=&quot;map_03492bcfc85352b02356933cbae2a12c&quot; &gt;&lt;/div&gt;
        
&lt;/body&gt;
&lt;script&gt;
    
    
            var map_03492bcfc85352b02356933cbae2a12c = L.map(
                &quot;map_03492bcfc85352b02356933cbae2a12c&quot;,
                {
                    center: [47.6603, 9.1758],
                    crs: L.CRS.EPSG3857,
                    zoom: 10,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );

            

        
    
            var tile_layer_021f1de02c518eb003f7c25cbca8d4c3 = L.tileLayer(
                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,
                {&quot;attribution&quot;: &quot;\u0026copy; \u003ca href=\&quot;https://www.openstreetmap.org/copyright\&quot;\u003eOpenStreetMap\u003c/a\u003e contributors&quot;, &quot;detectRetina&quot;: false, &quot;maxNativeZoom&quot;: 19, &quot;maxZoom&quot;: 19, &quot;minZoom&quot;: 0, &quot;noWrap&quot;: false, &quot;opacity&quot;: 1, &quot;subdomains&quot;: &quot;abc&quot;, &quot;tms&quot;: false}
            );
        
    
            tile_layer_021f1de02c518eb003f7c25cbca8d4c3.addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
            var marker_79a2bd4642f1265a8e58c0fa390dac63 = L.marker(
                [47.6603, 9.1758],
                {}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
            var icon_467d5c60052beec09a7bac4dd3928c8e = L.AwesomeMarkers.icon(
                {&quot;extraClasses&quot;: &quot;fa-rotate-0&quot;, &quot;icon&quot;: &quot;info-sign&quot;, &quot;iconColor&quot;: &quot;white&quot;, &quot;markerColor&quot;: &quot;red&quot;, &quot;prefix&quot;: &quot;glyphicon&quot;}
            );
            marker_79a2bd4642f1265a8e58c0fa390dac63.setIcon(icon_467d5c60052beec09a7bac4dd3928c8e);
        
    
        var popup_6f0772e65358d3234a93a5e5cd58932f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_4bfcdc46b344b43beb3676e17f685542 = $(`&lt;div id=&quot;html_4bfcdc46b344b43beb3676e17f685542&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;AOI (Konstanz)&lt;/div&gt;`)[0];
                popup_6f0772e65358d3234a93a5e5cd58932f.setContent(html_4bfcdc46b344b43beb3676e17f685542);
            
        

        marker_79a2bd4642f1265a8e58c0fa390dac63.bindPopup(popup_6f0772e65358d3234a93a5e5cd58932f)
        ;

        
    
    
            var circle_5f8284d00e057a590f7904cc462a7c09 = L.circle(
                [47.5, 8.75],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_c4efce629d772fe48e6319f2449522c5 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_c8e83bf28db9d4a520f14a16ebcc6374 = $(`&lt;div id=&quot;html_c8e83bf28db9d4a520f14a16ebcc6374&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 8.75&lt;/div&gt;`)[0];
                popup_c4efce629d772fe48e6319f2449522c5.setContent(html_c8e83bf28db9d4a520f14a16ebcc6374);
            
        

        circle_5f8284d00e057a590f7904cc462a7c09.bindPopup(popup_c4efce629d772fe48e6319f2449522c5)
        ;

        
    
    
            var circle_046c64cc5f3da2b4124e4ebe38ddec3e = L.circle(
                [47.5, 9.0],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_bc9b879b62ff9195cb8acd2ea200b1ee = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_2d9c8faacd0bd390d105f2924fcf0f76 = $(`&lt;div id=&quot;html_2d9c8faacd0bd390d105f2924fcf0f76&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 9.0&lt;/div&gt;`)[0];
                popup_bc9b879b62ff9195cb8acd2ea200b1ee.setContent(html_2d9c8faacd0bd390d105f2924fcf0f76);
            
        

        circle_046c64cc5f3da2b4124e4ebe38ddec3e.bindPopup(popup_bc9b879b62ff9195cb8acd2ea200b1ee)
        ;

        
    
    
            var circle_d65e3c7571db3bc44d631e267e67d274 = L.circle(
                [47.5, 9.25],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_c95b338b2f1249720b3d53fb8c5ab931 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_d36b334c37b7e9087e1964a22eae9b1a = $(`&lt;div id=&quot;html_d36b334c37b7e9087e1964a22eae9b1a&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 9.25&lt;/div&gt;`)[0];
                popup_c95b338b2f1249720b3d53fb8c5ab931.setContent(html_d36b334c37b7e9087e1964a22eae9b1a);
            
        

        circle_d65e3c7571db3bc44d631e267e67d274.bindPopup(popup_c95b338b2f1249720b3d53fb8c5ab931)
        ;

        
    
    
            var circle_f542fad846ef16ad6f41f620ed55a171 = L.circle(
                [47.5, 9.5],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_22d8597433640ee375824d0e9e6bd366 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_0178c95899ea817335237ab5e5bfbbd8 = $(`&lt;div id=&quot;html_0178c95899ea817335237ab5e5bfbbd8&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.5, Lon: 9.5&lt;/div&gt;`)[0];
                popup_22d8597433640ee375824d0e9e6bd366.setContent(html_0178c95899ea817335237ab5e5bfbbd8);
            
        

        circle_f542fad846ef16ad6f41f620ed55a171.bindPopup(popup_22d8597433640ee375824d0e9e6bd366)
        ;

        
    
    
            var circle_defed1b37e52de89add642629f477a1f = L.circle(
                [47.75, 8.75],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_9e73dcfb827744f88d4f007a004ffd1a = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_eaf06be85da66a3a626cf2cac673bb1c = $(`&lt;div id=&quot;html_eaf06be85da66a3a626cf2cac673bb1c&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 8.75&lt;/div&gt;`)[0];
                popup_9e73dcfb827744f88d4f007a004ffd1a.setContent(html_eaf06be85da66a3a626cf2cac673bb1c);
            
        

        circle_defed1b37e52de89add642629f477a1f.bindPopup(popup_9e73dcfb827744f88d4f007a004ffd1a)
        ;

        
    
    
            var circle_69f2dd6a636869c01fc4611b936ff611 = L.circle(
                [47.75, 9.0],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_1237969029c26c5e6ee7fa0c9e53f540 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_0dc1f62c93b854a47045c8bc31e4aff3 = $(`&lt;div id=&quot;html_0dc1f62c93b854a47045c8bc31e4aff3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 9.0&lt;/div&gt;`)[0];
                popup_1237969029c26c5e6ee7fa0c9e53f540.setContent(html_0dc1f62c93b854a47045c8bc31e4aff3);
            
        

        circle_69f2dd6a636869c01fc4611b936ff611.bindPopup(popup_1237969029c26c5e6ee7fa0c9e53f540)
        ;

        
    
    
            var circle_6b0ec94ce67c645029c6ee8880521c1b = L.circle(
                [47.75, 9.25],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_62ebaedfb85ae048b55391ff606b0b8f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_bb90b0e59f33190c5ad620ec8a69956a = $(`&lt;div id=&quot;html_bb90b0e59f33190c5ad620ec8a69956a&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 9.25&lt;/div&gt;`)[0];
                popup_62ebaedfb85ae048b55391ff606b0b8f.setContent(html_bb90b0e59f33190c5ad620ec8a69956a);
            
        

        circle_6b0ec94ce67c645029c6ee8880521c1b.bindPopup(popup_62ebaedfb85ae048b55391ff606b0b8f)
        ;

        
    
    
            var circle_b00036ff209a6c6e4951835d7327f61c = L.circle(
                [47.75, 9.5],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_60f3ff2a53991ef44fc194c2624e6294 = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_c23d25a4be3308551d4fbde9199384e3 = $(`&lt;div id=&quot;html_c23d25a4be3308551d4fbde9199384e3&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 47.75, Lon: 9.5&lt;/div&gt;`)[0];
                popup_60f3ff2a53991ef44fc194c2624e6294.setContent(html_c23d25a4be3308551d4fbde9199384e3);
            
        

        circle_b00036ff209a6c6e4951835d7327f61c.bindPopup(popup_60f3ff2a53991ef44fc194c2624e6294)
        ;

        
    
    
            var circle_9fbeecd136253eb9747638bfb1a6a26d = L.circle(
                [48.0, 9.0],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_7bde90c70ed01bb60870c0511f6d381f = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_03b1ac3bbd408e49d9edf4f5ba342b96 = $(`&lt;div id=&quot;html_03b1ac3bbd408e49d9edf4f5ba342b96&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 48.0, Lon: 9.0&lt;/div&gt;`)[0];
                popup_7bde90c70ed01bb60870c0511f6d381f.setContent(html_03b1ac3bbd408e49d9edf4f5ba342b96);
            
        

        circle_9fbeecd136253eb9747638bfb1a6a26d.bindPopup(popup_7bde90c70ed01bb60870c0511f6d381f)
        ;

        
    
    
            var circle_17b398c50bc3b683fc00450fdcdc0952 = L.circle(
                [48.0, 9.25],
                {&quot;bubblingMouseEvents&quot;: true, &quot;color&quot;: &quot;blue&quot;, &quot;dashArray&quot;: null, &quot;dashOffset&quot;: null, &quot;fill&quot;: true, &quot;fillColor&quot;: &quot;blue&quot;, &quot;fillOpacity&quot;: 0.2, &quot;fillRule&quot;: &quot;evenodd&quot;, &quot;lineCap&quot;: &quot;round&quot;, &quot;lineJoin&quot;: &quot;round&quot;, &quot;opacity&quot;: 1.0, &quot;radius&quot;: 500, &quot;stroke&quot;: true, &quot;weight&quot;: 3}
            ).addTo(map_03492bcfc85352b02356933cbae2a12c);
        
    
        var popup_84fbe422337cec4c6d5737b43aa1fc2a = L.popup({&quot;maxWidth&quot;: &quot;100%&quot;});

        
            
                var html_b5473fce542858762b70dc98645f1833 = $(`&lt;div id=&quot;html_b5473fce542858762b70dc98645f1833&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Lat: 48.0, Lon: 9.25&lt;/div&gt;`)[0];
                popup_84fbe422337cec4c6d5737b43aa1fc2a.setContent(html_b5473fce542858762b70dc98645f1833);
            
        

        circle_17b398c50bc3b683fc00450fdcdc0952.bindPopup(popup_84fbe422337cec4c6d5737b43aa1fc2a)
        ;

        
    
    
            tile_layer_021f1de02c518eb003f7c25cbca8d4c3.addTo(map_03492bcfc85352b02356933cbae2a12c);
        
&lt;/script&gt;
&lt;/html&gt;" style="position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div></div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="era5_land_monthly.html" class="btn btn-neutral float-left" title="ERA5-Land Monthly Averaged" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../satellite/sentinel2_downloader.html" class="btn btn-neutral float-right" title="Sentinel2 Satellite image downloader using." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Shrestha.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>